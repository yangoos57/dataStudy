# UDemy AWS

## Global Services, Region

### Global Service

- **Identity and Access Management (IAM)**
- **Route 53 (DNS service)**
- **CloudFront (Content Delivery Network)**
- **WAF (Web Application Firewall)**

### Region

하나의 독립적인 서비스. Data Center의 집합이다. ~~서비스는 리전 크기를 벗어나지 못한다.(리전이 가장 큰 단위이며 그 이상을 초과하는 서비스는 존재하지 않는다.)~~  Global Service는 region을 넘는 서비스이다.

### Region 선택 기준

- compliance : 해당 국가의 법률 준수 여부
- proximity : low latency
- Available Services : 리전마다 제공 가능한 서비스가 다름
- Pricing : 리전마다 가격이 다름

### Availability Zones

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled.png)

- Region에 2 ~ 6 개의  AZ가 존재하며(보통 3개) AZ에는 2 ~ 4개의 Data Center가 존재한다.
- 물리적으로 분리되어 있기 때문에 재난 대비가 가능하다.

### Edge Locations

- AWS의 Contents Delivery Network(CDN)이 수행되는 물리적 데이터 센터

## Identity and access management(IAM)

### IAM 이란

- **Global Service**
- User와 Group으로 구분
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%201.png)
    
    - User는 Group에 속하지 않아도 되고, 여러 그룹에 속해도 됨
    - Group은 User를 포함하며, **다른 Group을 포함할 수  없다.**

### IAM Permissions

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%202.png)

- Group 또는 User에게 부여 가능
- Json으로 권한을 부여한다.
- Least priviledge Principle 원칙 : 제한된 권한을 제한된 사용자에 부여

### IAM Policy(정책)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%203.png)

- inline policy : user에 직접 적용하는 policy
- 직접 만들거나 기존에 있는 정책을 사용할 수 있음

### IAM Multi Factor Authentification(MFA)

- Password + Device = MFA
- virtual MFA Device : google authentificator
- Physical Device : u2f

### IAM Roles for Services

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%204.png)

- **IAM Role = AWS Service의 Group으로 이해하자**
- **Role에 IAM Permission이 부여되어있음.**
- Service별로 Common role이 있고, 이에 추가하는 개념임.
- Common roles:
    - EC2 Instance Roles
    - Lambda Function Roles
    - Roles for CloudFormation

## Elastic Compute Cloud(EC2)

### 기본용어

- **ENI : Network card(speed of the card, Public IP address)**
- **security group : Firewall rules**
- Bootstrap : launching commands when a machine starts.(Docker의 cmd 처럼 실행될 때 자동으로 스크립트를 읽는 기능)

### EC2 종류

- **General Purpose(T, M) :  ⇒ 범용 목적**
- **Compute Optimized(C) ⇒ required HPC**
- **Memory Optimized(R,X,M)**
    - High performance, relational/non-relational databases
    - Distributed web scale cache stores
    - In-memory databases optimized for BI
    - Applications performing real-time processing of big unstructured data
- **Stroage Optimized(I, D)**
    - High frequency online transaction processing (OLTP) systems
    - Relational & NoSQL databases
    - Cache for in-memory databases (for example, Redis)
    - Data warehousing applications
    - Distributed file systems

### Security Groups = Firewall on EC2

- **All inbound traffic is blocked by default**
- 기본세팅으로 ec2로 들어오는 모든 Inbound는 통제하고 outbound는 통제하지 않는다.
- EC2 외부에 존재하는 것 인만큼 알맞는 방식으로 Security Group 설정을 해야 EC2에 접근할 수 있다.
- EC2로 접속할 때 컴퓨터가 계속해서 대기하는 모습(Timeout 상황)이라면 Security Group 문제 때문이다.
- 허용 단위를 security Group으로도 설정할 수 있다. ex) A라는 EC2의 Security Group에 S1이라는 Security Group을 Inbound Traffic에 허용한다면, S1 Security Group을 사용하는 EC2들 모두는 A와 통신이 가능하게 된다.
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%205.png)
    

### Classic Ports

- 22 = SSH(Secure Shell) - log into a linux instance
- 21 = FTP(File Transfer Protocol)
- 22 = SFTP(Secure File Transfer Protocol) - upload files using SSH
- 80 = HTTP
- 443 = HTTPS
- 3389 = RDP(Remote Desktop Protocol) - log into a window instance

### EC2 Purchasing Options

- **On-Demand Instances** – short workload, predictable pricing, pay by second
    - Has the highest cost but no upfront payment
    - Recommended for short-term and un-interrupted workloads, where you can't predict how the application will behave
- **Reserved Instance (1 & 3 years) - Instance 구매**
    - Up to 72% discount compared to On-demand
    - Recommended for steady-state usage applications (think database)
    - Convertible Reserved Instance
        - Can change the EC2 instance type, instance family, OS, scope and tenancy
        - Up to 66% discount
- **Savings Plans (1 & 3 years)** **– 사용량을 구매**
    - **Usage beyond EC2 Savings Plans is billed at the On-Demand price**
    - Get a discount based on long-term usage (up to 72% - same as RIs)
    - Commit to a certain type of usage ($10/hour for 1 or 3 years)
    - **Locked to a specific instance family & AWS region (e.g., M5 in us-east-1)**
    - Flexible across:
        
        • Instance Size (e.g., m5.xlarge, m5.2xlarge) 
        
        • OS (e.g., Linux, Windows)
        
        • Tenancy (Host, Dedicated, Default)
        
- **Spot Instances** – short workloads, cheap, can lose instances (less reliable)
    - **Can get a discount of up to 90% compared to On-demand**
    - Instances that you can “lose” at any point of time if your max price is less than the current spot price
    - **The MOST cost-efficient instances in AWS**
    - Useful for workloads that are resilient to failure
        
        • Batch jobs
        • Data analysis
        • Image processing
        • Workloads with a flexible start and end time
        • Not suitable for critical jobs or databases
        
- **Dedicated Hosts** – book an entire physical server, control instance placement
    - **The most expensive option**
    - **Useful for software that have complicated licensing model (BYOL – Bring Your Own License)**
    - **Or for companies that have strong regulatory or compliance needs**
    - Purchasing Options:
        - On-demand – pay per second for active Dedicated Host
        - Reserved - 1 or 3 years (No Upfront,Partial Upfront,All Upfront)
- **Dedicated Instances** – no other customers will share your hardware
- **Capacity Reservations** – reserve capacity in a specific AZ for any duration
• You always have access to EC2 capacity when you need it
• No time commitment (create/cancel anytime), no billing discounts

### Spot Request

- Spot instance 사용하는 옵션, request type을 설정 잘해야함. one-time은 한 번만  persistent는 자동으로  instance를 관리하는 기능임(kubernetes에도 있는 기능인데 이름이 기억나진 않음)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%206.png)

### Spot Fleets = Set of Spot Instances

- Spot Fleets allow us to automatically request Spot Instances with the lowest price

## EC2-Associate

### Public IP & Private IP

- Public IP : 인터넷에서 접근 가능
- Private IP : 사설 네트워크에서만 적용
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%207.png)
    

### Elastic IP

- You can only have 5 Elastic IP in your account (you can ask AWS to increase that)
- If your machine is stopped and then started, the public IP can change

### Placement Groups

- EC2를 배치하는 전략
- **Cluster**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%208.png)
    
    - clusters instances into a low-latency group in a single Availability Zone
    - Pros: Great network (10 Gbps bandwidth between instances with Enhanced Networking enabled - recommended)
    - Cons: If the rack fails, all instances fails at the same time
    - Use case:
    • Big Data job that needs to complete fast
    • Application that needs extremely low latency and high network throughput
- **Spread**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%209.png)
    
    - **spreads instances across underlying hardware (max 7 instances per group per AZ)**
    - Pros:
    • Can span across Availability
    • Reduced risk is simultaneous failure
    • EC2 Instances are on different physical hardware
    Zones (AZ)
    - Cons:
    • Limited to 7 instances per AZ
    per placement group
    - Use case:
    • Application that needs to maximize high availability
    • Critical Applications where each instance must be isolated from failure from each other
- **Partition**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2010.png)
    
    - **spreads instances across many different partitions (which rely on different sets of racks) within an AZ**
    - **Up to 7 partitions per AZ**
    - Up to 100s of EC2 instances
    - **Use cases: HDFS, HBase, Cassandra, Kafka**

### Elastic Network Interfaces(ENI)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2011.png)

- Instance에 IP주소를 부여하는 가상 네트워크 카드
- 하나의 Instance에도 여러 개 ENI를 사용할 수 있다.
- 여러 개의 ENI를 사용하면 네트워크 장애에 대처할 수 있음.
- ENI에 대한 참고자료(나중에 필요하면 읽자.)
    - [https://aws.amazon.com/ko/blogs/aws/new-elastic-network-interfaces-in-the-virtual-private-cloud/](https://aws.amazon.com/ko/blogs/aws/new-elastic-network-interfaces-in-the-virtual-private-cloud/)

### Instance Stop과 Terminate 차이

- Stop – the data on disk (EBS) is kept intact in the next start
- Terminate – any EBS volumes (root) also set-up to be destroyed is lost

### EC2 Hibernate 기능

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2012.png)

- Hibernate = 동면(=겨울잠), 절전
- **The in-memory (RAM) state is preserved**
- The instance boot is much faster! (the OS is not stopped / restarted)
- Under the hood: the RAM state is written to a file in the root EBS volume
- The root EBS volume must be encrypted
- Use cases:
    - Long-running processing
    - Saving the RAM state
    - Services that take time to initialize
- Available for On-Demand, Reserved and Spot Instances
- **An instance can NOT be hibernated more than 60 days**

## Elastic Block Store(EBS) - Network USB stick

- EC2에서 사용하는 Storage이자 network로 연결
- **같은 AZ에 있는 EC2만 연결 가능함. 다른 AZ에 있는 EC2에 사용하려면 Snapshot을 만들어서 사용해야한다**.
- 하나의 EC2에 EBS 여러 개를 사용할 수 있음.
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2013.png)
    

### EBS Snapshots

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2014.png)

- **Make a backup (snapshot) of your EBS volume at a point in time**
- Snapshot을 만든 다음 Create from Snapshot 기능을 사용해 다른 AZ에서 만들 수 있음.

### **EBS Snapshots Features**

- EBS Snapshot Archive
    - **Move a Snapshot to an ”archive tier” that is 75% cheaper**
    - **takes within 24 to 72 hours for restoring the archive**
- Recycle Bin for EBS Snapshots
    - Snapshot을 바로 지우지 않고 Recycle Bin에서 삭제되도록 안전 장치를 만드는 서비스
- Fast Sanpshot Restore(FSR)

### AMAZON Machine Image(AMI)

- AMI are built for a specific region (and can be copied across regions)
- 도커 이미지와 같은 기능인듯

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2015.png)

### EC2 Instance Store

- EC2와 물리적으로 연결된 스토리지
- 고성능 하드웨어 디스크가 필요할 경우 사용한다.

### EBS Volumes come in 6 types

- **gp2 / gp3 (SSD)**: General purpose SSD volume that balances price and performance for a wide variety of workloads
- **io1 / io2 (SSD):** Highest-performance SSD volume for mission-critical low-latency or high-throughput workloads
- **st1 (HDD):** Low cost HDD volume designed for frequently accessed, throughput- intensive workloads
- **sc1 (HDD):** Lowest cost HDD volume designed for less frequently accessed workloads
- EBS Volumes are characterized in Size | Throughput | IOPS (I/O Ops Per Sec) • When in doubt always consult the AWS documentation – it’s good!
- **Only gp2/gp3 and io1/io2 can be used as boot volumes**

### General Purpose SSD

- Cost effective storage, low-latency
- System boot volumes,Virtual desktops, Development and test environments
- 1 GiB - 16TiB
- gp3: IOPS를 수동으로 설정 가능
    - Baseline of 3,000 IOPS and throughput of 125 MiB/s
    - Can increase IOPS up to 16,000 and throughput up to 1000 MiB/s independently
- gp2: IOPS와 용량이 연결되어 있음
    - Small gp2 volumes can burst IOPS to 3,000
    - Size of the volume and IOPS are linked, max IOPS is 16,000
    - 3 IOPS per GB, means at 5,334 GB we are at the max IOPS

### Provisioned IOPS (PIOPS) SSD

- **IOPS 16000 이상이 필요할 경우**
- Critical business applications with sustained IOPS performance Or applications that need more than 16,000 IOPS
- Great for databases workloads (sensitive to storage perf and consistency)
- io1/io2 (4 GiB - 16 TiB):
    - Max PIOPS: 64,000 for Nitro EC2 instances & 32,000 for other
    - io2 have more durability and more IOPS per GiB (at the same price as io1)
    - io2 Block Express (4 GiB – 64 TiB):
        - Sub-millisecond latency
        - Max PIOPS: 256,000 with an IOPS:GiB ratio of 1,000:1

### EBS Multi-Attach – io1/io2 family

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2016.png)

- **io1/io2 only support EBS Multi-Attach**
- Attach the same EBS volume to **multiple EC2 instances in the same AZ**
- Use case:
• Achieve higher application availability in clustered
Linux applications (ex:Teradata)
- **Up to 16 EC2 Instances at a time**
- **Must use a file system that’s cluster-aware** (not
XFS, EXT4, etc...)

### Hard Disk Drives (HDD)

- **Cannot be a boot volume**
- 125 GiB to 16TiB
- Big Data, Data Warehouses, Log Processing
- Max throughput 500 MiB/s – max IOPS 500

### EBS Encryption

- encrypted volume 만들기
    - **방법 1 : EBS를 처음 만들때 encryption 기능을 사용한다.**
    - **방법 2 : unencrpyted EBS를 Encrypted EBS로 만들기 위해선  snapshot을 활용해야한다. Snapshot을 통해 volume을 새로 생성하는 과정에서 encryption을 활성화해서 만든다.**
- encrypted volume snapshot 만들기
    - encrypted volume을 새로 만들어서 스냅샷을 만드는 것 외에는 없다.

### Elastic File System(EFS) = NFS (network file system

- 기본 개념
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2017.png)
    
- **EFS works with EC2 instances in multi-AZ**
- Highly available, scalable, expensive (3x gp2), pay per use
- Use cases: content management, web serving, data sharing,Wordpress
- Uses NFSv4.1 protocol
- **Compatible with Linux based AMI (not Windows)**
- Encryption at rest using KMS
- POSIX file system (~Linux) that has a standard file API
- **File system scales automatically, pay-per-use, no capacity planning!**

### EFS 모드

- **EFS Scale**
    - 1000s of concurrent NFS clients, 10 GB+ /s throughput
    - Grow to Petabyte-scale network file system, automatically
- **Performance Mode (set at EFS creation time)**
    - General Purpose (default) – latency-sensitive use cases (web server, CMS, etc...)
    - Max I/O – higher latency, throughput, highly parallel (big data, media processing)
- **Throughput Mode**
    - Bursting – 1TB = 50MiB/s + burst of up to 100MiB/s
    - Provisioned – set your throughput regardless of storage size, ex: 1 GiB/s for 1 TB storage
    - Elastic – automatically scales throughput up or down based on your workloads
    • Up to 3GiB/sforreadsand1GiB/sforwrites
        
        • Used for unpredictable workloads
        

### EFS - Storage Tiers

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2018.png)

- **Standard:** for frequently accessed files
- **Infrequent access (EFS-IA):** cost to retrieve files, lower price to store. Enable EFS-IA with a Lifecycle Policy
- **60일 이상 사용하지 않으면 IA로 넘어감**
- **Availability and durability**
    - Standard: Multi-AZ, great for production
    - One Zone: One AZ, great for dev, backup enabled by default, compatible with IA (EFS One Zone-IA)
- **Over 90% in cost savings**

### EBS vs EFS – Elastic Block Storage

**EBS**

- one instance (except multi-attach io1/io2)
- are locked at the Availability Zone (AZ) level
- gp2: IO increases if the disk size increases
- io1: can increase IO independently

**To migrate an EBS volume across AZ** 

- Take a snapshot
- Restore the snapshot to another AZ
- EBS backups use IO and you shouldn’t run them while your application is handling a lot of traffic
- **Root EBS Volumes of instances get terminated by default if the EC2 instance gets terminated. (you can disable that)**

**EFS**

- **Mounting 100s of instances across AZ**
- EFS share website files (WordPress)
- **Only for Linux Instances (POSIX)**
- EFS has a higher price point than EBS
- Can leverage EFS-IA for cost savings
- Remember : EFS vs EBS vs Instance Store

## **AWS Fundamentals**

**Vertical Scalability**

- Vertical scalability is very common for non distributed systems, such as a database.
- RDS, ElastiCache are services that can scale
vertically.
- There’s usually a limit to how much you can
vertically scale (hardware limit)

**Horizontal Scalability** 

- Horizontal scaling implies distributed systems.
- AWS에서는 Scale out / in이라는 용어를 사용함.

**High Availability**

- High availability means running your application / system in at least 2 data centers (== Availability Zones)
- **The goal of high availability is to survive a data center loss**
- The high availability can be passive (for RDS Multi AZ for example)

## Load balancer

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2019.png)

### Why use a load balancer?

- Expose a single point of access (DNS) to your application
- **Do regular health checks to your instances**
    - Health Checks
    • Health Checks are crucial for Load Balancers
    • They enable the load balancer to know if instances it forwards traffic to are available to reply to requests
    • The health check is done on a port and a route (/health is common)
    • If the response is not 200 (OK), then the instance is unhealthy
- Provide SSL termination (HTTPS) for your websites
- Enforce stickiness with cookies
- High availability across zones
- Separate public traffic from private traffic

### Types of load balancer on AWS

- Application Load Balancer (v2 - new generation) – 2016
    - ALB HTTP, HTTPS, WebSocket
- Network Load Balancer (v2 - new generation) – 2017 – NLB
    - TCP, TLS(secureTCP), UDP
- Gateway Load Balancer – 2020 – GWLB
    - Operates at layer 3 (Network layer) – IP Protocol

### Load Balancer Security Groups

- EC2의 Security Group의 Source를 Load Balancer의 Security Group으로 설정해서, Traffic이 Load Balancer를 통해서 들어오게 할 수 있음.

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2020.png)

### Application Load Balacner - HTTP Based Traffic

- **IP 주소가 없고 DNS Name으로 접속한다.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2021.png)

- Layer 7(HTTP,HTTPS)
- **Routing tables to different target groups:**
    - **Routing based on path in URL** (example.com/users & example.com/posts)
    - **Routing based on hostname in URL** (one.example.com & other.example.com)
    - **Routing based on Query String, Headers** (example.com/users?id=123&order=false)
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2022.png)
        
- **The application servers don’t see the IP of the client directly**
    - The true IP of the client is inserted in the header X-Forwarded-For
    - We can also get Port (X-Forwarded-Port) and proto (X-Forwarded-Proto)
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2023.png)
    

### APP Load Balancer의 Target Group 종류

- **Health checks are at the target group level**
- **EC2 instances** (can be managed by an Auto Scaling Group) – HTTP
- **ECS tasks** (managed by ECS itself) – HTTP
- **Lambda functions** – HTTP request is translated into a JSON event
- **IP Addresses** – must be private IPs
- **ALB와 Target Group이 HTTP로 통신하는 이유는 ALB가 HTTPS를 대신 해주기 때문임**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2024.png)
    

### Network Load Balancer - TCP & UDP Based

- Network load balancers (Layer 4) allow to:
    - Forward TCP & UDP traffic to your instances
    - Handle millions of request per seconds
    - Less latency ~100 ms (vs 400 ms for ALB)
- **NLB has one static IP per AZ**, and supports assigning Elastic IP (helpful for whitelisting specific IP)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2025.png)

### Network Load Balancer - Target Groups

- EC2 instances
- IP Addresses – must be private IPs
- **Application Load Balancer**
- **Health Checks support the TCP, HTTP and HTTPS Protocols**
- **ALB와 다르게 Lambda, ECS는 없다.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2026.png)

### Gateway Load Balancer - Layer 3

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2027.png)

- **IP Packet 검사용으로 사용**
- Example: Firewalls, Intrusion Detection and Prevention Systems, Deep Packet Inspection Systems, payload manipulation, …
- Operates at Layer 3 (Network Layer) – IP Packets
- Combines the following functions:
    - Transparent Network Gateway – single entry/exit
    - Load Balancer – distributes traffic to your virtual appliances
- **Uses the GENEVE protocol on port 6081**

### Gateway Load Balancer –Target Groups

- EC2 instances
- IP Addresses – must be private IPs

### Sticky Sessions

- **Load Balancer를 사용할 때 client와 특정 instance를 계속 연결시키는 기능**
- **This works for Classic Load Balancer, Application Load Balancer, and Network Load Balancer**
- Application-based Cookies
    - Custom cookie
        - Generated by target
    - Application cookie
        - Generated by load balancer
- Duration-based Cookies
    - Generated by load balancer

### Cross-Zone Load Balancing

- 기본개념
- **With Cross Zone Load Balancing:**
    
    each load balancer instance distributes evenly
    across all registered instances in all AZ
    
- **Without Cross Zone Load Balancing:**
    
    Requests are distributed in the instances of the
    node of the Elastic Load Balancer
    

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2028.png)

- **Application Load Balancer**
• Enabled by default (can be disabled at the Target Group level)
    
    • No charges for inter AZ data
    
- **Network Load Balancer & Gateway Load Balancer**
    
    • Disabled by default
    • You pay charges ($) for inter AZ data if enabled
    

### Server Name Indication(SNI)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2029.png)

- **SNI solves the problem of loading multiple SSL certificates onto one web server (to serve multiple websites)**
- The server will then find the correct certificate, or return the default one
- Application Load Balancer (v2)
• Supports multiple listeners with multiple SSL certificates
    
    • Uses Server Name Indication (SNI) to make it work
    
- Network Load Balancer (v2)
• Supports multiple listeners with multiple SSL certificates
• Uses Server Name Indication (SNI) to make it work

### Connection Draining(=**Deregistration Delay)**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2030.png)

- Instance 연결을 종료하고자 할 때 중단 기간을 둬서 안정적으로 종료할 수 있게 만드는 기능

### 문제

Question 5:

**Application Load Balancer를 사용해 EC2 인스턴스에서 호스팅된 웹사이트의 트래픽을 분배하고 있습니다. 그런데 여러분의 웹사이트가 Application Load Balancer의 IP 주소인 사설 IPv4 주소에서 들어오는 트래픽만을 확인하고 있는 것으로 나타났습니다. 이런 경우, 웹사이트로 연결된 클라이언트들의 IP 주소를 받으려면 어떻게 해야 할까요?**

Application Load Balancer를 사용하여 EC2 인스턴스에 트래픽을 배분하는 경우, 요청을 받게 되는 IP 주소는 ALB의 사설 IP 주소가 됩니다. 클라이언트의 IP 주소를 받기 위해, ALB는 클라이언트의 IP 주소를 포함하고 있는 X-Forwarded-For라는 헤더를 추가합니다.

Question 9:

**Application Load Balancer는 트래픽을 다른 대상 그룹으로 라우팅할 수 있습니다. 이때 확인할 내용으로 사용할 수 없는 것을 고르세요.**

답 : ALB는 URL 경로, 호스트 이름, HTTP 헤더 및 쿼리 문자열을 기반으로 트래픽을 다른 대상 그룹으로 라우팅할 수 있습니다.

Question 11:

**규정 준수를 위해, 고정된 정적 IP 주소를 최종 사용자에게 노출하여 사용자들이 안정적이고, 규제 기관의 승인을 받은 방화벽 규칙을 작성할 수 있도록 하려 합니다. 이런 경우, 다음 중 어떤 종류의 Elastic Load Balancer를 사용해야 할까요?**

Network Load Balancer는 AZ 당 하나의 정적 IP 주소를 가지며, 여기에 탄력적 IP 주소를 연결할 수 있습니다. **Application Load Balancer와 Classic Load Balancer를 정적 DNS 이름으로 사용할 수 있습니다.**

## Auto Scaling Group

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2031.png)

- ASG are free (you only pay for the underlying EC2 instances)
- ASG Launch Template

### Auto Scaling - CloudWatch Alarms & Scaling

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2032.png)

- **It is possible to scale an ASG based on CloudWatch alarms**
- Metrics such as Average CPU are computed for the overall ASG instances
- Based on the alarm:
• We can create scale-out policies (increase the number of instances)
• We can create scale-in policies (decrease the number of instances)

### Dynamic Scaling Policy

- **Target Tracking Scaling**
• Most simple and easy to set-up
• Example: I want the average ASG CPU to stay at around 40%
- **Simple / Step Scaling**
• When a CloudWatch alarm is triggered (example CPU > 70%), then add 2 units
    
    • When a CloudWatch alarm is triggered (example CPU < 30%), then remove 1
    
- **Scheduled Actions**
• Anticipate a scaling based on known usage patterns
• Example: increase the min capacity to 10 at 5 pm on Fridays

### Predictive Scaling

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2033.png)

- Predictive scaling: continuously forecast load and schedule scaling ahead
    - **Using Machine Learning**

### Good Metrics to scale on

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2034.png)

- **CPUUtilization:** Average CPU utilization across your instances
- **RequestCountPerTarget:** to make sure the number of requests per EC2 instances is stable
- **Average Network In / Out** (if you’re application is network bound)
- Any custom metric (that you push using CloudWatch)

### Scaling Cooldowns

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2035.png)

- After a scaling activity happens, you are in the cooldown period (default 300 seconds)
- During the cooldown period, the ASG will not launch or terminate additional instances (to allow for metrics to stabilize)
- Advice: Use a ready-to-use AMI to reduce configuration time in order to be serving request fasters and reduce the cooldown period

## **Relational Database Service(**RDS)

### Advantage over using RDS versus deploying DB on EC2

- **RDS is a managed service:**
    - Automated provisioning, OS patching
    - Continuous backups and restore to specific timestamp (Point in Time Restore)!
    - Read replicas for improved read performance
    - **Multi AZ setup for DR (Disaster Recovery)**
    - **Storage backed by EBS (gp2 or io1)**
    - **BUT you can’t SSH into your instances**

### RDS – Storage Auto Scaling

- Helps you increase storage on your RDS DB instance
- **When RDS detects you are running out of free database storage, it scales automatically**
- You have to set Maximum Storage Threshold
- Automatically modify storage if:
    - Free storage is less than 10% of allocated storage
    - Low-storage lasts at least 5 minutes
    - 6 hours have passed since last modification
    for DB storage)
    - Useful for applications with unpredictable workloadsR

### RDS Read Replicas for read scalability

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2036.png)

- **Up to 5 Read Replicas**
- **Within AZ, Cross AZ or Cross Region**
- **Replication is ASYNC, so reads are eventually consistent**
    - 새로 쓰인 내용이 순서대로 Read Replica로 복사되는게 아님
    - 비동기 복제는 마스터 데이터베이스 인스턴스에 대한 변경사항이 읽기 복제본으로 즉시 전파되지 않는 복제입니다.
- **Replicas can be promoted to their own DB(Replica에서 Master로 될 수 있다는 의미)**
- Applications must update the connection

### RDS Read Replicas – Network Cost

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2037.png)

- In AWS there’s a network cost when data goes from one AZ to another
- **For RDS Read Replicas within the same region, you don’t pay that fee**

### RDS Multi AZ (Disaster Recovery)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2038.png)

- **SYNC replication**
- One DNS name – automatic app
- **failover to standby**
- **Increase availability**
- Failover in case of loss of AZ, loss of network, instance or storage failure
- **Not used for scaling**
- **Note:The Read Replicas be setup as Multi AZ for Disaster Recovery (DR)**
- **읽기 전용 복제본에 Multi-AZ 설정을 두어 바로 Write가 가능하도록 설정할 수 있다.**

### RDS – From Single-AZ to Multi-AZ

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2039.png)

- **Zero downtime operation (no need to stop the DB)**
- The following happens internally:
    - A snapshot is taken
    - A new DB is restored from the snapshot in a new AZ
    - Synchronization is established between the two databases

### **RDS Custom**

- **Managed Oracle and Microsoft SQL Server Database with OS and database customization**

## Aurora

- Aurora is a proprietary technology from AWS (not open sourced)
- **Aurora is “AWS cloud optimized” and claims 5x performance improvement over MySQL on RDS, over 3x the performance of Postgres on RDS**
- Aurora storage automatically grows in increments of 10GB, up to 128 TB.
- **Aurora can have up to 15 replicas and the replication process is faster than MySQL (sub 10 ms replica lag)**
    - RDS = 5개
- **Failover in Aurora is instantaneous. It’s HA (High Availability) native.**
- Aurora costs more than RDS (20% more) – but is more efficient

### Aurora High Availability and Read Scaling

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2040.png)

- **6 copies of your data across 3 AZ:**
    - 4 copies out of 6 needed for writes
    - 3 copies out of 6 need for reads
    - Self healing with peer-to-peer replication
    - Storage is striped across 100s of volumes
- One Aurora Instance takes writes (master)
- Automated failover for master in less than 30 seconds
- **Support for Cross Region Replication**

### Aurora DB Cluseter

**chatgpt-When you create an Amazon Aurora database, you have the option to create a single instance or a cluster. By default, the cluster option is selected.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2041.png)

### Features of Aurora

- Automatic fail-over
- Backup and Recovery
- Isolation and security
- Industry compliance
- Push-button scaling
- Automated Patching with Zero Downtime
- Advanced Monitoring
- Routine Maintenance
- Backtrack: restore data at any point of time without using backups

### Aurora Replicas-Auto Scaling

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2042.png)

### Aurora Specialty

- **Custom Endpoint**
    - Define a subset of Aurora Instances as a Custom Endpoint
    - Example: Run analytical queries on specific replicas
    - **The Reader Endpoint is generally not used after defining Custom Endpoints**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2043.png)
    

- **Serverless**
    - **Automated database instantiation and auto-scaling based on actual usage**
    - Good for infrequent, intermittent or unpredictable workloads
    - Pay per second, can be more cost-effective
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2044.png)
    
- **Multi-Master**
    - **In case you want immediate failover for write node (HA)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2045.png)
    
- **Global Aurora**
    - Aurora Cross Region Read Replicas:
        - Useful for disaster recovery
        - Simple to put in place
    - Aurora Global Database (recommended):
        - 1 Primary Region (read / write)
        - **Up to 5 secondary (read-only) regions, replication lag is less than 1 second**
        - Up to 16 Read Replicas per secondary region
        - Helps for decreasing latency
- **Aurora Machine Learning**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2046.png)
    
    - Enables you to add ML-based predictions to your applications via SQL
    - Simple, optimized, and secure integration between Aurora and AWS ML services

### Backup

- **Restoring a RDS / Aurora backup or a snapshot creates a new database**
- **RDS Backups**
    - Automated backups:
    • Daily full backup of the database (during the backup window)
    • **Transaction logs are backed-up by RDS every 5 minutes**
    • => ability to restore to any point in time (from oldest backup to 5 minutes ago)
        
        • **1 to 35 days of retention**, set 0 to disable automated backups
        
    - Manual DB Snapshots
    • Manually triggered by the user
    • Retention of backup for as long as you want
    - Restoring MySQL RDS database from S3
        
        • Create a backup of your on-premises database
        • Store it on Amazon S3 (object storage)
        • Restore the backup file onto a new RDS instance running MySQL
        
    - **Trick: in a stopped RDS database, you will still pay for storage. If you plan on stopping it for a long time, you should snapshot & restore instead**
- **Aurora Backup**
    - Automated backups
    **• 1 to 35 days (cannot be disabled)**
    • point-in-time recovery in that timeframe
    - Manual DB Snapshots
    • Manually triggered by the user
    • Retention of backup for as long as you want
    - Restoring MySQL Aurora cluster from S3
    • Create a backup of your on-premises database using Percona XtraBackup
    • Restore the backup file onto a new Aurora cluster running MySQL
    - Aurora Database Cloning
    **• Create a new Aurora DB Cluster from an existing one**
    • **Faster than snapshot & restore**
    • Initially, the new DB cluster uses the same data volume as the original DB cluster (fast and efficient – no copying is needed)
    • When updates are made to the new DB cluster data, then additional storage is allocated and data is copied to be separated
    **• Useful to create a “staging” database from a “production” database without impacting the production database**

### RDS & Aurora Security

- **At-rest encryption:**
    - Database master & replicas encryption using AWS KMS – must be defined as launch time
    - **If the master is not encrypted, the read replicas cannot be encrypted**
- **In-flight encryption:** TLS-ready by default , use the AWS TLS root certificates client-side
- **IAM Authentication:** IAM roles to connect to your database (instead of username/pw)
- **Security Groups:** Control Network access to your RDS / Aurora DB
- **No SSH available except on RDS Custom**
- Audit Logs can be enabled and sent to CloudWatch Logs for longer retention

### RDS Proxy

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2047.png)

- **Serverless, autoscaling, highly available (multi-AZ)**
- **Allows apps to pool and share DB connections established with the database**
- **Improving database efficiency by reducing the stress on database resources (e.g., CPU, RAM) and minimize open connections (and timeouts)**
- Enforce IAM Authentication for DB, and securely
- store credentials in AWS Secrets Manager
- **RDS Proxy is never publicly accessible (must be accessed from VPC)**

### 문제

Question 4:

**RDS 데이터베이스에 읽기 전용 복제본을 설정해 두었지만, 소셜 미디어 포스트를 업데이트할 시 업데이트가 바로 이루어지지 않는다는 점에 대해 사용자들이 불만을 토로하고 있습니다. 이 경우, 가능성이 있는 원인은 무엇일까요?**
• 애플리케이션에 버그가 존재함
**• 읽기 전용 복제본은 비동기 복제를 지니므로, 사용자들은 최종 일관성만을 읽게 됨**
• 그 대신 다중 AZ를 설정했었어야 함

Question 11:

**RDS PostgreSQL 데이터베이스의 특정 리전에서 정전이 발생했을 때 데이터베이스가 신속하게 다른 AWS 리전에서 읽고 쓰는 작업을 할 수 있도록 재해 복구 전략을 수립하려고 합니다. DR 데이터베이스는 가용성이 매우 높아야 합니다. 가장 적합한 방식은 무엇입니까?**

답 : 다른 리전에 읽기 전용 복제본을 만들고 해당 읽기 전용 복제본에서 다중 AZ를 활성화한다.

Question 14:

**암호화되지 않은 RDS DB 인스턴스를 암호화하는 방법은 무엇인가요?**

답 : 암호화되지 않은 RDS DB 인스턴스의 스냅샷을 생성하고, 스냅샷을 복사해 암호화 활성화하기 박스를 체크한 뒤, RDS DB인스턴스를 암호화되지 않은 스냅샷에서 복구하기.

Question 18:

**프로덕션에서 실행 중인 한 애플리케이션이 Aurora 클러스터를 데이터베이스로 사용하고 있습니다. 여러분의 개발 팀은 필요할 경우 많은 양의 워크로드를 수행할 수 있는, 스케일이 축소된 애플리케이션에서 애플리케이션의 버전을 실행하려 합니다. 애플리케이션은 대부분의 시간 동안 사용되지 않습니다. CIO는 여러분에게 팀을 도와 비용을 최소화하는 동시에 이를 달성해 줄 것을 요청했습니다. 어떤 방법을 사용해야 할까요?**

답
• Aurora 글로벌 데이터베이스 사용하기
• RDS 데이터베이스 사용하기
**• Aurora 서버리스 사용하기**
• EC2에 Aurora를 실행하고, EC2 인스턴스가 밤에는 차단되도록 하는 스크립트 작성하기

## Elastic Cache

- **ElastiCache is to get managed Redis or Memcached**
- **Using ElastiCache involves heavy application code changes**
- Caches are in-memory databases with really high performance, low latency
- Helps reduce load off of databases for read intensive workloads
- Helps make your application stateless
- AWS takes care of OS maintenance / patching, optimizations, setup, configuration, monitoring, failure recovery and backups

### ElastiCache Solution Architecture - DB Cache

- Applications queries ElastiCache, if not available, get from RDS and store in ElastiCache.
- Cache must have an invalidation strategy to make sure only the most current data is used in there.

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2048.png)

### ElastiCache Solution Architecture – User Session Store

- ElastiCache로 Login Session 구현하기
- ALB의 Stickysession을 구현하지 않아도 됨.
    - User logs into any of the application
    - The application writes the session data into ElastiCache
    - The user hits another instance of our application
    - The instance retrieves the data and the user is already logged in

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2049.png)

### **ElastiCache – Redis vs Memcached**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2050.png)

### Cache Security

- **ElastiCache do not supports IAM Authentication for Redis**
- **IAM policies on ElastiCache are only used for AWS API-level security**

### Patterns for Elastic Cache

- **Lazy Loading:** all the read data is cached, data can become stale in cache
    - Chat-GPT:  a feature that allows you to load large objects or data structures into memory only when they are requested, rather than loading them all at once when the Redis server starts up.
- **Write Through:** Adds or update data in the cache when written to a DB (no stale data)
    - Chat-GPT : write through is a caching pattern where data is first written to the cache (Redis) before being written to the primary data store (e.g. a database). When data is updated, the cache is updated first, and then the update is propagated to the primary data store.
- **Session Store:** store temporary session data in a cache (using TTL features)
- Quote:There are only two hard things in Computer Science: cache invalidation and naming things

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2051.png)

## Route53

### DNS Terminologies

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2052.png)

- **Domain Registrar:** Amazon Route 53, GoDaddy, ...
- **DNS Records:** A, AAAA, CNAME, NS, ...
- **Zone File:** contains DNS records
- **Name Server:** resolves DNS queries (Authoritative or Non-Authoritative)
- **Top Level Domain (TLD)**: .com, .us, .in, .gov, .org, ...
- **Second Level Domain (SLD)**: [amazon.com](http://amazon.com/), [google.com](http://google.com/), ...

### How DNS Works

- Cache TTL을 설정하면 IP address가 바뀌더라도 설정한 기간 동안은 기존 IP address로 접속을 시도함.
- 

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2053.png)

### Route 53 – Records

- **Ability to check the health of your resources**
- Each record contains:
    - Domain/subdomain Name – e.g., example.com
    - Record Type – e.g., A or AAAA
    - Value – e.g., 12.34.56.78
    - Routing Policy – how Route 53 responds to queries
    - TTL – amount of time the record cached at DNS Resolvers
- Route 53 supports the following DNS record types:
    - (must know)**A** /AAAA / **CNAME** / **NS**
        - **A:** Map a hostname to IPv4
        - **CNAME:** Map a hostname to another hostname
            - **CNAME을 쓰기보단 Alias를 쓰는 방법이 더 효과적임.**
            - The target is a domain name which must have an A or AAAA record
            - Can’t create a CNAME record for the top node of a DNS namespace (Zone Apex)
            - Example: you can’t create for example.com, but you can create for www.example.com
        - **NS**: Name Servers for the Hosted Zone

### CNAME vs Alias

- **AWS Resources (Load Balancer, CloudFront...) expose an AWS hostname**: lb1-1234.us-east-2.elb.amazonaws.com and you want myapp.mydomain.com
- **CNAME:**
    - **Points a hostname to any other hostname**. (app.mydomain.com => blabla.anything.com)
    - ONLY FOR NON ROOT DOMAIN (aka. something.mydomain.com)
- **Alias:**
    - **Points a hostname to an AWS Resource** (app.mydomain.com => blabla.amazonaws.com)
    - Works for ROOT DOMAIN and NON ROOT DOMAIN (aka mydomain.com)
    - **Free of charge**
    - **Native health check**

### Alias

- AWS Service에 부여된 DomainName을 개인 DomainName으로 변경
- Automatically recognizes changes in the resource’s IP addresses
- Unlike CNAME, it can be used for the top node of a DNS namespace (Zone Apex), e.g.: example.com
- **Alias Record is always of type A/AAAA for AWS resources (IPv4 / IPv6)**
- **You can’t set the TTL**
- **Alias Records Targets**
    - **You cannot set an ALIAS record for an EC2 DNS name**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2054.png)
    

### Route 53 – Hosted Zones

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2055.png)

- **A container for records that define how to route traffic to a domain and its subdomains**
- **Public Hosted Zones** – contains records that specify how to route traffic on the Internet (public domain names) [application1.mypublicdomain.com](http://application1.mypublicdomain.com/)
- **Private Hosted Zones** – contain records that specify how you route traffic within one or more VPCs (private domain names) application1.company.internal
- You pay $0.50 per month per hosted zone

### Route 53 – RecordsTTL (TimeTo Live)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2056.png)

- High TTL – e.g., 24 hr
• Less traffic on Route 53
• Possibly outdated records
- Low TTL – e.g., 60 sec.
• More traffic on Route 53 ($$)
• Records are outdated for less time
• Easy to change records
- **Except for Alias records,TTL is mandatory for each DNS record**

### **Route 53 – Routing Policies**

- **최적의 IP address를 제공하는 방법**
- **Don’t get confused by the word *“Routing”***
    
    • It’s not the same as Load balancer routing which routes the traffic
    • **DNS does not route any traffic, it only responds to the DNS queries**
    
- **Simple**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2057.png)
    
    - **I**f multiple values are returned, a random one is chosen by the client
    - When Alias enabled, specify only one AWS resource
    - Can’t be associated with Health Checks
- **Weighted**
    - Can be associated with Health Checks
    - Assign a weight of 0 to a record to stop sending
    traffic to a resource
    ****
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2058.png)
    
- **Latency based**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2059.png)
    
    - Redirect to the resource that has the least latency close to us
    - Latency is based on traffic between users and AWS
    Regions
    - Can be associated with Health Checks (has a failover
    capability)
- **Failover**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2060.png)
    
- **Geolocation**
    - This routing is based on user location Specify location by Continent, Country or by US State (if there’s overlapping, most precise location selected)
    - Should create a “Default” record (in case there’s no match on location)
    - Can be associated with Health Checks
    ****
- **Geoproximity (using Route 53 Traffic Flow feature)**
    - 균등하게 비중 설정 시
    

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2061.png)

- 왼쪽 0 오른쪽 50 설정 시

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2062.png)

- **IP-based Routing**
    - Routing is based on clients’ IP addresses
    ****
- **Multi-Value Answer**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2063.png)
    
    - Use when routing traffic to multiple resources
    - Multi-Value is not a substitute for having an ELB

### Health Checks

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2064.png)

- **HTTP Health Checks are only for public resources**
- Health Check => Automated DNS Failover:
    1. **Health checks that monitor an endpoint (application, server, other AWS resource)**
        1. **About 15 global health checkers will check the
        endpoint health**
            
            • Healthy/UnhealthyThreshold–3(default)
            • Interval – 30 sec (can set to 10 sec – higher cost)
            Supported protocol:HTTP, HTTPS and TCP
            • If > 18% of health checkers report the endpoint is
            healthy, Route 53 considers it Healthy. Otherwise, it’s Unhealthy
            • Ability to choose which locations you want Route 53 to use
            
        2. **Configure you router/firewall to allow incoming
        requests from Route 53 Health Checkers**
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2065.png)
        
    2. **Health checks that monitor other health
    checks (Calculated Health Checks)**
        1. Combine the results of multiple Health
        Checks into a single Health Check
        2. You can use OR, AND, or NOT
        Can monitor up to 256 Child Health Checks
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2066.png)
        
    3. **Health Checks – Private Hosted Zones**
    
        1. **Route 53 health checkers are outside the
        VPC.**
        2. They can’t access private endpoints
        (private VPC or on-premises resource)
        3. You can create a CloudWatch Metric and
        associate a CloudWatch Alarm, then
        create a Health Check that checks the
        alarm itself
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2067.png)
        

## Beanstalk

- **Elastic Beanstalk is a developer centric view of deploying an application on AWS**
- It uses all the component’s we’ve seen before: EC2, ASG, ELB, RDS, ...
- Managed service
    - Automatically handles capacity provisioning, load balancing, scaling, application health monitoring, instance configuration, ...
    - Just the application code is the responsibility of the developer

### Components

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2068.png)

- **Application:** collection of Elastic Beanstalk components (environments,versions, configurations, ...)
- **Application Version:** an iteration of your application code
- **Environment**
    - Collection of AWS resources running an application version (only one application version at a time)
    - Tiers:
        - WebServerEnvironmentTier
            
            ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2069.png)
            
        - WorkerEnvironmentTier
            
            ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2070.png)
            

## S3

- **Many websites use Amazon S3 as a backbone**

### Use Case

- Backup and storage
- Disaster Recovery
- Archive
- Hybrid Cloud storage
- Application hosting
- Media hosting
- Data lakes & big data analytics
- Software delivery
- Static website

### Buckets

- **Buckets must have a globally unique name (across all regions all accounts)**
- **S3 looks like a global service but buckets are created in a region**

### S3 Object - objects

- Objects (files) have a Key
- **The key is the FULL path:**
    - s3://my-bucket/my_file.txt
    - s3://my-bucket/my_folder1/another_folder/my_file.txt
- The key is composed of prefix + object name
    - s3://my-bucket/my_folder1/another_folder/my_file.txt
- **There’s no concept of “directories” within buckets (although the UI will trick you to think otherwise)**

### S3 Object - Contents

- Object values are the content of the body:
    - Max. Object Size is 5TB (5000GB)
    - **If uploading more than 5GB, must use “multi-part upload”**
- **Metadata** (list of text key / value pairs – system or user metadata)
- **Tags** (Unicode key / value pair – up to 10) – useful for security / lifecycle
- **Version ID** (if versioning is enabled)

### Amazon S3 – Security

- **User-Based**
• IAM Policies – which API calls should be allowed for a specific user from IAM
- **Resource-Based**
• Bucket Policies – bucket wide rules from the S3 console - allows cross account 
• Object Access Control List (ACL) – finer grain (can be disabled)
• Bucket Access Control List (ACL) – less common (can be disabled)
- Note: an IAM principal can access an S3 object if
    - The user IAM permissions ALLOW it **OR** the resource policy ALLOWS it
    - **AND** there’s no explicit DENY
- Encryption: encrypt objects in Amazon S3 using encryption keys

### S3 Bucket Policies

- JSON based policies
• Resources: buckets and objects
• Effect: Allow / Deny
• Actions: Set of API to Allow or Deny
• Principal:The account or user to apply the policy to
- **Use S3 bucket for policy to:**
• Grant public access to the bucket
• Force objects to be encrypted at upload
• Grant access to another account (Cross Account)

### **Public Access - use Bucket Policy**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2071.png)

### **IAM Permssions**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2072.png)

### **IAM Role**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2073.png)

### Bucket settings for Block Public Access

- **These settings were created to prevent company data leaks**
- I**f you know your bucket should never be public, leave these on**
- Can be set at the account level

### Amazon S3 - Versioning

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2074.png)

- You can version your files in Amazon S3
- **Protect against unintended deletes (ability to restore a version)**
- Easy roll back to previous version
- Notes:
    - Any file that is not versioned prior to enabling versioning will have version “null”
    - Suspending versioning does not delete the previous versions

### Amazon S3 – Replication (CRR & SRR)

- Must enable Versioning in source and destination buckets
- **Cross-Region Replication (CRR)**
- **Same-Region Replication (SRR)**
- **Copying is asynchronous**
- Use cases:
    - CRR – compliance, lower latency access, replication across accounts
    - SRR – log aggregation, live replication between production and test accounts

### Amazon S3 – Replication (Notes)

- **After you enable Replication, only new objects are replicated**
- For DELETE operations
    - Can replicate delete markers from source to target (optional setting)
    - Deletions with a version ID are not replicated (to avoid malicious deletes)
- **There is no “chaining” of replication**
    - If bucket 1 has replication into bucket 2, which has replication into bucket 3
    - Then objects created in bucket 1 are not replicated to bucket 3

### S3 Durability and Availability

- **Durability:**
    - High durability (99.999999999%, 11 9’s) of objects across multiple AZ
    - If you store 10,000,000 objects with Amazon S3, you can on average expect to incur a loss of a single object once every 10,000 years
    - Same for all storage classes
- **Availability:**
    - Measures how readily available a service is
    - Varies depending on storage class
    - Example: S3 standard has 99.99% availability = not available 53 minutes a year

### S3 Storage Class Comparision

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2075.png)

- **Amazon S3 Glacier Instant Retrieval**
    - Millisecond retrieval, great for data accessed once a quarter
    - Minimum storage duration of 90 days
- **Amazon S3 Glacier Flexible Retrieval (formerly Amazon S3 Glacier):**
    - Expedited (1 to 5 minutes), Standard (3 to 5 hours), Bulk (5 to 12 hours) – free
    - Minimum storage duration of 90 days
- **Amazon S3 Glacier Deep Archive**
    - for long term storage: - Standard (12 hours), Bulk (48 hours)
    - Minimum storage duration of 180 days

### Amazon S3 – Moving between Storage Classes

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2076.png)

- You can transit objects between storage classes
- **Moving objects can be automated using a Lifecycle Rules**

### Amazon S3 – Lifecycle Rules

- **Transition Actions** – configure objects to transition to another storage class
    - Move objects to Standard IA class 60 days after creation
    - Move to Glacier for archiving after 6 months
- **Expiration actions** – configure objects to expire (delete) after some time
    - Access log files can be set to delete after a 365 days
    - **Can be used to delete old versions of files (if versioning is enabled)**
    - **Can be used to delete incomplete Multi-Part uploads**
- Rules can be created for a certain prefix (example: s3://mybucket/mp3/*)
- Rules can be created for certain objectsTags (example:Department:Finance)

### Amazon S3 Analytics – Storage Class Analysis

- **Help you decide when to transition objects to the right storage class**
- Recommendations for Standard and Standard IA
- Does NOT work for One-Zone IA or Glacier
- Report is updated daily
- **Good first step to put together Lifecycle Rules (or improve them)!**

### **S3 – Requester Pays**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2077.png)

### S3 Event Notifications

- **S3:ObjectCreated, S3:ObjectRemoved, S3:ObjectRestore, S3:Replication...**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2078.png)

### **S3 Event Notifications with Amazon EventBridge**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2079.png)

- S3 event가 있음에도 Eventbridge를 쓰는 이유
    - **Advanced filtering options with JSON rules** (metadata, object size, name...)
    - **Multiple Destinations** – ex Step Functions, Kinesis Streams / Firehose...
    - **EventBridge Capabilities** – Archive, Replay Events, Reliable delivery

### **S3 – Baseline Performance**

- Amazon S3 automatically scales to high request rates, latency 100-200 ms
- **Your application can achieve at least 3,500 PUT/COPY/POST/DELETE** **5,500 GET/HEAD requests per second per prefix in a bucket.**

### S3 Performance

- **Multi-Part upload:**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2080.png)
    
    - recommended for files > 100MB, must use for files > 5GB
    - Can help parallelize uploads (speed up transfers)
- **S3 Transfer Acceleration**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2081.png)
    
    - I**ncrease transfer speed by transferring file to an AWS edge location which will forward the data to the S3 bucket in the target region**
    - Compatible with multi-part upload
- **S3 Byte-Range Fetches**
    - Parallelize GETs by requesting specific byte ranges
    - Better resilience in case of failures
    - Can be used to speed up downloads
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2082.png)
        
    - Can be used to retrieve only partial data (for example the head of a file)
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2083.png)
        

### **S3 Select & Glacier Select**

- Retrieve less data using SQL by performing server-side filtering
- **Can filter by rows & columns (simple SQL statements)**
- Less network transfer, less CPU cost client-side
- Chat-GPT : S3 Select works by using a combination of server-side filtering and projection to filter and transform data directly on the server, before sending the results back to the client. This can help to reduce the amount of data that needs to be transferred over the network, and can help to improve the performance of your applications by reducing the amount of processing that needs to be done on the client side.

### S3 Batch Operations

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2084.png)

- S3 작업을 일정부분 자동화하기 위한 방법
- Perform bulk operations on existing S3 objects with a single request, example:
    - Modify object metadata & properties
    - Copy objects between S3 buckets
    - Encrypt un-encrypted objects
    - ModifyACLs,tags
    - Restore objects from S3 Glacier
    - Invoke Lambda function to perform custom action on
- S3 Batch Operations manages retries, tracks progress, sends completion notifications, generate reports ...
- You can use S3 Inventory to get object list and use S3 Select to filter your objects
- Chat-GPT : With S3 Inventory, you can generate reports that list the metadata for all objects in a bucket, including object size, storage class, creation time, and other attributes. This information can be used for a variety of purposes, such as compliance reporting, security audits, and performance analysis.

## S3 - Security

1. **Server-Side Encryption with Amazon S3-Managed Keys (SSE-S3) – Enabled by Default**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2085.png)
    
    - **Encryption using keys handled, managed, and owned by AWS**
    - Encryption type is AES-256
    - Must set header "x-amz-server-side-encryption": "AES256"
    - **SSE-S3 encryption is automatically applied to new objects stored in S3 bucket**
2. **Server-Side Encryption with KMS Keys stored in AWS KMS (SSE-KMS)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2086.png)
    
    - **Encryption using keys handled and managed by AWS KMS (Key Management Service)**
    - KMS advantages: user control + audit key usage using CloudTrail
    - Must set header "x-amz-server-side-encryption": "aws:kms"
    - **SSE-KMS Limitation**
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2087.png)
        
        - If you use SSE-KMS, you may be impacted by the KMS limits
        - When you upload, it calls the GenerateDataKey KMS API
        - When you download, it calls the Decrypt KMS API
3. **Server-Side Encryption with Customer-Provided Keys (SSE-C)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2088.png)
    
    - **Server-Side Encryption using keys fully managed by the customer outside of AWS**
    - Amazon S3 does NOT store the encryption key you provide
    - HTTPS must be used
    - **Encryption key must provided in HTTP headers, for every HTTP request made**
4. **Client-Side Encryption**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2089.png)
    
    - **Use client libraries such as Amazon S3 Client-Side Encryption Library**
    - **Clients must encrypt data themselves before sending to Amazon S3**
    - Clients must decrypt data themselves when retrieving from Amazon S3
    - Customer fully manages the keys and encryption cycle
    

### CORS - Cross-Origin Resource Sharing

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2090.png)

- **Origin = scheme (protocol) + host (domain) + port**
    - example: [https://www.example.com](https://www.example.com/) (implied port is 443 for HTTPS, 80 for HTTP)
    - Web Browser based mechanism to allow requests to other origins while
    - Same origin: [**http://example.com/**app1](http://example.com/app1) & [**http://example.com/**app2](http://example.com/app2)
    - Different origins: [http://**www.**example.com](http://www.example.com/) & [http://**other**.example.com](http://other.example.com/)
- **The requests won’t be fulfilled unless the other origin allows for the requests, using CORS Headers (example: Access-Control-Allow-Origin)**

### **Amazon S3 – CORS**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2091.png)

- **If a client makes a cross-origin request on our S3 bucket, we need to enable the correct CORS headers**
- You can allow for a specific origin or for * (all origins)

### S3- MFA

- MFA (Multi-Factor Authentication) – force users to generate a code on a device (usually a mobile phone or hardware) before doing important operations on S3
- **MFA will be required to:**
    - **Permanently delete an object version**
    - **Suspend Versioning on the bucket**
- MFA won’t be required to:
    - Enable Versioning
    - List deleted versions
- **To use MFA Delete, Versioning must be enabled on the bucket**
- Only the bucket owner (root account) can enable/disable MFA Delete

### S3 Access Logs

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2092.png)

- **For audit purpose, you may want to log all access to S3 buckets**
- Any request made to S3, from any account, authorized or denied, will be logged into another S3 bucket
- That data can be analyzed using data analysis tools...
- **The target logging bucket must be in the same AWS region**
- **Do not set your logging bucket to be the monitored bucket**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2093.png)
    
    - **It will create a logging loop, and your bucket will grow exponentially**

### Amazon S3 – Pre-Signed URLs

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2094.png)

- Generate pre-signed URLs using the S3 Console, AWS CLI or SDK
- URL Expiration
    - S3 Console – 1 min up to 720 mins (12 hours)
    - AWS CLI – configure expiration with --expires-in parameter in seconds (default 3600 secs, max. 604800 secs ~ 168 hours)
- **Users given a pre-signed URL inherit the permissions of the user that generated the URL for GET / PUT**
- Examples:
    - **Allow only logged-in users to download a premium video from your S3 bucket**
    - Allow an ever-changing list of users to download files by generating URLs dynamically
    - **Allow temporarily a user to upload a file to a precise location in your S3 bucket**

### S3 Glacier Vault Lock

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2095.png)

- **Adopt a WORM (Write Once Read Many) model**
- Create a Vault Lock Policy
- Lock the policy for future edits
(can no longer be changed or deleted)
- Helpful for compliance and data retention

### S3 Object Lock (versioning must be enabled)

- **Adopt a WORM (Write Once Read Many) model**
- Block an object version deletion for a specified amount of time
- **Retention mode - Compliance:**
    - **Object versions can't be overwritten or deleted by any user, including the root user**
    - Objects retention modes can't be changed, and retention periods can't be shortened
- **Retention mode - Governance:**
    - **Most users can't overwrite or delete an object version or alter its lock settings**
    - **Some users have special permissions to change the retention or delete the object**
- **Retention Period:** protect the object for a fixed period, it can be extended
- **Legal Hold:**
    - protect the object indefinitely, independent from retention period
    - can be freely placed and removed using the s3:PutObjectLegalHold IAM permission

### **S3 – Access Points**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2096.png)

- **Access Points simplify security management for S3 Buckets**
- Each Access Point has:
    - **its own DNS name (Internet Origin or VPC Origin)**
    - an access point policy (similar to bucket policy) – manage security at scale
- **VPC Origin**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2097.png)
    
    - **We can define the access point to be accessible only from within the VPC**
    - You must create a VPC Endpoint to access the Access Point (Gateway or Interface Endpoint)
    - The VPC Endpoint Policy must allow access to the target bucket and Access Point

### S3 Object Lambda

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2098.png)

- **Use AWS Lambda Functions to change the object before it is retrieved by the caller application**
- **Only one S3 bucket is needed, on top of which we create S3 Access Point and S3 Object Lambda Access Points.**
- **Use Cases:**
    - Redacting personally identifiable information for analytics or non-production environments.
    - Converting across data formats,such as converting XML to JSON.
    - Resizing and watermarking images on the fly using caller-specific details, such as the user who requested the object.

## Global Infrastructure

### Amazon CloudFront

- Content Delivery Network (CDN)
- Improves read performance, c**ontent is cached at the edge**
- 216 Point of Presence globally (edge locations)
- **DDoS protection (because worldwide), integration with Shield, AWS Web Application Firewall**

### CloudFront – Origins

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2099.png)

- **S3 bucket**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20100.png)
    
    - **For distributing files and caching them at the edge**
    - **Enhanced security with CloudFront Origin Access Control (OAC)**
    - CloudFront can be used as an ingress (to upload files to S3)
- **CloudFront vs S3 Cross Region Replication**
    - CloudFront:
        - **Global Edge network**
        - Files are cached for a TTL (maybe a day)
        - Great for static content that must be available everywhere
    - Cross Region Replication:
        - **Must be setup for each region you want replication to happen**
        - Files are updated in near real-time
        - Read only
        - Great for dynamic content that needs to be available at low-latency in few regions
- **Custom Origin (HTTP)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20101.png)
    
    - Application Load Balancer
    - EC2 instance
    - S3 website (must first enable the bucket as a static S3 website)
    - Any HTTP backend you want

### CloudFront Geo Restriction

- **You can restrict who can access your distribution**
    - **Allowlist:** Allow your users to access your content only if they're in one of the countries on a list of approved countries.
    - **Blocklist:** Prevent your users from accessing your content if they're in one of the countries on a list of banned countries.
- The “country” is determined using a 3rd party Geo-IP database
- Use case: Copyright Laws to control access to content

### CloudFront – Price Classes

- You can reduce the number of edge locations for cost reduction
    - Three price classes:
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20102.png)
        
    1. Price Class All: all regions – best performance
    2. Price Class 200: most regions, but excludes the most expensive regions
    3. Price Class 100: only the least expensive regions

### CloudFront -Cache Invalidations(캐시 무효화)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20103.png)

- **In case you update the back-end origin, CloudFront doesn’t know about it and will only get the refreshed content after the TTL has expired**
- **However, you can force an entire or partial cache refresh (thus bypassing the TTL) by performing a CloudFront Invalidation**

### Unicast IP vs Anycast IP

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20104.png)

- **Unicast IP:** one server holds one IP address Client
- **Anycast IP: all servers hold the same IP address and the client is routed to the nearest one**

### AWS Global Accelerator

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20105.png)

- **Leverage the AWS internal network to route to your application**
- 2 Anycast IP are created for your application
- The Anycast IP send traffic directly to Edge Locations
- The Edge locations send the traffic to your application
- **Global Accelerator Works with Elastic IP, EC2 instances, ALB, NLB, public or private**
- **Consistent Performance**
    - **Intelligent routing to lowest latency and fast regional failover**
    - **Internal AWS network**
- **Health Checks**
    - **Global Accelerator performs a health check of your applications**
    - Helps make your application global (failover less than 1 minute for unhealthy)
    - Great for disaster recovery (thanks to the health checks)
- **Security**
    - **only 2 external IP need to be whitelisted**
    - **DDoS protection thanks to AWS Shield**

### AWS Global Accelerator vs CloudFront

- They both use the AWS global network and its edge locations around the world
- **Both services integrate with AWS Shield for DDoS protection.**
- Both Cloudfront & Global Accelerator have Health Check.
- **CloudFront**
    - **Content is served at the edge**
    - **Improves performance for both cacheable content (such as images and videos)**
    - **Dynamic content(such as API acceleration and dynamic site delivery)**
- **Global Accelerator**
    - **Proxying packets at the edge to applications running in one or more AWS Regions.**
    - Improves performance for a wide range of applications over TCP or UDP

## **Advanced Storage on AWS**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20106.png)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20107.png)

### Snowball Edge (for data transfers)

- **Physical data transport solution:move TBs or PBs of data in or out of AWS**
- Pay per data transfer job
- Provide block storage and Amazon S3-compatible object storage
- **Snowball Edge Storage Optimized**
    - **80 TB of HDD capacity for block volume and S3 compatible object storage**
- **Snowball Edge Compute Optimized**
    - 42 TB of HDD or 28TB NVMe capacity for block volume and S3 compatible object storage
- **Use cases: large data cloud migrations, disaster recovery**

### AWS Snowcone & Snowcone SSD

- **Small, portable computing, anywhere, rugged & secure, withstands harsh environments**
- Device used for edge computing, storage, and data
transfer
- Use Snowcone where Snowball does not fit (space- constrained environment)
- **Can be sent back to AWS offline, or connect it to
internet and use AWS DataSync to send data**

### AWS Snowmobile

- Transfer exabytes of data (1 EB = 1,000 PB = 1,000,000 TBs)
- Each Snowmobile has 100 PB of capacity (use multiple in parallel)
- High security: temperature controlled, GPS, 24/7 video surveillance - Better than Snowball if you transfer more than 10 PB

### What is Edge Computing?

- **Process data while it’s being created on an edge location**
    - **A truck on the road,a ship on the sea,a mining station underground**
- **These locations may have**
    - Limited / no internet access
    - Limited / no easy access to computing power
- **We setup a Snowball Edge / Snowcone device to do edge computing**
- **Use cases of Edge Computing:**
    - Preprocess data
    - Machine learning at the edge
    - Transcoding media streams
- **Eventually (if need be) we can ship back the device to AWS (for transferring data for example)**

### Snow Family – Edge Computing

- **Snowcone & Snowcone SSD (smaller)**
    - 2 CPUs, 4 GB of memory, wired or wireless access - USB-C power using a cord or the optional battery
- **Snowball Edge – Compute Optimized**
    - 104 vCPUs, 416 GiB of RAM
    - Optional GPU (useful for video processing or machine learning) - 28 TB NVMe or 42TB HDD usable storage
- **Snowball Edge – Storage Optimized**
    - Upto 40 vCPUs,80 GiB of RAM, 80TBstorage
    - Object storage clustering available
- All: Can run EC2 Instances & AWS Lambda functions (using AWS IoT Greengrass)
- Long-term deployment options: 1 and 3 years discounted pricing

### AWS OpsHub

- Historically, to use Snow Family devices, you needed a CLI (Command Line Interface tool)
- Today, you can use AWS OpsHub (a software you install on your computer / laptop) to manage your Snow Family Device

### Solution Architecture: Snowball into Glacier

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20108.png)

- **Snowball cannot import to Glacier directly**
- **You must use Amazon S3 first, in combination with an S3 lifecycle policy**

### Amazon FSx

- **Launch 3rd party high-performance file systems on AWS**

### Amazon FSx for Windows (File Server)

- FSx for Windows is a fully managed Windows file system share drive
- **Supports SMB protocol & Windows NTFS**
- Microsoft Active Directory integration,ACLs,user quotas
- **Can be mounted on Linux EC2 instances**
- Supports Microsoft's Distributed File System (DFS) Namespaces (group files across multiple FS)
- Scale up to 10s of GB/s, millions of IOPS, 100s PB of data
- Storage Options:
    - SSD – latency sensitive workloads (databases, media processing, data analytics, ...)
    - HDD – broad spectrum of workloads (home directory, CMS, ...)
- **Can be accessed from your on-premises infrastructure (VPN or Direct Connect)**
- Can be configured to be Multi-AZ (high availability)
- **Data is backed-up daily to S3**

### Amazon FSx for Lustre

- Lustre is a type of parallel distributed file system, for large-scale computing
- The name Lustre is derived from “Linux” and “cluster
- **Machine Learning, High Performance Computing (HPC)**
- Video Processing, Financial Modeling, Electronic Design Automation
- Scales up to 100s GB/s, millions of IOPS, sub-ms latencies
- Storage Options:
    - SSD – low-latency, IOPS intensive workloads, small & random file operations
    - HDD – throughput-intensive workloads, large & sequential file operations
- S**eamless integration with S3**
    - Can “read S3” as a file system (through FSx)
    - Can write the output of the computations back to S3 (through FSx)
- Can be used from on-premises servers (VPN or Direct Connect)

### FSx Lustre - File System Deployment Options

- **Scratch File System - short-term processing**
    - **Temporary storage**
    - **Data is not replicated (doesn’t persist if file server fails)**
    - **High burst (6x faster, 200MBps per TiB)**
    - Usage: short-term processing, optimize
    costs
- **Persistent File System - long-term processing**
    - **Long-term storage**
    - **Data is replicated within same AZ**
    - Replace failed files within minutes
    - Usage: long-term processing, sensitive data

### Amazon FSx for NetApp ONTAP

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20109.png)

- Managed NetApp ONTAP on AWS
- **File System compatible with NFS, SMB, iSCSI protocol**
- Move workloads running on ONTAP or NAS to AWS
- Works with:
    - Linux
    - Windows
    - MacOS
    - VMware Cloud on AWS
    - Amazon Workspaces & AppStream 2.0
    - Amazon EC2, ECS and EKS
- Storage shrinks or grows automatically
- Snapshots,replication,low-cost,compression and data
- **Point-in-time instantaneous cloning (helpful for testing new workloads)**

### Amazon FSx for OpenZFS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20110.png)

- Managed OpenZFS file system on AWS
- **File System compatible with NFS (v3, v4, v4.1, v4.2)**
- Move workloads running on ZFS to AWS
- Works with:
    - Linux
    - Windows
    - MacOS
    - VMware Cloud on AWS
- **Up to 1,000,000 IOPS with < 0.5ms latency**
- Snapshots, compression and low-cost
- **Point-in-time instantaneous cloning (helpful for testing new workloads)**

### Hybrid Cloud for Storage

- **”hybrid cloud” - Part of your infrastructure is on the cloud - Part of your infrastructure is on-premises**
- **This can be due to**
    - Long cloud migrations
    - Security requirements
    - Compliance requirements
    - IT strategy
- **S3 is a proprietary storage technology (unlike EFS / NFS), so how do you expose the S3 data on-premises?**
    - **AWS Storage Gateway! - S3와 FSx를 On-premise에 연결**

### AWS Gateway

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20111.png)

### AWS Storage Gateway

- **Bridge between on-premises data and cloud data**
- Use cases:
    - disaster recovery
    - backup & restore
    - tiered storage
    - on-premises cache & low-latency files access
- **Type of Storage Gateway - S3 File Gateway**
    - **Configured S3 buckets are accessible using the NFS and SMB protocol**
    - **Most recently used data is cached in the file gateway**
    - Supports S3 Standard, S3 StandardIA, S3 OneZoneA, S3 IntelligentTiering
    - **Transition to S3 Glacier using a Lifecycle Policy**
    - SMB Protocol has integration with Active Directory (AD) for user authentication
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20112.png)
    
- **Type of Storage Gateway - FSx File Gateway**
    - Native access to Amazon FSx for Windows File Server
    - **Local cache for frequently accessed data**
    - Windows native compatibility (SMB, NTFS, Active Directory...)
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20113.png)
    
- **Type of Storage Gateway - Volume Gateway**
    - **Block storage using iSCSI protocol backed by S3**
    - **Backed by EBS snapshots which can help restore on-premises volumes!**
    - **Cached volumes: low latency access to most recent data**
    - **Stored volumes: entire dataset is on premise, scheduled backups to S3**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20114.png)
    
- **Tape Gateway**
    - Some companies have backup processes using physical tapes (!)
    - With Tape Gateway, companies use the same processes but, in the cloud - VirtualTape Library (VTL) backed by Amazon S3 and Glacier
    - Back up data using existing tape-based processes (and iSCSI interface)
    - Works with leading backup software vendors
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20115.png)
    
- **Hardware Appliance**
    - **Using Storage Gateway means you need on-premises virtualization**
    - Otherwise, you can use a Storage Gateway Hardware Appliance
    - Works with File Gateway,Volume Gateway,
    - Has the required CPU, memory, network, SSD cache resources
    - Helpful for daily NFS backups in small data centers
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20116.png)
    
    ### AWS Transfer Familiy - S3 & EFS
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20117.png)
    
    - **A fully-managed service for file transfers into and out of Amazon S3 or Amazon EFS using the FTP protocol**
    - Supported Protocols
        - AWS Transfer for FTP (File Transfer Protocol (FTP))
        - AWS Transfer for FTPS (File Transfer Protocol over SSL (FTPS))
        - AWS Transfer for SFTP (Secure File Transfer Protocol (SFTP))
    - Managed infrastructure, Scalable, Reliable, Highly Available (multi-AZ)
    - Store and manage users’ credentials within the service
    - Integrate with existing authentication systems (Microsoft Active Directory, LDAP, Okta, Amazon Cognito, custom)
    - Usage: sharing files, public datasets, CRM, ERP, ...
    
    ### AWS DataSync - S3, FSx, EFS(Not EBS)
    
    - **Move large amount of data to and from**
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20118.png)
        
        - On-premises / other cloud to AWS (NFS, SMB, HDFS, S3 API...) – needs agent
        - AWS to AWS (different storage services) – no agent needed
    - **Replication tasks can be scheduled hourly, daily, weekly**
    - File permissions and metadata are preserved (NFS POSIX, SMB...)
    - One agent task can use 10 Gbps, can setup a bandwidth limit
    - **Can synchronize to:**
        
        ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20119.png)
        

## **AWS Integration & Messaging**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20120.png)

### Amazon SQS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20121.png)

### SQS – Producing Messages

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20122.png)

- **Produced to SQS using the SDK (SendMessage API)**
- **The message is persisted in SQS until a consumer deletes it**
- Message retention: default 4 days, up to 14 days
- Example: send an order to be processed
    - Order id
    - Customer id
    - Any attributes you want
- SQS standard: unlimited throughput

### SQS – Consuming Messages

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20123.png)

- **Consumers (running on EC2 instances, servers, or AWS Lambda)...**
- **Poll SQS for messages (receive up to 10 messages at a time)**
- **Delete the messages using the DeleteMessage API**

### SQS – Multiple EC2 Instances Consumers

- **SQS with Auto Scaling Group (ASG)**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20124.png)

- **SQS to decouple between application tiers**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20125.png)

- **Consumers receive and process messages in parallel** At least once delivery
- Best-effort message ordering
- **Consumers delete messages after processing them**
- We can scale consumers horizontally to improve throughput of processing

### Amazon SQS - Security

- **Encryption:**
    - In-flight encryption using HTTPS API
    - At-rest encryption using KMS keys
    - Client-side encryption if the client wants to perform encryption/decryption itself
- **Access Controls:** IAM policies to regulate access to the SQS API
- **SQS Access Policies (similar to S3 bucket policies)**
    - Useful for cross-account access to SQS queues
    - Useful for allowing other services (SNS, S3...) to write to an SQS queue

### SQS – Message Visibility Timeout

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20126.png)

- After a message is polled by a consumer, it becomes invisible to other consumers
- By default, the “message visibility timeout” is 30 seconds
- That means the message has 30 seconds to be processed
- After the message visibility timeout is over, the message is “visible” in SQS
- **If a message is not processed within the visibility timeout, it will be processed twice**
- **A consumer could call the ChangeMessageVisibility API to get more time**
- If visibility timeout is high (hours), and consumer crashes, re-processing will take time
- If visibility timeout is too low (seconds), we may get duplicates

### Amazon SQS - Long Polling

- **When a consumer requests messages from the queue, it can optionally “wait” for messages to arrive if there are none in the queue**
- **LongPolling decreases the number of API calls made to SQS while increasing the efficiency and reducing latency of your application**
- The wait time can be between 1 sec to 20 sec (20 sec preferable)
- Long Polling is preferable to Short Polling
- Long polling can be enabled at the queue level
or at the API level using WaitTimeSeconds

### Amazon SQS – FIFO Queue

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20127.png)

- FIFO = First In First Out (ordering of messages in the queue)
- **Limited throughput: 300 msg/s without batching, 3000 msg/s with batching**
- Exactly-once send capability (by removing duplicates)
- **Messages are processed in order by the consumer**

### SQS as a buffer for database writes

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20128.png)

### Amazon SNS

- **Pub / Sub Pattern**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20129.png)

- The “event producer” only sends message to one SNS topic
- As many “event receivers” (subscriptions) as we want to listen to the SNS topic notifications
- **Each subscriber to the topic will get all the messages (note: new feature to filter messages)**
- Up to 12,500,000 subscriptions per topic
- 100,000 topics limit

### Amazon SNS – How to publish

- **Topic Publish (using the SDK)**
    - Create a topic
    - Create a subscription (or many)
    - Publish to the topic
- **Direct Publish (for mobile apps SDK)**
    - Create a platform application
    - Create a platform endpoint
    - Publish to the platform endpoint
    - Works with Google GCM, Apple APNS, Amazon ADM...

### Amazon SNS – Security

- **Encryption:**
    - In-flight encryption using HTTPS API
    - At-rest encryption using KMS keys
    - Client-side encryption if the client wants to perform encryption/decryption itself
- **Access Controls:** IAM policies to regulate access to the SNS API
- **SNS Access Policies (similar to S3 bucket policies)**
    - Useful for cross-account access to SNS topics
    - **Useful for allowing other services ( S3...) to write to an SNS topic**

### SNS + SQS: Fan Out

- **Fanout - Chat GPT**
    
    In computer science and distributed systems, the fanout pattern is a messaging pattern where a message is broadcast to multiple recipients simultaneously. The term "fanout" refers to the branching out of a message as it is distributed to multiple recipients, much like the branches of a fan.
    
    In this pattern, a sender sends a single message to a message broker or message queue, which then distributes the message to multiple receivers. Each receiver consumes the message independently, and the sender is not aware of the number of receivers or their identities.
    
    The fanout pattern is commonly used in publish-subscribe messaging systems, where a message is published to a topic and is delivered to all subscribers who have subscribed to that topic. It can also be used in other messaging scenarios where a message needs to be delivered to multiple recipients in a scalable and efficient manner.
    

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20130.png)

- **Push once in SNS, receive in all SQS queues that are subscribers**
- Fully decoupled, no data loss

### Application: S3 Events to multiple queues

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20131.png)

- **If you want to send the same S3 event to many SQS queues, use fan-out**

### Application: SNS to Amazon S3 through Kinesis Data Firehose

- **SNS can send to Kinesis and therefore we can have the following solutions architecture:**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20132.png)
    

### FIFO Topic

- FIFO = First In First Out (ordering of messages in the topic)
- Similar features as SQS FIFO:
    - Ordering by Message Group ID (all messages in the same group are ordered)
    - Deduplication using a Deduplication ID or Content Based Deduplication
- **Can only have SQS FIFO queues as subscribers**
- Limited throughput (same throughput as SQS FIFO)

### Message Filtering

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20133.png)

### Kinesis Data Streams

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20134.png)

- **Stream Data Storage라고 보는게 좋을 듯**
- **개별 Shard에 Partition Key와 DataBlob으로 구성 된 Record를 저장한다.**
- Retention between 1 day to 365 days
- Ability to reprocess (replay) data
- Once data is inserted in Kinesis, it can’t be deleted (immutability)
- Data that shares the same partition goes to the same shard (ordering)
- **Producers: AWS SDK, Kinesis Producer Library (KPL), Kinesis Agent**
- **Consumers:**
    - Write your own: Kinesis Client Library (KCL), AWS SDK
    - Managed: AWS Lambda, Kinesis Data Firehose, Kinesis Data Analytics,

### Kinesis Data Streams – Capacity Modes

- **Provisioned mode:**
    - You choose **the number of shards** provisioned, scale manually or using API
    - **Each shard gets 1MB/s in (or 1000 records per second)**
    - **Each shard gets 2MB/s out (classic or enhanced fan-out consumer)**
    - You pay per shard provisioned per hour
- **On-demand mode:**
    - No need to provision or manage the capacity
    - **Default capacity provisioned (4 MB/s in or 4000 records per second)**
    - Scales automatically based on observed throughput peak during the last 30 days
    - Pay per stream per hour & data in/out per GB

### Kinesis Data Streams Security

- Control access / authorization using IAM policies
- Encryption in flight using HTTPS endpoints
- Encryption at rest using KMS
- You can implement encryption/decryption of data on client side (harder)
- **VPC Endpoints(Interface) available for Kinesis to access within VPC**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20135.png)
    
- Monitor API calls using CloudTrail

### Kinesis Firehose

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20136.png)

- **ETL 서비스**
- **주로 Kinesis Data Stream에 저장된 Record를 ETL하여 필요한 서비스에 저장한다.**
- Fully Managed Service, no administration, automatic scaling, serverless
    - AWS: Redshift / Amazon S3 / OpenSearch
    - 3rd party partner: Splunk / MongoDB / DataDog / NewRelic / ...
    - Custom: send to any HTTP endpoint
- **Near Real Time**
    - **60 seconds latency minimum for non full batches**
    - **Or minimum 1MB of data at a time**
- Supports custom data transformations using AWS Lambda
- **Can send failed or all data to a backup S3 bucket**

### Kinesis Data Streams vs Firehose

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20137.png)

### Ordering data into kinesis

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20138.png)

- **The same key will always go to the same shard**
- Imagine you have 100 trucks (truck_1, truck_2, ... truck_100) on the road sending their GPS positions regularly into AWS.
- You want to consume the data in order for each truck, so that you can track their movement accurately.
- How should you send that data into Kinesis?
- Answer : send using a “Partition Key” value of the “truck_id”

### Ordering data into SQS

- For SQS standard, there is no ordering.
- For SQS FIFO, if you don’t use a Group ID, messages are consumed in the order they are sent, with only one consumer
- You want to scale the number of consumers, but you want messages to be “grouped” when they are related to each other
- Then you use a Group ID (similar to Partition Key in Kinesis)

### **Kinesis vs SQS ordering**

- **Kinesis Data Streams:**
    - On average you’ll have 20 trucks per shard
    - Trucks will have their data ordered within each shard
    - The maximum amount of consumers in parallel we can have is 5
    - Can receive up to 5 MB/s of data
- **SQS FIFO**
    - You only have one SQS FIFO queue
    - You will have 100 Group ID
    - You can have up to 100 Consumers (due to the 100 Group ID)
    - You have up to 300 messages per second (or 3000 if using batching)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20139.png)

### Amazon MQ

- SQS, SNS are “cloud-native” services: proprietary protocols from AWS
- **Traditional applications running from on-premises may use open protocols such as:MQTT,AMQP,STOMP,Openwire,WSS**
- When migrating to the cloud, instead of re-engineering the application to use SQS and SNS, we can use Amazon MQ
- **Amazon MQ is a managed message broker service for**
- Amazon MQ doesn’t “scale” as much as SQS / SNS
- Amazon MQ runs on servers, can run in Multi-AZ with failover
- Amazon MQ has both queue feature (~SQS) and topic features (~SNS)

### Amazon MQ - High Availability

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20140.png)

## AWS Container

### Docker vs Virtual Machines

- **Docker : Resources are shared with the host => many containers on one server**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20141.png)

### Amazon ECS - EC2 Launch Type

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20142.png)

- **EC2 Launch Type: you must provision & maintain the infrastructure (the EC2 instances)**
- **Each EC2 Instance must run the ECS Agent to register in the ECS Cluster**
- AWS takes care of starting / stopping containers

### Amazon ECS – Fargate Launch Type

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20143.png)

- **You do not provision the infrastructure (no EC2 instances to manage)**
- It’s all Serverless!
- AWS just runs ECSTasks for you based on the CPU / RAM you need
- To scale, just increase the number of tasks.

### Amazon ECS – IAM Roles for ECS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20144.png)

- **Instance Profile 과 Task Role 차이를 이해하자**
- EC2 Instance Profile **(EC2 Launch Type only)**:
    - Used by the ECS agent
    - Makes API calls to ECS service ECR
    - Send container logs to CloudWatch Logs
    - Pull Docker image from ECR
    - Reference sensitive data in Secrets Manager or SSM Parameter Store
- **ECSTask Role:**
    - Allows each task to have a specific role
    - Use different roles for the different ECS Services you run
    - **Task Role is defined in the task definition**

### Amazon ECS – Load Balancer Integrations

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20145.png)

- **Application Load Balancer** supported and works for most use cases
- Network Load Balancer recommended only for high throughput / high performance use cases, or **to pair it with AWS Private Link**

### Amazon ECS – Data Volumes (EFS)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20146.png)

- **Mount EFS file systems onto ECS tasks**
- Works for both EC2 and Fargate launch types
- Tasks running in any AZ will share the same data in the EFS file system
- Fargate + EFS = Serverless
- Use cases: persistent multi-AZ shared storage for
your containers
- **Note: Amazon S3 cannot be mounted as a file system**

### ECS Service Auto Scaling

- Automatically increase/decrease the desired number of ECS tasks
- **Amazon ECS Auto Scaling uses AWS Application Auto Scaling**
    - ECS Service Average CPU Utilization
    - ECS Service Average Memory Utilization-Scale on RAM
    - ALB Request Count Per Target–metric coming from the ALB
- **Target Tracking** – scale based on target value for a specific CloudWatch metric
- **Step Scaling** – scale based on a specified CloudWatch Alarm
- **Scheduled Scaling** – scale based on a specified date/time (predictable changes)
- **ECS Service Auto Scaling (task level) ≠ EC2 Auto Scaling (EC2 instance level)**
    - **ECS Service Auto Scaling = Task(=container) Auto scaling**
    - **ECS Capacity provider = EC2(=Instance) Auto Scaling**
- **Fargate Auto Scaling is much easier to setup (because Serverless)**

### EC2 Launch Type – Auto Scaling EC2 Instances

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20147.png)

- Accommodate ECS Service Scaling by adding underlying EC2 Instances
- **Auto Scaling Group Scaling**
    - Scale your ASG based on CPU Utilization
    - Add EC2 instances over time
- **ECS Cluster Capacity Provider**
    - Used to automatically provision and scale the infrastructure for your ECSTasks
    - Capacity Provider paired with an Auto Scaling Group
    - Add EC2 Instances when you’re missing capacity (CPU, RAM...)

### Arichtecture
****

- **ECS tasks invoked by Event Bridge**
    - ETL이라 보면 될 듯.
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20148.png)
    
- **ECS tasks invoked by Event Bridge Schedule**
    - Batch Processing
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20149.png)
    
- **ECS – SQS Queue Example**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20150.png)
    

### Amazon ECR

- ECR = Elastic Container Registry
- **Store and manage Docker images on AWS**
- Private and Public repository (Amazon ECR Public Gallery [https://gallery.ecr.aws](https://gallery.ecr.aws/))
- Fully integrated with ECS, backed by Amazon S3
- Access is controlled through IAM (permission
errors => policy)

### Amazon EKS Overview

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20151.png)

- Amazon EKS = Amazon Elastic Kubernetes Service
- It’s an alternative to ECS, similar goal but different API
- **EKS supports EC2 if you want to deploy worker nodes or Fargate to deploy serverless containers**
- Use case: if your company is already using Kubernetes on-premises or in another cloud, and wants to migrate to AWS using Kubernetes
- Kubernetes is cloud-agnostic (can be used in any cloud – Azure, GCP...)
- **For multiple regions, deploy one EKS cluster per region**
- Collect logs and metrics using CloudWatch Container Insights

### Amazon EKS – Node Types

- **Managed Node Groups**
    - Creates and manages Nodes (EC2 instances) for you
    - Nodes are part of an ASG managed by EKS - Supports On-Demand or Spot Instances
- **Self-Managed Nodes**
    - Nodes created by you and registered to the EKS cluster and managed by an ASG
    - You can use prebuilt AMI - Amazon EKS Optimized AMI
    - Supports On-Demand or Spot Instances
- **AWS Fargate**
    - No maintenance required; no nodes managed

### Amazon EKS – Data Volumes

- Need to specify StorageClass manifest on your EKS cluster
- Leverages a Container Storage Interface (CSI) compliant driver
- Support for...
    - Amazon EBS
    - Amazon EFS (works with Fargate)
    - Amazon FSx for Lustre
    - Amazon FSx for NetApp ONTAP

### AWS App Runner

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20152.png)

- **Fully managed service that makes it easy to deploy web applications and APIs at scale**
- **No infrastructure experience required**
- Start with your source code or container image
- Automatically builds and deploy the web app
- Automatic scaling, highly available, load balancer, encryption
- VPC access support
- Connect to database, cache, and message queue services
- Use cases: web apps, APIs, microservices, rapid production deployments

## Serverless

### Severless AWS Service

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20153.png)

- AWS Lambda, DynamoDB, AWS Cognito
- AWS API Gateway, Amazon S3, AWS SNS & SQS
- AWS Kinesis Data Firehose, Aurora Serverless,
- Step Functions, Fargate

### Benefits of AWS Lambda

- Scaling is automated!
- **Easy Pricing:**
    - **Pay per request and compute time**
- **Integrated with the whole AWS suite of services**

### AWS Lambda Pricing: example

- You can find overall pricing information here:
[https://aws.amazon.com/lambda/pricing/](https://aws.amazon.com/lambda/pricing/)
- **Pay per calls:**
    - First 1,000,000 requests are free
    - $0.20 per 1 million requests thereafter ($0.0000002 per request)
- Pay per duration: (in increment of 1 ms)
    - 400,000 GB-seconds of compute time per month for FREE - == 400,000 seconds if function is 1GB RAM
    - == 3,200,000 seconds if function is 128 MB RAM
    - After that $1.00 for 600,000 GB-seconds
- It is usually very cheap to run AWS Lambda so it’s very popular

### AWS Lambda Limits to Know - per region

- **Execution:**
    - **Memory allocation: 128 MB – 10GB (1 MB increments)**
    - **Maximum execution time: 900 seconds (15 minutes)**
    - **Environment variables (4 KB)**
    - **Disk capacity in the “function container” (in /tmp): 512 MB to 10GB**
    - **Concurrency executions: 1000 (can be increased)**
- **Deployment:**
    - **Lambda function deployment size (compressed .zip): 50 MB**
    - **Size of uncompressed deployment (code + dependencies): 250 MB**
    - **Can use the /tmp directory to load other files at startup**
    - **Size of environment variables: 4 KB**

### Customization At The Edge

- **Many modern applications execute some form of the logic at the edge**
- Edge Function:
    - A code that you write and attach to CloudFront distributions
    - Runs close to your users to minimize latency
- **CloudFront provides two types: CloudFront Functions & Lambda@Edge**
- You don’t have to manage any servers, deployed globally
- Fully serverless

### CloudFront Functions & Lambda@Edge Use Cases

- Website Security and Privacy
- **Dynamic Web Application at the Edge**
- Search Engine Optimization (SEO)
- Intelligently Route Across Origins and Data Centers - Bot Mitigation at the Edge
- Real-time Image Transformation
- **A/BTesting**
- User Authentication and Authorization
- User Prioritization
- User Tracking and Analytics

### CloudFront Functions

- **Native feature of CloudFront (manage code entirely within CloudFront)**
- **Lightweight functions written in JavaScript**
- **Transform request attributes (headers, cookies, query strings, URL) to create an optimal Cache Key**
- Used to change CloudFront requests and responses:
    - **Viewer Request: after CloudFront receives a request from a viewer**
    - **Viewer Response: before CloudFront forwards the response to the viewer**
- Header manipulation
- Insert/modify/delete HTTP headers in the request or response
- URL rewrites or redirects
- Request authentication & authorization
    - Create and validate user-generated tokens (e.g., JWT) to allow/deny requests

### Lambda@Edge

- **chat gpt- The "lambda at edge" essentially refers to the AWS Lambda functions that are deployed at the edge locations of the CloudFront CDN.**
- **Lambda functions written in NodeJS or Python**
- Scales to 1000s of requests/second
- Used to change CloudFront requests and responses:
    - Viewer Request – after CloudFront receives a request from a
    viewer
    - Origin Request – before CloudFront forwards the request to the origin
    - Origin Response – after CloudFront receives the response from the origin
    - Viewer Response – before CloudFront forwards the response to the viewer
- **Author your functions in one AWS Region (us-east-1), then CloudFront replicates to its locations**
- Longer execution time (several ms)
- Adjustable CPU or memory
- Your code depends on a 3rd libraries (e.g., AWS SDK to access other AWS services)
- Network access to use external services for processing
- File system access or access to the body of HTTP requests

### CloudFront Functions vs. Lambda@Edge - Use Cases

**chat-gpt : CloudFront Functions can be replaced with lambda at edge?**

CloudFront Functions are designed specifically for HTTP processing at the edge of the CloudFront CDN, with a focus on simplicity, ease of use, and low latency. They provide a simplified programming model and are optimized for **common use cases such as header manipulation, URL rewriting, and redirects**. If your use case fits within these boundaries, CloudFront Functions can be a good choice, especially if you want to avoid the complexity and overhead of full-blown Lambda functions.

On the other hand, **Lambda at Edge provides a more general-purpose serverless compute platform that can be used for a wide range of tasks, including complex computations, database lookups, and more.** Lambda at Edge provides more flexibility and control over the execution environment, including the ability to use custom runtime environments and dependencies. If your use case requires more advanced features or requires more control over the environment, Lambda at Edge may be a better choice.

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20154.png)

### Lambda by default

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20155.png)

- **By default, your Lambda function is launched outside your own VPC (in an AWS-owned VPC)**
- **Therefore, it cannot access resources in your VPC (RDS, ElastiCache, internal ELB...)**

### Lambda in VPC

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20156.png)

- **You must define the VPC ID, the Subnets and the Security Groups**
- **Lambda will create an ENI (Elastic Network Interface) in your subnets**

### Lambda with RDS Proxy

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20157.png)

- If Lambda functions directly access your database, they may open too many connections under high load
- **RDS Proxy**
    - Improve scalability by pooling and sharing DB
    connections
    - Improve availability by reducing by 66% the failover time and preserving connections
    - Improve security by enforcing IAM authentication and storing credentials in Secrets Manager
- **The Lambda function must be deployed in your VPC, because RDS Proxy is never publicly accessible**

### Invoking Lambda from RDS & Aurora

- Invoke Lambda functions from within your DB instance
- Allows you to process data events from within a database
- Supported for RDS for PostgreSQL and Aurora MySQL
- **Must allow outbound traffic to your Lambda function from within your DB instance (Public, NAT GW, VPC Endpoints)**
- DB instance must have the required permissions to invoke the Lambda function (Lambda Resource-based Policy & IAM Policy)

### RDS Event Notifications

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20158.png)

- **Notifications that tells information about the DB instance itself (created, stopped, start, ...)**
- You don’t have any information about the data itself
- Subscribe to the following event categories: DB instance, DB snapshot, DB Parameter Group, DB Security Group, RDS Proxy, Custom Engine Version
- Near real-time events (up to 5 minutes)
- Send notifications to SNS or subscribe to events
using EventBridge

### Amazon DynamoDB

- **Fully managed, highly available with replication across multiple AZs**
- NoSQL database - not a relational database - with transaction support
- Scales to massive workloads, distributed database
- Millions of requests per seconds, trillions of row, 100s of TB of storage
- Fast and consistent in performance (single-digit millisecond)
- Integrated with IAM for security, authorization and administration
- Low cost and auto-scaling capabilities
- No maintenance or patching, always available
- Standard & Infrequent Access (IA) Table Class

### DynamoDB - Basics

- **DynamoDB is made of Tables**
- **RDS와 다르게 Column을 매우 쉽게 추가할 수 있다.**
- **Each table has a Primary Key (must be decided at creation time)**
- Each table can have an infinite number of items (= rows)
- Each item has attributes (can be added over time – can be null)
- **Maximum size of an item is 400KB**
- Data types supported are:
    - Scalar Types – String, Number, Binary, Boolean, Null
    - Document Types – List, Map
    - Set Types – String Set, Number Set, Binary Set
- **Therefore, in DynamoDB you can rapidly evolve schemas**

### DynamoDB **– Read/Write Capacity Modes**

- **Provisioned Mode (default)**
    - You specify the number of reads/writes per second
    - You need to plan capacity beforehand
    - Pay for provisioned Read Capacity Units (RCU) & Write Capacity Units (WCU)
    - Possibility to add auto-scaling mode for RCU & WCU
- **On-Demand Mode**
    - Read/writes automatically scale up/down with your workloads
    - No capacity planning needed
    - Pay for what you use, more expensive ($$$)
    - Great for unpredictable workloads, steep sudden spikes

### DynamoDB Accelerator (DAX)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20159.png)

- **Help solve read congestion by caching**
- **Microseconds latency for cached data**
- Doesn’t require application logic modification (compatible with existing DynamoDB APIs)
- **5 minutes TTL for cache (default)**

### DynamoDB – Stream Processing

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20160.png)

- Ordered stream of item-level modifications (create/update/delete) in a table
- **Use cases:**
    - React to changes in real-time (welcome email to users)
    - Real-time usage analytics
    - Insert into derivative tables
    - Implement cross-region replication
    - Invoke AWS Lambda on changes to your DynamoDB table
- **두 가지가 있음 Dynamo DB Stream과 Kinesis Data Stream**

**DynamoDB Streams**

- 24 hours retention
- Limited # of consumers
- Process using AWS Lambda Triggers, or DynamoDB Stream Kinesis adapter

**Kinesis Data Streams (newer)**

- 1 year retention
- High # of consumers
- Process using AWS Lambda, Kinesis Data Analytics, Kineis Data Firehose, AWS Glue Streaming ETL...

### DynamoDB Global Tables

- **Make a DynamoDB table accessible with low latency in multiple-regions**
- Active-Active replication
- **Applications can READ and WRITE to the table in any region**
- **Must enable DynamoDB Streams as a pre-requisite**

### DynamoDB - Time To Live(TTL)

- **Automatically delete items after an expiry timestamp**
- Use cases: reduce stored data by keeping only current items, adhere to regulatory obligations, **web session handling...**
- **Dynamo DB의 TTL을 사용해서 Web Session을 Handling 할 수 있다!**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20161.png)
    

### DynamoDB – Backups for disaster recovery

- **Continuous backups using point-in-time recovery (PITR)**
    - Optionally enabled for the last 35 days
    - Point-in-time recovery to any time within the backup window
    - The recovery process creates a new table
- **On-demand backups**
    - Full backups for long-term retention, until explicitely deleted
    - **Doesn’t affect performance or latency**
    - **Can be configured and managed in AWS Backup (enables cross-region copy)**
    - The recovery process creates a new table

### DynamoDB – Integration with Amazon S3

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20162.png)

**Export to S3 (must enable PITR)**

- Works for any point of time in the last 35 days
- Doesn’t affect the read capacity of your table
- Perform data analysis on top of DynamoDB
- Retain snapshots for auditing
- ETL on top of S3 data before importing back into DynamoDB
- Export in Dynamo DB JSON or ION format

**Import from S3**

- Import CSV, Dynamo DB JSON or ION format
- **Doesn’t consume any write capacity**
- Creates a new table
- Import errors are logged in CloudWatch ㅌLogs

### AWS API Gateway

- **AWS Lambda + API Gateway: No infrastructure to manage**
- **Support for the WebSocket Protocol**
- Handle API versioning (v1, v2...)
- Handle different environments (dev, test, prod...)
- **Handle security (Authentication and Authorization)**
- Create API keys, handle request throttling
- Swagger / Open API import to quickly define APIs - Transform and validate requests and responses
- Generate SDK and API specifications
- Cache API responses
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20163.png)
    

### API Gateway – Integrations High Level

**Lambda Function**

- Invoke Lambda function
- Easy way to expose REST API backed by AWS Lambda

**HTTP**

- Expose HTTP endpoints in the backend
- Example: internal HTTP API on premise, Application Load Balancer...
- Why? Add rate limiting, caching, user authentications, API keys, etc...

**AWS Service**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20164.png)

- Expose any AWS API through the API Gateway
- Example: start an AWS Step Function workflow, post a message to SQS
- Why? Add authentication, deploy publicly, rate control...

### API Gateway - Endpoint Types

**Edge-Optimized (default): For global clients**

- **Requests are routed through the CloudFront Edge locations (improves latency)**
- The API Gateway still lives in only one region

**Regional:**

- **For clients within the same region**
- Could manually combine with CloudFront (more control over the caching strategies and the distribution)

**Private:**

- Can only be accessed from your VPC using an interface VPC endpoint (ENI)
- Use a resource policy to define access

### API Gateway – Security

**User Authentication through**

- IAM Roles (useful for internal applications)
- Cognito (identity for external users – example mobile users)
- Custom Authorizer (your own logic)

**Custom Domain Name HTTPS** - security through integration with AWS Certificate Manager (ACM)

- **If using Edge-Optimized endpoint, then the certificate must be in us-east-1**
- **If using Regional endpoint, the certificate must be in the API Gateway region**
- **Must setup CNAME or A-alias record in Route 53**

### AWS Step Functions

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20165.png)

AWS Step Functions is a serverless orchestration service that lets you integrate with [AWS Lambda](https://aws.amazon.com/lambda/) functions and other AWS services to build business-critical applications. Through Step Functions' graphical console, you see your application’s workflow as a series of event-driven steps.

[https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html](https://docs.aws.amazon.com/step-functions/latest/dg/welcome.html)

- Build serverless visual workflow to orchestrate your Lambda functions
- Features: sequence, parallel, conditions, timeouts, error handling, ...
- Can integrate with EC2, ECS, On-premises servers, API Gateway, SQS queues, etc...
- **Possibility of implementing human approval feature**
- Use cases: order fulfillment, data processing, web applications, any workflow

### 문제

Question 7:

엣지 최적화 API 게이트웨이를 사용할 경우, API Gateway가 모든 AWS 리전의 CloudFront 엣지 로케이션에 존재하게 됩니다.
**• 아닙니다**
• 맞습니다

엣지 최적화 API Gateway는 지리적으로 분산된 클라이언트에 가장 적합합니다. API 요청은 가장 가까운 CloudFront 엣지 로케이션으로 라우팅되며, 이는 지연 시간을 향상시킵니다. **API Gateway는 여전히 하나의 AWS 리전에 존재합니다.**

Question 9:

CloudFront 배포를 통해 전역적으로 제공되는 애플리케이션이 있습니다. 인증 요청이 오리진까지 전달되게 하는 대신, CloudFront 엣지 로케이션에서 사용자를 인증하려 합니다. 이 요구 사항을 만족시키기 위해서는 어떤 방법을 사용해야 할까요?
**• Lambda@Edge**
• API Gateway
• DynamoDB
• AWS 글로벌 액셀러레이터

Lambda@Edge는 CloudFront의 기능으로, 사용자에 가깝게 코드를 실행하도록 해주어 성능을 향상시키고 지연 시간을 줄여 줍니다.

Question 13:

여러분이 DevOps 엔지니어로 일하고 있는 축구 회사에는 서버 쪽에 DynamoDB 테이블을 둔 웹 사이트가 있습니다. 현재 시청자 의견에 대한 보고서를 생성하기 위해 분석 팀과 함께 업무를 진행하고 있습니다. 분석 팀은 DynamoDB의 데이터를 JSON 포맷으로 S3 버킷에 호스팅한 다음, 거기서 작업을 시작하고 보고서를 생성하기를 원합니다. DynamoDB 데이터를 JSON 파일로 변환하는 데 가장 적합한 경제적인 방식은 무엇입니까?

**• DynamoDB 테이블을 선택하고 S3로 내보내기를 선택한다.**
• DynamoDB 데이터를 읽는 Lambda 함수를 만들어 JSON 파일로 변환하고 변환된 파일을 S3 버킷에 저장한다.(오답)
• AWS Transfer Family를 사용한다.
• AWS DataSync를 사용한다.

Question 14:

AWS에 호스팅할 예정인 웹 사이트가 현재 개발 진행 중에 있습니다. 이 웹 사이트에는 로그인한 사용자의 사용자 세션과 자동 만료 시간을 저장하고, 만료된 사용자 세션을 삭제해야 한다는 요구 사항이 있습니다. 다음 중 이런 경우에 가장 적합한 AWS 서비스는 무엇입니까?

• 사용자 세션을 S3 버킷에 저장하고 S3 수명 주기 정책을 활성화한다.
• 사용자 세션을 EC2 인스턴스에 로컬로 저장한다.
**• 사용자 세션을 DynamoDB 테이블에 저장하고 TTL을 활성화한다.**
• 사용자 세션을 EFS 파일 시스템에 저장한다.

Question 15:

여러분이 가진 모바일 애플리케이션에서 애플리케이션 사용자에게 S3 버킷에 있는 개인 공간에 액세스할 수 있는 권한을 부여하려고 합니다. 어떻게 해야 합니까?
• 각각의 애플리케이션 사용자에 대해 IAM 사용자 자격 증명 생성한다.
**• Amazon Cognito 아이덴티티 페더레이션을 사용한다.**
• SAML 아이덴티티 페더레이션을 사용한다.
• 버킷 정책을 사용해 버킷을 퍼블릭으로 만든다.

Question 16:

여러분은 AWS에 호스팅할 예정인 새로운 웹 및 모바일 애플리케이션을 개발하고 있으며, 현재 로그인 및 회원 가입 페이지를 구현하는 작업을 진행하고 있습니다. 애플리케이션 백엔드는 서버리스로 되어 있으며 구현에 Lambda, DynamoDB, API Gateway를 사용하고 있습니다. 다음 중 백엔드에 대한 인증을 구성하는 데 가장 쉽고 적합한 방식은 무엇입니까?

• KMS로 암호화된 DynamoDB 테이블에 사용자의 자격 증명을 저장한다.
• KMS로 암호화된 S3 버킷에 사용자의 자격 증명을 저장한다.
**• Cognito 사용자 풀을 사용한다.**
• 사용자 자격 증명을 AWS Secrets Manager에 저장한다.

## DB Summary

### Data base Types

- **RDBMS** (= SQL / OLTP): RDS, Aurora – great for joins
- **NoSQL database** – **no joins, no SQL** : DynamoDB (~JSON), ElastiCache (key / value pairs), Neptune (graphs), DocumentDB (for MongoDB), Keyspaces (for Apache Cassandra)
- **Object Store**: S3 (for big objects) / Glacier (for backups / archives)
- **Data Warehouse (= SQL Analytics / BI)**: Redshift (OLAP), Athena, EMR
- **Search**: OpenSearch (JSON) – free text, unstructured searches
- **Graphs**: Amazon Neptune – displays relationships between data
- **Ledger**: Amazon Quantum Ledger Database
- **Time series**: Amazon Timestream

### Amazon RDS – Summary

- Managed PostgreSQL / MySQL / Oracle / SQL Server / MariaDB / Custom
- Provisioned RDS Instance Size and EBS Volume Type & Size
- Auto-scaling capability for Storage
- Support for Read Replicas and Multi AZ
- Security through IAM, Security Groups, KMS , SSL in transit
- Automated Backup with Point in time restore feature (up to 35 days)
- Manual DB Snapshot for longer-term recovery
- Managed and Scheduled maintenance (with downtime)
- Support for IAM Authentication, integration with Secrets Manager
- RDS Custom for access to and customize the underlying instance (Oracle & SQL Server)
- Use case: Store relational datasets (RDBMS / OLTP), perform SQL queries, transactions

### Amazon Aurora – Summary

- Compatible API for PostgreSQL/MySQL,separation of storage and compute
- **Storage : data is stored in 6 replicas,across 3 AZ – highly available,self-healing,auto-scaling**
- Compute : Cluster of DB Instance across multiple AZ, auto-scaling of ReadReplicas
- Cluster : Custom endpoints for writer and reader DB instances
- Same security / monitoring / maintenance features as RDS
- Know the backup & restore options for Aurora
- **Aurora Serverless – for unpredictable/intermittent workloads,no capacity planning**
- **Aurora Multi-Master** – for continuous writes failover (high write availability)
- **Aurora Global:** up to 16 DB Read Instances in each region, < 1 second storage replication
- **Aurora Machine Learning:** perform ML using SageMaker & Comprehend on Aurora
- **Aurora Database Cloning:** new cluster from existing one,faster than restoring a snapshot
- Use case: same as RDS, but with less maintenance / more flexibility / more performance / more features

### Amazon ElastiCache – Summary

- Managed Redis / Memcached (similar offering as RDS, but for caches)
- In-memory data store, sub-millisecond latency
- Select an ElastiCache instance type (e.g., cache.m6g.large)
- Support for Clustering (Redis) and Multi AZ, Read Replicas (sharding)
- Security through IAM, Security Groups, KMS, Redis Auth
- Backup / Snapshot / Point in time restore feature
- Managed and Scheduled maintenance
- Requires some application code changes to be leveraged
- Use Case: Key/Value store, Frequent reads, less writes, cache results for DB queries, store session data for websites, cannot use SQL.

### Amazon DynamoDB – Summary

- AWS proprietary technology, managed **serverless NoSQL database**, millisecond latency
- **Capacity modes: provisioned capacity with optional auto-scaling or on-demand capacity**
- Can replace ElastiCache as a key/value store (storing session data for example, using TTL feature)
- Highly Available,Multi AZ by default,Read and Writes are decoupled, transaction capability
- **DAX cluster for read cache, microsecond read latency**
- Security, authentication and authorization is done through IAM
- Event Processing: DynamoDB Streams to integrate with AWS Lambda, or Kinesis Data Streams
- Global Table feature : active-active setup
- Automated backups up to 35 days with PITR (restore to new table), or on-demand backups
- Export to S3 without using RCU within the PITR window,import from S3 without using WCU
- **Great to rapidly evolve schemas**
- Use Case: Serverless applications development (small documents 100s KB), distributed serverless cache

### Amazon S3 – Summary

- S3 is a... key / value store for objects
- **Great for bigger objects, not so great for many small objects**
- Serverless, scales infinitely, max object size is 5 TB, versioning capability
- Tiers: S3 Standard, S3 Infrequent Access, S3 Intelligent, S3 Glacier + lifecycle policy
- Features: Versioning, Encryption, Replication, MFA-Delete, Access Logs...
- Security: IAM, Bucket Policies, ACL, Access Points, Object Lambda, CORS, Object/Vault Lock - Encryption: SSE-S3, SSE-KMS, SSE-C, client-side,TLS in transit, default encryption
- Batch operations on objects using S3 Batch, listing files using S3 Inventory
- Performance:Multi-part upload,S3 Transfer Acceleration,S3 Select
- Automation: S3 Event Notifications (SNS, SQS, Lambda, EventBridge)
- Use Cases: static files, key value store for big files, website hosting

### DocumentDB

- **DocumentDB is the same for MongoDB (which is a NoSQL database)**
- MongoDB is used to store, query, and index JSON data
- Similar “deployment concepts” as Aurora
- Fully Managed, highly available with replication across 3 AZ
- DocumentDB storage automatically grows in increments of 10GB, up to 64 TB.
- Automatically scales to workloads with millions of requests per seconds

### Amazon Neptune - Graph DataBase

- A popular graph dataset would be a social network
- Users have friends
- Posts have comments
- Comments have likes from users
- Users share and like posts...
- Highly available across 3 AZ, with up to 15 read replicas
- Build and run applications working with highly connected
datasets – optimized for these complex and hard queries
- Can store up to billions of relations and query the graph with milliseconds latency
- Highly available with replications across multiple AZs
- Great for knowledge graphs (Wikipedia), fraud detection,
recommendation engines, social networking

### Amazon Keyspaces (for Apache Cassandra)

- Apache Cassandra is an open-source NoSQL distributed database
- A managed Apache Cassandra-compatible database service
- Serverless, Scalable, highly available, fully managed by AWS
- Automatically scale tables up/down based on the application’s traffic
- Tables are replicated 3 times across multiple AZ
- Using the Cassandra Query Language (CQL)
- Single-digit millisecond latency at any scale, 1000s of requests per second - Capacity: On-demand mode or provisioned mode with auto-scaling
- Encryption, backup, Point-In-Time Recovery (PITR) up to 35 days
- Use cases: store IoT devices info, time-series data, ...

### Amazon QLDB - Ledger DB

- 회계 DB라고 생각하자. Ledger : 회계장부
- QLDB stands for ”Quantum Ledger Database”
- **A ledger is a book recording financial transactions**
- FullyManaged,Serverless,Highavailable,Replicationacross3AZ
- Used to review history of all the changes made to your application data over time
- Immutable system: no entry can be removed or modified, cryptographically verifiable
- 2-3x better performance than common ledger blockchain frameworks, manipulate data using SQL
- **Difference with Amazon Managed Blockchain: no decentralization component, in accordance with financial regulation rules**
[https://docs.aws.amazon.com/qldb/latest/developerguide/ledger-structure.html](https://docs.aws.amazon.com/qldb/latest/developerguide/ledger-structure.html)

### Amazon Timestream - time series database

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20166.png)

- Fully managed, fast, scalable, serverless time series database
- Automatically scales up/down to adjust capacity
- Store and analyze trillions of events per day
- **1000s times faster & 1/10th the cost of relational databases**
- Scheduled queries, multi-measure records, SQL compatibility
- Data storage tiering: recent data kept in memory and historical data kept in a cost-optimized storage
- Built-in time series analytics functions (helps you identify patterns in your data in near real-time)
- Encryption in transit and at rest
- **Use cases: IoT apps, operational applications, real-time analytics, ...**

## Data Analytics & Pipeline

### Amazon Athena

- **Serverless query service to analyze data stored in Amazon S3**
- Uses standard SQL language to query the files **(built on Presto)**
- Supports CSV, JSON, ORC, Avro, and **Parquet**
- Pricing: $5.00 per TB of data scanned
- **Commonly used with Amazon Quicksight for reporting/dashboards**
- Use cases: Business intelligence / analytics / reporting, analyze & query VPC Flow Logs, ELB Logs, CloudTrail trails, etc...**(Log 분석할 때 자주 사용되는 듯)**
- **Exam Tip: analyze data in S3 using serverless SQL, use Athena**

### Amazon Athena – 성능 향상 방법

- **빅데이터를 지탱하는 기술을 참고하자**
- **Use columnar data for cost-savings (less scan)**
    - **Apache Parquet or ORC is recommended(columnar data를 저장하는  데이터 형식이 Parquet, ORC 이기 때문임. )**
    - **Use Glue to convert your data to Parquet or ORC**
- **Compress data** for smaller retrievals (bzip2, gzip, lz4, snappy, zlip, zstd...)
- **Partition datasets** in S3 for easy querying on virtual columns
    - s3://yourBucket/pathToTable /<PARTITION_COLUMN_NAME>=<VALUE>
    /<PARTITION_COLUMN_NAME>=<VALUE> /<PARTITION_COLUMN_NAME>=<VALUE>
    /etc...
    - Example:s3://athena-examples/flight/parquet/year=1991/month=1/day=1/
- **Use larger files (> 128 MB) to minimize overhead**

### Amazon Athena – Federated Query

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20167.png)

- **Allows you to run SQL queries across data stored in relational, non-relational, object, and custom data sources (AWS or on-premises)**
- Uses Data Source Connectors that run on AWS Lambda to run Federated Queries (e.g., CloudWatch Logs, DynamoDB, RDS, ...)
- Store the results back in Amazon S3

### Redshift Overview

- **Redshift is based on PostgreSQL, but it’s not used for OLTP**
    - OLTP (Online Transaction Processing) and OLAP (Online Analytical Processing) are two distinct database architectures that serve different purposes.
    - OLTP(Online Transactional Processing)
        
        Chat-GPT : OLTP is designed for transactional processing and is optimized for handling high-volume, low-latency transactions. OLTP databases are typically used in transactional systems such as banking, retail, and e-commerce applications, where the primary focus is on processing and managing individual transactions in real-time. OLTP databases are characterized by high concurrency, frequent updates, and small transactions with simple queries.
        
    - OLAP(Online Analytical Processing)
        
        Chat-GPT : OLAP is designed for analytical processing and is optimized for handling large volumes of complex data. OLAP databases are used for decision support and business intelligence applications, where the primary focus is on querying and analyzing large datasets to identify trends, patterns, and insights. OLAP databases are characterized by large tables, complex queries, and aggregate functions that summarize data.
        
- **It’s OLAP – online analytical processing (analytics and data warehousing)**
- **10x better performance than other data warehouses, scale to PBs of data**
- Columnar storage of data (instead of row based) & parallel query engine
- Pay as you go based on the instances provisioned
- Has a SQL interface for performing the queries
- BI tools such as Amazon Quicksight or Tableau integrate with it
- **vs Athena: faster queries / joins / aggregations thanks to indexes**

### Redshift Cluster

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20168.png)

- **Leader node:** for query planning, results aggregation
- **Compute node:** for performing the queries, send results to leader
- You provision the node size in advance
- You can used Reserved Instances for cost savings

### Redshift – Snapshots & DR

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20169.png)

- **chatgpt-when you create an Amazon Redshift cluster, it is deployed as a single Availability Zone (AZ) deployment, which means all the data is stored in a single AZ.**
- **However, you can choose to create a multi-AZ deployment for improved availability and durability of your data. A multi-AZ deployment means that your data is automatically replicated to a standby cluster in a different AZ within the same region.**
- **Redshift has “Multi-AZ” mode for some clusters**
- **Snapshots are point-in-time backups of a cluster, stored internally in S3**
- You can restore a snapshot into a new cluster
- **You can configure Amazon Redshift to automatically copy snapshots (automated or manual) of a cluster to another AWS Region**
    - Automated: every 8 hours, every 5 GB, or on a schedule. Set retention between 1 to 35 days
    - Manual: snapshot is retained until you delete it

### **Loading data into Redshift:Large inserts are MUCH better**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20170.png)

### Redshift Spectrum

- **Chat-GPT : Redshift Spectrum enables you to analyze data stored in your Amazon S3 data lake without the need to move or copy the data into Redshift first. This allows you to leverage the power of both Redshift and S3 to process and analyze data at scale.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20171.png)

- Query data that is already in S3 without loading it
- **Must have a Redshift cluster available to start the query**
- The query is then submitted to thousands of Redshift Spectrum nodes

### Amazon OpenSearch Service - 솔직히 왜 써야하는지 모르겠음.

- Amazon OpenSearch is successor to Amazon ElasticSearch
- In DynamoDB, queries only exist by primary key or indexes...
- **With OpenSearch, you can search any field, even partially matches**
- It’s common to use OpenSearch as a complement to another database
- Provision a managed cluster of instances or use OpenSearch Serverless
- Does not natively support SQL (can be enabled via a plugin)
- Ingestion from Kinesis Data Firehose, AWS IoT, and CloudWatch Logs
- Security through Cognito & IAM, KMS encryption,TLS
- Comes with OpenSearch Dashboards (visualization)
- **아래와 같은 패턴들로 사용된다고 함.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20172.png)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20173.png)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20174.png)

### Amazon EMR

- **EMR stands for “Elastic MapReduce”**
- **EMR helps creating Hadoop clusters (Big Data) to analyze and process vast amount of data**
- The clusters can be made of hundreds of EC2 instances
- EMR comes bundled with Apache Spark, HBase, Presto, Flink...
- EMR takes care of all the provisioning and configuration
- Auto-scaling and integrated with Spot instances
- **Use cases: data processing, machine learning, web indexing, big data...**

### Amazon EMR – Node types & purchasing

- **Master Node:** Manage the cluster, coordinate, manage health – long running
- **Core Node:** Run tasks and store data – long running
- Task Node (optional): Just to run tasks – usually Spot
- Purchasing options:
    - On-demand: reliable, predictable, won’t be terminated
    - Reserved (min 1 year): cost savings (EMR will automatically use if available) - Spot Instances: cheaper, can be terminated, less reliable
- Can have long-running cluster, or transient (temporary) cluster

### Amazon QuickSight - BI Tool

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20175.png)

- **Serverless machine learning-powered business intelligence service to create interactive dashboards**
- Fast, automatically scalable, embeddable, with per-session pricing
- Use cases:
    - Business analytics
    - Building visualizations
    - Perform ad-hoc analysis
    - Get business insights using data
- **In-memory computation using SPICE engine if data is imported into QuickSight**
- Enterprise edition: Possibility to setup Column-Level security (CLS)

### QuickSight – Dashboard & Analysis

- **Define Users (standard versions) and Groups (enterprise version)**
    - **These users & groups only exist within QuickSight, not IAM !!**
- A dashboard...
    - is a read-only snapshot of an analysis that you can share
    - preserves the configuration of the analysis (filtering, parameters, controls, sort)
- **You can share the analysis or the dashboard with Users or Groups(not same as IAM Role)**
- To share a dashboard, you must first publish it
- Users who see the dashboard can also see the underlying data

### AWS Glue

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20176.png)

- **Managed extract, transform, and load (ETL) service**
- Useful to prepare and transform data for analytics
- **Fully serverless service**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20177.png)

### Glue – things to know at a high-level

- **Glue Job Bookmarks:** prevent re-processing old data
- **Glue Elastic Views:**
    - Combine and replicate data across multiple data stores using SQL
    - No custom code, Glue monitors for changes in the source data, serverless
    - Leverages a “virtual table” (materialized view)
- **Glue DataBrew:** clean and normalize data using pre-built transformation
- **Glue Studio:** new GUI to create, run and monitor ETL jobs in Glue
- **Glue Streaming ETL (built on Apache Spark Structured Streaming)**: compatible with Kinesis Data Streaming, Kafka, MSK (managed Kafka)

### AWS Lake Formation

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20178.png)

- **Data lake = central place to have all your data for analytics purposes**
- Fully managed service that makes it easy to setup a data lake in days
- Discover, cleanse, transform, and ingest data into your Data Lake
- It automates many complex manual steps (collecting, cleansing, moving, cataloging data, ...) and de-duplicate (using ML Transforms)
- Combine structured and unstructured data in the data lake
- **Out-of-the-box source blueprints:** S3, RDS, Relational & NoSQL DB...
- **Fine-grained Access Control for your applications (row and column-level)**
- Built on top of AWS Glue

### **AWS Lake Formation - Centralized Permissions**

- **Data Lake를 쓰는 이유 Centralized Permissions!!!**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20179.png)

### Kinesis Data Analytics (SQL application)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20180.png)

- **Real-time analytics on Kinesis Data Streams & Firehose** **using SQL**
- Add reference data from Amazon S3 to enrich streaming data
- Fully managed, no servers to provision
- Automatic scaling
- Pay for actual consumption rate
- Output:
    - **Kinesis Data Streams: create streams out of the real-time analytics queries**
    - **Kinesis Data Firehose: send analytics query results to destinations**
- Use cases:
    - Time-series analytics
    - Real-time dashboards
    - Real-time metrics

### Kinesis Data Analytics for Apache Flink

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20181.png)

- Use Flink (Java, Scala or SQL) to process and analyze streaming data
- Run any Apache Flink application on a managed cluster on AWS
    - provisioning compute resources, parallel computation, automatic scaling
    - application backups (implemented as checkpoints and snapshots)
    - Use any Apache Flink programming features
    - **Flink does not read from Firehose (use Kinesis Analytics for SQL instead)**

### Amazon Managed Streaming for Apache Kafka (Amazon MSK)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20182.png)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20183.png)

- **Alternative to Amazon Kinesis**
- **Fully managed Apache Kafka on AWS**
    - Allow you to create, update, delete clusters
    - MSK creates & manages Kafka brokers nodes & Zookeeper nodes for you
    - **Deploy the MSK cluster in your VPC, multi-AZ (up to 3 for HA)**
    - Automatic recovery from common Apache Kafka failures
    - Data is stored on EBS volumes for as long as you want
- **MSK Serverless**
- Run Apache Kafka on MSK without managing the capacity
- MSK automatically provisions resources and scales compute & storage

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20184.png)

### Big Data Ingestion Pipeline

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20185.png)

### 문제

Question 3:

**솔루션 아키텍트로서 Redshift 클러스터에 대한 재해 복구 계획을 수립하는 업무를 맡았습니다. 어떤 작업을 해야 합니까?**
• 다중 AZ를 활성화한다.
**• 자동 스냅샷을 활성화한 다음, Redshift 클러스터가 스냅샷을 다른 AWS 리전으로 자동 복사하도록 설정한다.**
• 스냅샷을 만들고 Redshift 글로벌 클러스터로 복원한다.

Question 7:

한 회사가 AWS를 사용해 자사의 공용 웹 사이트와 내부 애플리케이션을 호스팅하고 있습니다. 이들 웹 사이트와 애플리케이션에서는 수많은 로그 및 트레이스가 생성됩니다. 로그를 중앙 집중식으로 저장하여 실시간으로 검색하고 분석해 오류와 악의적인 시도를 감지할 수 있도록 만들어야 합니다. 로그를 효율적으로 저장하고 분석하는 데 도움이 되는 AWS 서비스는 무엇입니까?
• Amazon S3
**• Amazon OpenSearch service**
• Amazon ElastiCache
• Amazon QLDB

## Machine Learning

### **Rekognition: face detection, labeling, celebrity recognition**

- Find objects, people, text, scenes in images and videos using ML
- Facial analysis and facial search to do user verification, people counting
- Create a database of “familiar faces” or compare against celebrities
- Use cases:
    - Labeling
    - Content Moderation
    - Text Detection
    - Face Detection and Analysis (gender, age range, emotions...)
    - Face Search and Verification
    - Celebrity Recognition
    - Pathing (ex: for sports game analysis)
- **Amazon Rekognition – Content Moderation**
    - **Detect content that is inappropriate, unwanted, or offensive (image and videos)**
    - Used in social media, broadcast media, advertising, and e-commerce situations to create a safer user experience
    - **Set a Minimum Confidence Threshold for items that will be flagged**
    - Flag sensitive content for manual review in Amazon Augmented AI (A2I)
    - Help comply with regulations

### **Transcribe: audio to text (ex: subtitles)**

- **Automatically convert speech to text**
- Uses a deep learning process called automatic speech recognition (ASR) to convert speech to text quickly and accurately
- **Automatically remove Personally Identifiable Information (PII) using Redaction**
- **Supports Automatic Language Identification for multi-lingual audio**
- Use cases:
    - transcribe customer service calls
    - automate closed captioning and subtitling
    - generate metadata for media assets to create a fully searchable archive

### **Polly: text to audio**

- **Turn text into lifelike speech using deep learning**
- Allowing you to create applications that talk
- Amazon Polly – Lexicon & SSML
    - Customize the pronunciation of words with Pronunciation lexicons
        - Stylized words: St3ph4ne => “Stephane”
        - Acronyms:AWS=>“AmazonWebServices”
    - Upload the lexicons and use them in the SynthesizeSpeech operation
    - Generate speech from plain text or from documents marked up with **Speech
    Synthesis Markup Language (SSML)** – enables more customization
        - emphasizing specific words or phrases
        - using phonetic pronunciation
        - including breathing sounds, whispering
        - using the Newscaster speaking style

### **Translate: translations**

- **Natural and accurate language translation**
- Amazon Translate allows you to localize content - such as websites and applications - for international users, and to easily translate large volumes of text efficiently.

### **Lex: build conversational bots – chatbots**

- **Amazon Lex: (same technology that powers Alexa)**
    - **Speech를 인식한다.**
    - Automatic Speech Recognition (ASR) to convert speech to text
    - Natural Language Understanding to recognize the intent of text, callers
    - Helps build chatbots, call center bots
- **Amazon Connect:**
    - Receive calls, create contact flows, cloud-based virtual contact center
    - Can integrate with other CRM systems or AWS
    - No upfront payments, 80% cheaper than traditional contact center solutions

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20186.png)

### **Comprehend: NLP**

- **For Natural Language Processing – NLP**
- Fully managed and serverless service
- Uses machine learning to find insights and relationships in text - Language of the text
    - **Extracts key phrases, places, people, brands, orevents**
    - Understands how positive or negative the text is
    - Analyzes text using tokenization and parts of speech
    - Automatically organizes a collection of text files by topic
- Sample use cases:
    - analyze customer interactions (emails) to find what leads to a positive or negative experience
    - Create and groups articles by topics that Comprehend will uncover

### Amazon Comprehend Medical

- Amazon Comprehend Medical detects and returns useful information in unstructured clinical text:
    - Physician’s notes
    - Discharge summaries - Test results
    - Case notes
- **Uses NLP to detect Protected Health Information (PHI) – DetectPHI API**
- Store your documents in Amazon S3, analyze real-time data with Kinesis Data Firehose, or use Amazon Transcribe to transcribe patient narratives into text that can be analyzed by Amazon Comprehend Medical.

### **SageMaker: machine learning for every developer and data scientist**

- Fully managed service for developers / data scientists to build ML models - Typically, difficult to do all the processes in one place + provision servers - Machine learning process (simplified): predicting your exam score

### **Forecast: build highly accurate forecasts**

- **Fully managed service that uses ML to deliver highly accurate forecasts - Example: predict the future sales of a raincoat**
- 50% more accurate than looking at the data itself
- Reduce forecasting time from months to hours
- Use cases: Product Demand Planning, Financial Planning, Resource Planning, ...

### **Kendra: ML-powered search engine**

- **Fully managed document search service powered by Machine Learning**
- **Extract answers from within a document (text, pdf, HTML, PowerPoint, MS Word, FAQs...) - Natural language search capabilities**
- Learn from user interactions/feedback to promote preferred results (Incremental Learning) - Ability to manually fine-tune search results (importance of data, freshness, custom, ...)
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20187.png)
    

### **Personalize: real-time personalized recommendations**

- Fully managed ML-service to build apps with real-time personalized recommendations
- Example: personalized product recommendations/re-ranking, customized direct marketing - Example:Userboughtgardeningtools,providerecommendationsonthenextonetobuy
- Same technology used by [Amazon.com](http://amazon.com/)
- Integrates into existing websites, applications, SMS, email marketing systems, ...
- Implement in days, not months (you don’t need to build, train, and deploy ML solutions) - Use cases: retail stores, media and entertainment...

### **Textract: detect text and data in documents**

- **Automatically extracts text, handwriting, and data from any scanned documents using AI and ML**
- Extract data from forms and tables analyze result
- Read and process any type of document (PDFs, images, ...)
- **Use cases:**
    - Financial Services (e.g., invoices, financial reports)
    - Healthcare (e.g., medical records, insurance claims)
    - Public Sector (e.g., tax forms, ID documents, passports)

## Monitoring, Audit and Performance

### Amazon CloudWatch Metrics

- **CloudWatch provides metrics for every services in AWS**
- Metric is a variable to monitor (CPUUtilization, NetworkIn...)
- **Metrics belong to namespaces**
- Dimension is an attribute of a metric (instance id, environment, etc...).
- Up to 30 dimensions per metric
- Metrics have timestamps
- Can create CloudWatch dashboards of metrics
- Can create CloudWatch Custom Metrics (for the RAM for example)

### CloudWatch Metric Streams

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20188.png)

- **Continually stream CloudWatch metrics** to a destination of your choice, **with near-real-time delivery and low latency.**
    - Amazon Kinesis Data Firehose (and then its destinations)
    - 3rd party service provider: Datadog, Dynatrace, New Relic, Splunk, Sumo Logic...
- Option to filter metrics to only stream a subset of them

### CloudWatch Logs

- **Log groups:** arbitrary name, usually representing an application
- **Log stream:** instances within application / log files / containers
- Can define log expiration policies (never expire, 30 days, etc..)
- **CloudWatch Logs can send logs to:**
    - Amazon S3 (exports)
    - Kinesis Data Streams
    - Kinesis Data Firehose
    - AWS Lambda
    - OpenSearch

### CloudWatch Logs - Sources

- **SDK, CloudWatch Logs Agent, CloudWatch Unified Agent**
- Elastic Beanstalk: collection of logs from application
- ECS: collection from containers
- **AWS Lambda:** collection from function logs
- VPC Flow Logs: VPC specific logs - API Gateway
- CloudTrail based on filter
- **Route53:** Log DNS queries

### CloudWatch Logs Metric Filter & Insights

- CloudWatch Logs can use filter expressions
    - For example, find a specific IP inside of a log
    - Or count occurrences of “ERROR” in your logs
- Metric filters can be used to trigger CloudWatch alarms
- CloudWatch Logs Insights can be used to query logs and add queries to CloudWatch Dashboards

### CloudWatch Logs – S3 Export

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20189.png)

- **Log data can take up to 12 hours to become available for export**
- The API call is CreateExportTask
- **Not near-real time or real-time... use Logs Subscriptions instead**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20190.png)
    

### CloudWatch Logs for EC2

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20191.png)

- **By default, no logs from your EC2 machine will go to CloudWatch**
- **You need to run a CloudWatch agent on EC2 to push the log files you want**
- Make sure IAM permissions are correct
- The CloudWatch log agent can be setup on-premises too

### CloudWatch Logs Agent & Unified Agent

- For virtual servers (EC2 instances, on-premises servers...)
- **CloudWatch Logs Agent**
    - Old version of the agent
    - Can only send to CloudWatch Logs
- **CloudWatch Unified Agent**
    - **Collect additional system-level metrics such as RAM, processes, etc...**
    - **Collect logs to send to CloudWatch Logs**
    - Centralized configuration using SSM Parameter Store

### CloudWatch Unified Agent -Metrics

- **Collected directly on your Linux server / EC2 instance**
- **CPU** (active, guest, idle, system, user, steal)
- **Disk metrics** (free, used, total), Disk IO (writes, reads, bytes, iops)
- **RAM** (free, inactive, used, total, cached)
- **Netstat** (number of TCP and UDP connections, net packets, bytes) - Processes (total, dead, bloqued, idle, running, sleep)
- **Swap Space** (free, used, used %)
- Reminder: out-of-the box metrics for EC2 – disk, CPU, network (high level)

### CloudWatch Alarms

- **Alarms are used to trigger notifications for any metric**
- Various options (sampling, %, max, min, etc...)
- Alarm States:
    - OK
    - INSUFFICIENT_DATA
    - ALARM
- Period:
    - Length of time in seconds to evaluate the metric
    - High resolution custom metrics: 10 sec, 30 sec or multiples of 60 sec

### CloudWatch Alarm Targets

- Stop, Terminate, Reboot, or Recover an EC2 Instance
- Trigger Auto Scaling Action
- **Send notification to SNS (from which you can do pretty much anything)**

### CloudWatch Alarms – Composite Alarms

- **CloudWatch Alarms are on a single metric**
- Composite Alarms are monitoring the states of multiple other alarms - AND and OR conditions
- Helpful to reduce “alarm noise” by creating complex composite alarms

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20192.png)

### EC2 Instance Recovery

- **Status Check:**
    - Instance status = check the EC2 VM
    - System status = check the underlying hardware
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20193.png)
    
- Recovery: Same Private, Public, Elastic IP, metadata, placement group

### CloudWatch Alarm: good to know

- **Alarms can be created based on CloudWatch Logs Metrics Filters**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20194.png)

- To test alarms and notifications, set the alarm state to Alarm using CLI
    - aws cloudwatch set-alarm-state --alarm-name "myalarm" --state-value
    ALARM --state-reason "testing purposes"

### Amazon EventBridge (formerly CloudWatch Events)

- **CloudWatch Metric은 System Metric에 기반해서 무언가를 실행한다면, EventBridge는 훨씬 더 넓은 범위를 포괄한다.**
- **Schedule: Cron jobs (scheduled scripts) Schedule Every hour**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20195.png)

- **Event Pattern: Event rules to react to a service doing something**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20196.png)

- Trigger Lambda functions, send SQS/SNS messages

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20197.png)

### Amazon EventBridge - Event Bus

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20198.png)

- Event buses can be accessed by other AWS accounts using Resource-based Policies
- You can archive events (all/filter) sent to an event bus (indefinitely or set period)
- Ability to replay archived events

### Amazon EventBridge – Schema Registry

- **EventBridge can analyze the events in your bus and infer the schema**
- The Schema Registry allows you to generate code for your application, that will know in advance how data is structured in the event bus
- Schema can be versioned

### Amazon EventBridge – Resource-based Policy

- Manage permissions for a specific Event Bus
- Example: allow/deny events from another AWS account or AWS region
- Use case: aggregate all events from your AWS Organization in a single AWS account or AWS region
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20199.png)
    

### CloudWatch Insights and Operational Visibility

- **Insight = Agent**
- **CloudWatch Container Insights**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20200.png)
    
    - ECS, EKS, Kubernetes on EC2, Fargate, needs agent for Kubernetes
    - Metrics and logs
- **CloudWatch Lambda Insights**
    - Detailed metrics to troubleshoot serverless applications
- **CloudWatch Contributors Insights**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20201.png)
    
    - Find “Top-N” Contributors through CloudWatch Logs
- **CloudWatch Application Insights**
    - Automatic dashboard to troubleshoot your application and related AWS services

### AWS CloudTrail = 계좌와 관련된 Log 생성

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20202.png)

- **Provides governance, compliance and audit for your AWS Accoun**t
- CloudTrail is enabled by default!
- **Get an history of events / API calls made within your AWS Account by:**
    - Console
    - SDK
    - CLI
    - AWS Services
- Can put logs from CloudTrail into CloudWatch Logs or S3
- A trail can be applied to All Regions (default) or a single Region.
- **If a resource is deleted in AWS, investigate CloudTrail first!**

### CloudTrail Events

- **Management Events 관리 이벤트:**
    - **Operations that are performed on resources in your AWS account**
    - Examples:
        - Configuring security (IAM AttachRolePolicy)
        - Configuring rules for routing data (Amazon EC2 CreateSubnet)
        - Setting up logging (AWS CloudTrail CreateTrail)
    - **By default, trails are configured to log management events.**
    - Can separate Read Events (that don’t modify resources) from Write Events (that may modify resources)
- **Data Events 데이터 이벤트:**
    - **By default, data events are not logged (because high volume operations)**
    - Examples :
        - Amazon S3 object-level activity (ex: GetObject, DeleteObject, PutObject): can separate Read and Write Events
        - AWS Lambda function execution activity (the Invoke API)

### CloudTrail Insights = Collect Data To Detect Anomalies(변칙)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20203.png)

- **Enable CloudTrail Insights to detect unusual activity in your account:**
    - inaccurate resource provisioning
    - hitting service limits
    - Bursts of AWS IAM actions
    - Gaps in periodic maintenance activity
- **CloudTrail Insights analyzes normal management events to create a baseline**
- **And then continuously analyzes write events to detect unusual patterns**
    - Anomalies appear in the CloudTrail console
    - Event is sent to Amazon S3
    - An EventBridge event is generated (for automation needs)

### CloudTrail Events Retention

- **Events are stored for 90 days in CloudTrail**
- To keep events beyond this period, log them to S3 and use Athena

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20204.png)

### AWS Config = To centralize and manage Parameters

- **Helps with auditing and recording compliance of your AWS resources**
- Helps record configurations and changes over time
- Questions that can be solved by AWS Config:
    - Is there unrestricted SSH access to my security groups?
    - Do my buckets have any public access?
    - How has my ALB configuration changed over time?
- **You can receive alerts (SNS notifications) for any changes**
- **AWS Config is a per-region service**
- Can be aggregated across regions and accounts
- Possibility of storing the configuration data into S3 (analyzed by Athena)

### Config Rules

- **Can use AWS managed config rules (over 75)**
- Can make custom config rules (must be defined in AWS Lambda)
    - Ex: evaluate if each EBS disk is of type gp2
    - Ex: evaluate if each EC2 instance is t2.micro
- Rules can be evaluated / triggered:
    - For each config change
    - And / or: at regular time intervals
- **AWS Config Rules does not prevent actions from happening (no deny)**
- Pricing: no free tier, $0.003 per configuration item recorded per region,
$0.001 per config rule evaluation per region

### Config Rules – Remediations(교정)

- **Automate remediation of non-compliant resources using SSM Automation Documents**
- **Use AWS-Managed Automation Documents or create custom Automation Documents**
    - Tip: you can create custom Automation Documents that invokes Lambda function
- You can set Remediation Retries if the resource is still non-compliant after auto-
remediation
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20205.png)
    

### Config Rules – Notifications

- **Use EventBridge to trigger notifications when AWS resources are non- compliant**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20206.png)
    
- **Ability to send configuration changes and compliance state notifications to SNS (all events – use SNS Filtering or filter at client-side)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20207.png)
    

### CloudWatch vs CloudTrail vs Config

- **CloudWatch - System Monitoring and Analizing Logs**
    - **Performance monitoring (metrics, CPU, network, etc...) & dashboards - Events & Alerting**
    - Log Aggregation & Analysis
- **CloudTrail - Logging everything about My AWS Accounts**
    - **Record API calls made within your Account by everyone** - Can define trails for specific resources
    - Global Service
- **Config = Managing Parameters**
    - **Record configuration changes**
    - Evaluate resources against compliance rules
    - Get timeline of changes and compliance

### Example : For an Elastic Load Balancer

- **CloudWatch:**
    - Monitoring Incoming connections metric
    - Visualize error codes as % over time
    - Make a dashboard to get an idea of your load balancer performance
- **Config:**
    - Track security group rules for the Load Balancer
    - Track configuration changes for the Load Balancer
    - Ensure an SSL certificate is always assigned to the Load Balancer (compliance)
- **CloudTrail:**
    - Track who made any changes to the Load Balancer with API calls

### 문제

Question 7:

팀원들 중 하나가 중요한 데이터를 포함하고 있는 EC2 인스턴스를 4개월 전에 중단했습니다. **누가 이런 작업을 했는지를 알지 못하는 관계로, CloudTrail을 사용해 이 기간 동안의 모든 API 호출을 검토**하려 합니다. CloudTrail은 이미 설정되어 있으며, S3 버킷으로 로그를 보내도록 구성이 되어 있습니다. 누가 이런 작업을 했는지 알아내기 위해서는 어떻게 해야 할까요?
• CloudTrail 콘솔의 CloudTrail 이벤트 내역을 활용
**• Amazon Athena로 S3 버킷 내의 CloudTrail 로그를 분석**

CloudTrail 콘솔은 지난 90일 간 보고된 API 활동을 확인하려는 경우 활용할 수 있습니다. 90일보다 오래된 이벤트의 경우에는 Athena를 사용해 S3 버킷 내에 저장된 CloudTrail 로그를 분석합니다.

Question 10:

**누군가가 리소스의 구성을 변경하여, 규정을 위반**하게 만들었습니다. 누가 이런 변경 사항을 만들었는지 알아내기 위해서는 다음 중 어떤 AWS 서비스를 사용해야 할까요?
• Amazon CloudWatch
**• AWS CloudTrail**
• AWS Config

Question 14:

한 DevOps 엔지니어가 회사에서 근무하며 AWS에서 인프라와 리소스를 관리하고 있습니다. 회사의 주요 애플리케이션에 대한 트래픽이 갑자기 폭증했는데, 이는 시기적으로 봤을 때 일반적이지 않은 현상입니다. 애플리케이션은 프라이빗 서브넷에 있는 몇 개의 EC2 인스턴스에서 호스팅되고, 퍼블릭 서브넷에 있는 애플리케이션 로드 밸런서에 의해 배포됩니다. DevOps 엔지니어는 이것이 정상적인 트래픽 증가인지 공격인지 확인하기 위하여 서브넷의 VPC 흐름 로그(Flow Logs)를 활성화하고 CloudWatch 로그 그룹에 로그를 저장했습니다. DevOps 엔지니어는 이 로그를 분석하여 웹 사이트에 요청을 보내는 **상위 IP 주소를 찾아 공격 의도가 있는지 확인**하려고 합니다. 다음 중 DevOps 엔지니어가 로그를 분석하는 데 도움을 받을 수 있는 것은 무엇입니까?
• CloudWatch 지표 스트림
• CloudWatch Alarm
**• CloudWatch Contributor Insights**
• CloudWatch 지표 필터

Question 16:

회사가 AWS에서 실행하고 있는 서버리스 애플리케이션은 애플리케이션 내부에 있는 서비스 간의 상호 통신 채널로 EventBridge를 사용합니다. 개발 환경 및 운영 환경에서 이벤트를 사용해 몇 가지 테스트를 진행해야 한다는 요구 사항이 있습니다. 테스트는 6개월에 한 번씩 진행하기 때문에 이벤트를 저장해 뒀다가 나중에 다시 사용해야 합니다. EventBridge 이벤트를 저장해 나중에 사용할 수 있는 가장 효과적이고 경제적인 방식은 무엇입니까?
• **EventBridge 아카이브 및 다시 재생(Replay) 기능을 사용한다.**
• 나중에 사용할 수 있도록 S3 버킷에 EventBridge 이벤트를 저장하는 Lambda 함수를 생성한다.
• EventBridge가 DynamoDB 테이블에 이벤트를 저장하도록 설정한다.

## **Advanced Identity in AWS**

### **Organizational Units (OU) - Examples**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20208.png)

### AWS Organizations

- **Allows to manage multiple AWS accounts, Global service**
- **The main account is the management account**
- **Other accounts are member accounts**
- Member accounts can only be part of one organization
- Pricing benefits from aggregated usage (volume discount for EC2, S3...)
- **Shared reserved instances and Savings Plans discounts across accounts**
- API is available to automate AWS account creation

### AWS Organizations

- Advantages
    - Multi Account vs One Account Multi VPC
    - Enable CloudTrail on all accounts, send logs to central S3 account
    - Establish Cross Account Roles for Admin purposes
- **Security: Service Control Policies (SCP)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20209.png)
    
    - **IAM policies applied to OU or Accounts to restrict Users and Roles**
    - **They do not apply to the management account (full admin power)**
    - Must have an explicit allow (does not allow anything by default – like IAM)

### IAM Policy와 IAM Service Control Policy 차이

chat gpt 

- **IAM Policy** is used to grant permissions to AWS resources and actions for an IAM user, group, or role.
- **IAM Service Control Policy (SCP),** on the other hand, is used to define permissions boundaries for entire AWS accounts or organizational units (OUs) in AWS Organizations.

### IAM Group과 IAM OU 차이

the main difference between IAM groups and OUs in AWS Organizations is that IAM groups are used to organize users within a single AWS account, **while OUs are used to organize multiple AWS accounts together and apply policies to those groups**

### IAM for S3

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20210.png)

- **문제로 종종 나온다니 체크**
- **s3:ListBucket permission applies to arn:aws:s3:::test**
    - **=> bucket level permission**
- **s3:GetObject, s3:PutObject,
s3:DeleteObject applies to arn:awn:s3:::test/***
- **=> object level permission**

### Resource Policies & aws:PrincipalOrgID

- aws:PrincipalOrgID can be used in any resource policies to restrict access to accounts that are member of an AWS Organization

### IAM Roles vs Resource Based Policies

- Cross account:
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20211.png)
    
    - attaching a resource-based policy to a resource (example: S3 bucket policy)
    - OR using a role as a proxy
- **When you assume a role (user, application or service), you give up your original permissions and take the permissions assigned to the role(Role을 부여받으면 기존에 있는 Role들은 해제됨)**
- **When using a resource-based policy, the principal doesn’t have to give up his permissions(반면 Policy를 건드리면 Role은 변함 없음)**
- Example: User in account A needs to scan a DynamoDB table in Account A and dump it in an S3 bucket in Account B.
- Supported by: Amazon S3 buckets, SNS topics, SQS queues, etc...

### Amazon EventBridge – Security

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20212.png)

- When a rule runs, it needs permissions on the target
- **종종 출제 된다고 하니 이해하자**
- **Resource-based policy: Lambda,
SNS, SQS, CloudWatch Logs, API Rule Gateway...**
- **IAM role: Kinesis stream, Systems Manager Run Command, ECS task...**

### IAM Permission Boundaries

- **IAM Permission Boundaries are supported for users and roles (not groups)**
- **Advanced feature to use a managed policy to set the maximum permissions an IAM entity can get.**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20213.png)
    

### **IAM Policy Evaluation Logic**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20214.png)

### Amazon Cognito

- **Give users an identity to interact with our web or mobile application**
- **Cognito User Pools:**
    - Sign in functionality for app users
    - Integrate with API Gateway & Application Load Balancer
- **Cognito Identity Pools (Federated Identity):**
    - Provide AWS credentials to users so they can access AWS resources directly
    - Integrate with Cognito User Pools as an identity provider
- Cognito vs IAM: “hundreds of users”, ”mobile users”,“authenticate with SAML”

### Cognito User Pools (CUP) – User Features

- Create a serverless database of user for your web & mobile apps
- Simple login: Username (or email) / password combination
- Password reset
- Email & Phone Number Verification
- Multi-factor authentication (MFA)
- Federated Identities: users from Facebook, Google, SAML...

### Cognito User Pools (CUP) - Integrations

- **CUP integrates with API Gateway and Application Load Balancer**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20215.png)

### Cognito Identity Pools (Federated Identities)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20216.png)

- **Get identities for “users” so they obtain temporary AWS credentials**
- Users source can be Cognito User Pools, 3rd party logins, etc...
- Users can then access AWS services directly or through API Gateway
- The IAM policies applied to the credentials are defined in Cognito
- They can be customized based on the user_id for fine grained control
- Default IAM roles for authenticated and guest users

### Cognito Identity Pools Row Level Security in DynamoDB

- Cognito와 Row Level Security를 연결 시킬 수 있다고 한다.  문제에서도 나오는듯
- Dynamo DB에서는 특정 Colum만 암호화해서 관리하는게 가능하다고 한다.

### AWS IAM Identity Center (successor to AWS Single Sign-On)

- 로그인 한 번으로 별도 로그인이 필요한 다른 서비스도 한 번에 로그인이 가능함.(ex AWS 로그인으로 Slack까지 함께 로그인)
- **One login (single sign-on) for all you**r
    - **AWS accounts in AWS Organizations**
    - Business cloud applications (e.g., Salesforce, Box, Microsoft 365, ...)
    - SAML2.0-enabled applications
    - EC2 Windows Instances
- Identity providers
    - **Built-in identity store in IAM Identity Center**
    - 3rd par ty: Active Director y (AD), OneLogin, Okta...

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20217.png)

### IAM Identity Center

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20218.png)

### AWS IAM Identity Center Fine-grained Permissions and Assignments

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20219.png)

- **Multi-Account Permissions**
    - Manage access across AWS accounts in your AWS Organization
    - Permission Sets – a collection of one or more IAM Policies assigned to users and groups to define AWS access
- **Application Assignments**
    - SSO access to many SAML 2.0 business applications (Salesforce, Box, Microsoft 365, ...)
    - Provide required URLs, certificates, and metadata
- **Attribute-Based Access Control (ABAC)**
    - Fine-grained permissions based on users’ attributes stored in
    - Example:costcenter,title,locale,...
    - Usecase:Definepermissionsonce,thenmodifyAWSaccessby changing the attributes

### What is Microsoft Active Directory (AD)?

- Found on any Windows Server with AD Domain Services
- Database of objects: User Accounts, Computers, Printers, File Shares, Security Groups
- Centralized security management, create account, assign permissions
- Objects are organized in trees
- A group of trees is a forest

### AWS Directory Services

- **AWS Managed Microsoft AD**
    - Create your own AD in AWS, manage users
    - Establish “trust” connections with your on- premises AD
- **AD Connector**
    - Directory Gateway (proxy) to redirect to on-
    - Users are managed on the on-premises AD
- **Simple AD**
    - AD-compatible managed directory on AWS
    - Cannot be joined with on-premises AD

### IAM Identity Center – Active Directory Setup

- Connect to an AWS Managed Microsoft AD (Directory Service)
    - Integration is out of the box
- Connect to a Self-Managed Directory
    - Create Two-way Trust Relationship using AWS Managed Microsoft AD
    - Create an AD Connector

### AWS Control Tower

- **Easy way to set up and govern a secure and compliant multi-account AWS environment based on best practices**
- **AWS Control Tower uses AWS Organizations to create accounts**
- Benefits:
    - Automate the set up of your environment in a few clicks
    - Automate ongoing policy management using guardrails
    - Detect policy violations and remediate them
    - Monitor compliance through an interactive dashboard

### AWS Control Tower – Guardrails

- Provides ongoing governance for your Control Tower environment (AWS Accounts)
- **Preventive Guardrail** – using SCPs (e.g., Restrict Regions across all your accounts)
- **Detective Guardrail** – using AWS Config (e.g., identify untagged resources)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20220.png)

## **AWS Security & Encryption**

### Why encryption? Encryption in flight (SSL)

- **Data is encrypted before sending and decrypted after receiving**
- SSL certificates help with encryption (HTTPS)
- Encryption in flight ensures no MITM (man in the middle attack) can happen

### **Server side encryption at rest**

- **Data is encrypted after being received by the server**
- **Data is decrypted before being sent**
- **It is stored in an encrypted form thanks to a key (usually a data key)**
- The encryption / decryption keys must be managed somewhere and the server must have access to it

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20221.png)

### Client side encryption

- **Data is encrypted by the client and never decrypted by the server**
- **Data will be decrypted by a receiving client**
- The server should not be able to decrypt the data
- Could leverage Envelope Encryption

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20222.png)

### AWS KMS (Key Management Service)

- **Anytime you hear “encryption” for an AWS service, it’s most likely KMS**
- AWS manages encryption keys for us
- Fully integrated with IAM for authorization
- Able to audit KMS Key usage using CloudTrail
- Seamlessly integrated into most AWS services (EBS, S3, RDS, SSM...)
- **Never ever store your secrets in plaintext, especially in your code!**
- KMS Key Encryption also available through API calls (SDK, CLI)
- Encrypted secrets can be stored in the code / environment variables

### KMS KeysTypes

- KMS Keys is the new name of KMS Customer Master Key
- **Symmetric (AES-256 keys)**
    - Single encryption key that is used to Encrypt and Decrypt
    - You never get access to the KMS Key unencrypted (must call KMS API to use)
- **Asymmetric (RSA & ECC key pairs)**
    - Used for Encrypt/Decrypt, or Sign/Verify operations
    - The public key is downloadable, but you can’t access the Private Key unencrypted
    - Use case: encryption outside of AWS by users who can’t call the KMS API

### AWS KMS (Key Management Service)

- Types of KMS Keys:
    - **AWS Managed Key: free (aws/service-name, example: aws/rds or aws/ebs)**
    - **Customer managed keys created in KMS: $1 / month**
    - **Customer managed keys imported (must be symmetric key): $1 / month**
    - ****+ pay for API call to KMS ($0.03 / 10000 calls)
- **Automatic Key rotation:**
    - **AWS Owned Keys (free): SSE-S3, SSE-SQS, SSE-DDB (default key)**
    - **AWS-managed KMS Key: automatic every 1 year**
    - **Customer-managed KMS Key: (must be enabled) automatic every 1 year**
    - **Imported KMS Key: only manual rotation possible using alias**

### **Copying Snapshots across regions**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20223.png)

### KMS Key Policies

- Control access to KMS keys, “similar” to S3 bucket policies
- Difference: you cannot control access without them
- Default KMS Key Policy:
    - Created if you don’t provide a specific KMS Key Policy
    - Complete access to the key to the root user = entire AWS account
- Custom KMS Key Policy:
    - Define users, roles that can access the KMS key
    - Define who can administer the key
    - Useful for cross-account access of your KMS key

### Copying Snapshots across accounts

1. Create a Snapshot, encrypted with your own KMS Key (Customer Managed Key)
2. **Attach a KMS Key Policy to authorize cross-account access**
3. Share the encrypted snapshot
4. (in target) Create a copy of the Snapshot, encrypt it with a CMK in your account
5. Create a volume from the snapshot

### KMS Multi-Region Keys

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20224.png)

- **Identical KMS keys in different AWS Regions that can be used interchangeably**
- Multi-Region keys have the same key ID, key material, automatic rotation...
- Encrypt in one Region and decrypt in other Regions
- No need to re-encrypt or making cross-Region API calls
- **KMS Multi-Region are NOT global (Primary + Replicas)**
- **Each Multi-Region key is managed independently**
- **Use cases: global client-side encryption, encryption on Global DynamoDB, Global Aurora**

### DynamoDB Global Tables and KMS Multi- Region Keys Client-Side encryption

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20225.png)

- We can encrypt specific attributes client-side in our DynamoDB table using the Amazon DynamoDB Encryption Client
- Combined with Global Tables, the client-side encrypted data is replicated to other regions
- If we use a multi-region key, replicated in the same region as the DynamoDB Global table, then clients in these regions can use low- latency API calls to KMS in their region to decrypt the data client-side
- Using client-side encryption we can protect specific fields and guarantee only decryption if the client has access to an API key

### Global Aurora and KMS Multi-Region Keys Client-Side encryption

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20226.png)

- We can encrypt specific attributes client-side in our Aurora table using the AWS Encryption SDK
- Combined with Aurora Global Tables, the client-side encrypted data is replicated to other regions
- If we use a multi-region key, replicated in the same region as the Global Aurora DB, then clients in these regions can use low-latency API calls to KMS in their region to decrypt the data client-side
- Using client-side encryption we can protect specific fields and guarantee only decryption if the client has access to an API key, we can protect specific fields even from database admins

### S3 Replication Encryption Considerations

- Unencrypted objects and objects encrypted with **SSE-S3** are replicated by default
- Objects encrypted with **SSE-C** (customer provided key) are **never** replicated
- For objects encrypted with **SSE-KMS**, you **need to enable** the option
    - Specify which KMS Key to encrypt the objects within the target bucket
    - Adapt the KMS Key Policy for the target key
    - An IAM Role with kms:Decrypt for the source KMS Key and kms:Encrypt for the target KMS Key
    - You might get KMS throttling errors, in which case you can ask for a Service Quotas increase
- You can use multi-region AWS KMS Keys, but they are currently treated as independent keys by Amazon S3 (the object will still be decrypted and then encr ypted)

### AMI Sharing Process Encrypted via KMS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20227.png)

1. AMI in Source Account is encrypted with KMS Key from Source Account
2. Must modify the image attribute to add a Launch Permission which corresponds to the specified target AWS account
3. Must share the KMS Keys used to encrypted the snapshot the AMI references with the target account / IAM Role
4. The IAM Role/User in the target account must have the permissions to DescribeKey, ReEncrypted, CreateGrant, Decrypt
5. When launching an EC2 instance from the AMI, optionally the target account can specify a new KMS key in its own account to re-encrypt the volumes

### SSM Parameter Store

- **Parameter를 중앙에서 관리한다.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20228.png)

- **Secure storage for configuration and secrets**
- Optional Seamless Encryption using KMS
- Serverless, scalable, durable, easy SDK
- Version tracking of configurations / secrets
- Security through IAM
- Notifications with Amazon EventBridge - Integration with CloudFormation

### SSM Parameter Store Hierarchy

- **주소 정리 방식으로 parameter를 정리한다.**
- /my-department/
    - my-app/ - dev/
        - db-url
        - db-password
- prod/
    - db-url
    - db-password
- other-app/
- /other-department/

### Parameters Policies (for advanced parameters)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20229.png)

- Allow to assign a TTL to a parameter (expiration date) to force updating or deleting sensitive data such as passwords
- Can assign multiple policies at a time

### AWS Secrets Manager

- **SSM 처럼 Parameter를 저장하는데, Secret으로 저장하고, Roate를 수행할 수 있는 특징이 있다.**
- Newer service, meant for storing secrets
- **Capability to force rotation of secrets every X days**
- Automate generation of secrets on rotation (uses Lambda)
- **Secrets are encrypted using KMS**
- **Mostly meant for RDS integration**

### AWS Secrets Manager – Multi-Region Secrets

- **Replicate Secrets across multiple AWS Regions**
- Secrets Manager keeps read replicas in sync with the primary Secret
- **Ability to promote a read replica Secret to a standalone Secret**
- Use cases: multi-region apps, disaster recovery strategies, multi-region DB...

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20230.png)

### AWS Certificate Manager (ACM)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20231.png)

- **Easily provision, manage, and deploy TLS Certificates**
- **Supports both public and privateTLS certificates**
- Free of charge for publicTLS certificates
- **Automatic** TLS certificate renewal
- **Integrations with (load TLS certificates on)**
    - **Elastic Load Balancers(CLB,ALB,NLB)**
    - **CloudFront Distributions**
    - **APIs on API Gateway**
    - **Cannot use ACM with EC2 (can’t be extracted)**

### ACM – Requesting Public Certificates

- List domain names to be included in the certificate
    - **Fully Qualified Domain Name (FQDN):** [corp.example.com](http://corp.example.com/)
    - **WildcardDomain**:*.example.com
- Select Validation Method: **DNS Validation** or Email validation
    - DNS Validation is preferred for automation purposes
    - Email validation will send emails to contact addresses in the WHOIS database
        - DNS Validation will leverage a CNAME record to DNS config (ex: Route 53)
- It will take a few hours to get verified
- The Public Certificate will be enrolled for automatic renewal
    - ACM automatically renews ACM-generated certificates 60 days before expiry

### ACM – Importing Public Certificates

- **Option to generate the certificate outside of ACM and then import it**
- **No automatic renewal**, must import a new certificate before expiry
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20232.png)
    
- ACM sends daily expiration events starting 45 days prior to expiration
    - The # of days can be configured
    - Events are appearing in EventBridge
- **AWS Config** has a managed rule named **acm-certificate-expiration-check** to check for expiring certificates (configurable number of days)

### **ACM – Integration with ALB**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20233.png)

### API Gateway - Endpoint Types

- **Edge-Optimized** (default): For global clients
    - Requests are routed through the CloudFront Edge locations (improves latency)
    - The API Gateway still lives in only one region
- **Regional:**
    - For clients within the same region
    - Could manually combine with CloudFront (more control over the caching strategies and the distribution)
- **Private:**
    - Can only be accessed from your VPC using an interface VPC endpoint (ENI)
    - Use a resource policy to define access

### ACM – Integration with API Gateway

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20234.png)

- Create a Custom Domain Name in API Gateway
- **Edge-Optimized (default): For global clients**
    - **위 그림**
    - Requests are routed through the CloudFront Edge locations
    (improves latency)
    - The API Gateway still lives in only one region
    - **The TLS Certificate must be in the same region as CloudFront, in us-east-1**
    - Then setup CNAME or (better) A-Alias record in Route53
- **Regional:**
    - **아래 그림**
    - For clients within the same region
    - **The TLS Certificate must be imported on API Gateway, in the same region as the API Stage**
    - Then setup CNAME or (better) A-Alias record in Route53

### AWS WAF – Web Application Firewall

- Protects your web applications from common web exploits (Layer 7)
- **Layer 7 is HTTP (vs Layer 4 is TCP/UDP)**
- Deploy on
    - Application Load Balancer
    - API Gateway
    - Amazon CloudFront distribution
    - AppSync GraphQL API
    - Cognito User Pool

### AWS WAF – Web Application Firewall

- **Define Web ACL (Web Access Control List) Rules:**
    - IP Set: up to 10,000 IP addresses – use multiple Rules for more IPs
    - HTTP headers, HTTP body, or URI strings Protects from common attack - **SQL injection** and **Cross-Site Scripting (XSS)**
    - Size constraints, **geo-match (block countries)**
    - Rate-based rules (to count occurrences of events) – for DDoS protection
- Web ACL are Regional except for CloudFront
- A rule group is a reusable set of rules that you can add to a web ACL

### WAF – Fixed IP while using WAF with a Load Balancer

- **WAF does not support the Network Load Balancer (Layer 4)**
- **We can use Global Accelerator for fixed IP and WAF on the ALB**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20235.png)

### AWS Shield: protect from DDoS attack

- DDoS: Distributed Denial of Service – many requests at the same time
- **AWS Shield Standard:**
    - Free service that is activated for every AWS customer
- **AWS Shield Advanced:**
    - 24/7 access to AWS DDoS response team (DRP)
    - Shield Advanced automatic application layer DDoS mitigation automatically creates, evaluates and deploys AWS WAF rules to mitigate layer 7 attacks
    layer 3/layer 4 attacks
    - Optional DDoS mitigation service ($3,000 per month per organization)
    - **Protect against more sophisticated attack on Amazon EC2, Elastic Load Balancing (ELB), Amazon CloudFront, AWS Global Accelerator, and Route 53**
    - Protect against higher fees during usage spikes due to DDoS

### AWS Firewall Manager

- **Manage rules in all accounts of an AWS Organization**
- Security policy: common set of security rules
    - **WAF rules (Application Load Balancer, API Gateways, CloudFront)**
    - AWS Shield Advanced (ALB, CLB, NLB, Elastic IP, CloudFront)
    - Security Groups for EC2, Application Load Balancer and ENI resources in VPC
    - AWS Network Firewall (VPC Level)
    - Amazon Route 53 Resolver DNS Firewall
    - Policies are created at the region level
- Rules are applied to new resources as they are created (good for compliance) across all and future accounts in your Organization

### WAF vs Firewall Manager vs Shield

- WAF, Shield and Firewall Manager are used together for comprehensive protection
- **Define your Web ACL rules in WAF**
- For granular protection of your resources, WAF alone is the correct choice
- If you want to use AWS WAF across accounts, accelerate WAF configuration, automate the protection of new resources, use Firewall Manager with AWS WAF
- Shield Advanced adds additional features on top of AWS WAF, such as dedicated support from the Shield ResponseTeam (SRT) and advanced reporting.
- If you’re prone to frequent DDoS attacks, consider purchasing Shield Advanced

### AWS Best Practices for DDoS Resiliency
Edge Location Mitigation (BP1, BP3)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20236.png)

- BP1 – CloudFront
    - Web Application delivery at
    - Protect from DDoS Common Attacks (SYN floods, UDP reflection...)
- BP1 – Global Accelerator
    - Access your application from
    - Integration with Shield for DDoS protection
    - Helpful if your backend is not compatible with CloudFront
- BP3 – Route 53
    - Domain Name Resolution at
    - DDoS Protection mechanism

### AWS Best Practices for DDoS Resiliency 
Best pratices for DDoS mitigation

- Infrastructure layer defense (BP1, BP3, BP6)
    - Protect Amazon EC2 against high traffic
    - That includes using Global Accelerator, Route 53, CloudFront, Elastic Load Balancing
- Amazon EC2 with Auto Scaling (BP7)
    - Helps scale in case of sudden traffic surges including a flash crowd or a DDoS attack
- Elastic Load Balancing (BP6)
    - Elastic Load Balancing scales with the traffic increases and will distribute the traffic to many EC2 instances

### AWS Best Practices for DDoS Resiliency Application Layer Defense

- Detectandfiltermaliciousweb requests (BP1, BP2)
    - CloudFront cache static content and serve it from edge locations, protecting your backend
    - **AWS WAF is used on top of CloudFront and Application Load Balancer to filter and block requests based on request signatures**
    - WAF rate-based rules can automatically block the IPs of bad actors
    - Use managed rules on WAF to block attacks based on IP reputation, or block anonymous Ips
    - CloudFront can block specific geographies
- ShieldAdvanced(BP1,BP2,BP6)
    - Shield Advanced automatic application layer DDoS mitigation automatically creates, evaluates and deploys AWS WAF rules to mitigate layer 7 attacks

### AWS Best Practices for DDoS Resiliency 
Attack surface reduction

- ObfuscatingAWSresources(BP1, BP4, BP6)
    - Using CloudFront, API Gateway, Elastic Load Balancing to hide your backend resources (Lambda functions, EC2 instances)
- Security groups and Network ACLs (BP5)
    - Use security groups and NACLs to filter traffic based on specific IP at the subnet or ENI-level
    - Elastic IP are protected by AWS Shield Advanced
- Protecting API endpoints(BP4)
    - Hide EC2, Lambda, elsewhere
    - Edge-optimized mode, or CloudFront + regional mode (more control for DDoS)
    - WAF + API Gateway: burst limits, headers filtering, use API keys

### Amazon Guard Duty

- **Logs를 보고 가능한 위협을 사전 식별하거나, 특이한 상황을 파악한다.**
- **Intelligent Threat discovery to protect your AWS Account**
- **Uses Machine Learning algorithms, anomaly detection, 3rd party data**
- One click to enable (30 days trial), no need to install software
- Input data includes:
    - **CloudTrail Events Logs** – unusual API calls, unauthorized deployments
        - Cloud Trail Management Events– create VPC subnet, createtrail,...
        - CloudTrailS3DataEvents–getobject, listobjects, deleteobject,...
    - **VPC Flow Logs** – unusual internal traffic, unusual IP address
    - **DNS Logs** – compromised EC2 instances sending encoded data within DNS queries
    - **Kubernetes Audit Logs** – suspicious activities and potential EKS cluster compromises
- Can setup EventBridge rules to be notified in case of findings
- EventBridge rules can target AWS Lambda or SNS
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20237.png)
    
- **Can protect against CryptoCurrency attacks (has a dedicated “finding” for it)**

### Amazon Inspector - Automated Security Assessments

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20238.png)

- **For EC2 instances**
    - Leveraging the AWS System Manager (SSM) agent
    - Analyze against unintended network accessibility
    - Analyze the running OS against known vulnerabilities
- **For Container Images push to Amazon ECR**
    - Assessment of Container Images as they are pushed
    dependencies
    - Assessment of functions as they are deployed
- **For Lambda Functions**
- Reporting & integration with AWS Security Hub
- Send findings to Amazon Event Bridge

### What does Amazon Inspector evaluate?

- Remember : only for EC2 instances, Container Images & Lambda functions - Continuous scanning of the infrastructure, only when needed
- Package vulnerabilities (EC2, ECR & Lambda) – database of CVE - Network reachability (EC2)
- A risk score is associated with all vulnerabilities for prioritization

### AWS Macie **- detect personally identifiable information (PII)**

- **Amazon Macie is a fully managed data security and data privacy service that uses machine learning and pattern matching to discover and protect your sensitive data in AWS.**
- Macie helps identify and alert you to sensitive data, such as **personally identifiable information (PII)**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20239.png)

### 문제

Question 8:

KMS CMK를 사용해 암호화된 EBS 스냅샷이 있는 AMI가 있습니다. 이 AMI를 다른 AWS 계정과 공유하려 합니다. AMI를 원하는 AWS 계정과 공유했으나, 다른 AWS 계정에서는 여전히 이를 사용할 수 없는 상태입니다. 이 경우, 어떻게 문제를 해결해야 할까요?
• 다른 AWS 계정이 로그아웃 후 다시 로그인해 자격 증명을 새로고침해야 함
**• AMI를 암호화하는 데에 사용된 KMS CMK를 다른 AWS 계정과 공유해야 함**
• 암호화된 EBS 스냅샷을 가진 AMI는 공유할 수 없음

Question 9:

S3 버킷과 EBS 스냅샷 모두를 암호화하는 데에 사용한 고객 관리형 CMK를 KMS에서 생성했습니다. 기업 정책에 따라 암호화 키를 매 3개월마다 교체해야 합니다. 어떻게 해야 할까요?
• KMS CMK를 다시 구성해 자동 교체를 활성화하고, ‘Period(기간)’를 3개월로 선택
• AWS에 의해 3개월 마다 자동으로 교체되는 AWS 관리 키를 사용
**• KMS CMK를 수동으로 교체. KMS CMK를 생성하고 키 별칭을 사용해 새로운 KMS CMK를 참조. 오래된 데이터의 복호화를 위해 기존의 KMS CMK는 유지**

**3개월 단위로는 자동으로 바꿀 수 없다. 자동 rotation은 1년으로 고정**

Question 12:

암호화 목적으로 사용하는 암호 값이 있고, 시간 경과에 따라 암호의 값을 저장하고 추적하려 합니다. 이 경우, 다음 중 어떤 AWS 서비스를 선택해야 할까요?
• AWS KMS 버전 관리 기능
**• SSM 파라미터 스토어**
• Amazon S3

SSM 파라미터 스토어는 암호를 저장하는 데에 사용될 수 있으며, 추적 기능이 내장되어 있습니다. 파라미터의 값을 감사할 때마다, SSM 파라미터 스토어가 파라미터의 새 버전을 생성하고 기존의 버전을 보관합니다. 값을 포함한 모든 파라미터 버전의 내역을 상세히 볼 수 있습니다.

Question 13:

사용자 대면 웹사이트는 디도스 공격에 취약하며, 여러분은 이러한 공격에 대비해 24/7 지원을 받고자 합니다. AWS는 공격 중 발생한 비용에 대한 배상을 제공하고 있습니다. 이 경우, 다음 중 어떤 AWS 서비스를 선택해야 할까요?
• AWS WAF
**• AWS Shield Advanced**
• AWS Shield
• AWS DDoS OpsTeam

Question 18:

다음 중 자동 순환을 지원하며, RDS DB 비밀번호를 저장하는 데에 가장 적합한 AWS 서비스는 무엇인가요?
**• AWS Secrets Manager**
• AWS KMS
• AWS SSM Parameter Store

Question 22:

SSE-KMS로 암호화된 S3 버킷이 있습니다. 동일한 AWS 리전에 있지만 KMS 키가 다른 대상 버킷으로 객체를 복제하는 업무를 맡았습니다. S3 복제, 대상 버킷, 대상 KMS 키를 모두 설정했지만 여전히 동작하지 않습니다. S3 복제가 동작하는 데 부족한 것은 무엇입니까?
• 지원하지 않는 기능이다.
• AWS에 복제 프로세스를 시작해 달라는 지원 티켓을 등록해야 한다.
• S3 복제 서비스에서 소스 KMS 키 kms:Decrypt와 대상 KMS 키 kms:Encrypt를 모두 사용할 수 있도록 권한을 설정해야 한다.
• 소스 KMS 키와 대상 KMS 키가 동일해야 한다.

Question 23:

LetsEncrypt로 공용 인증서를 생성하고 EC2 인스턴스로 트래픽을 전달하는 애플리케이션 로드 밸런서에 사용 및 연결할 수 있도록 ACM에 인증서를 업로드했습니다. 이 인증서는 AWS 외부에서 발급됐기 때문에 자동 갱신 기능을 지원하지 않습니다. 새 인증서를 직접 발급받을 수 있도록 인증서 만료 30일 전에 알림을 받으려면 어떻게 해야 합니까?
• ACM을 외부 인증서 발급 기관인 LetsEncrypt에 연결해 알림을 보내도록 설정한다.
**• ACM에서 일일 만료 이벤트에 대한 EventBridge를 구성하여 이메일로 SNS 알림을 보내도록 한다.**
• ACM에서 월별 만료 이벤트에 대한 EventBridge를 구성하여 이메일로 SNS 알림을 보내도록 한다.
• ACM에서 일일 만료 이벤트에 대한 CloudWatch Alarms 구성하여 이메일로 SNS 알림을 보내도록 한다.

- **월별 만료 이벤트는 없다. 일일 이벤트만 있음**

Question 24:

AWS 리전 `us-west-2`에 메인 엣지 최적화 API Gateway를 생성했습니다. 이 엣지 최적화 API Gateway는 `ap-southeast-1`에 있는 하위 레벨 API Gateway로 트래픽을 전달합니다. 메인 API Gateway를 보호하기 위해 ACM 인증서를 연결하려고 합니다. 어느 AWS 리전에서 ACM 인증서를 생성해야 합니까?
**• `us-east-1`**
• `us-west-2`
• `ap-southeast-1`
• `us-east-1` 와  `us-west-2` 모두 가능하다.

**Answer**

엣지 최적화 API Gateway는 배후에서 AWS가 관리하는 사용자 지정 CloudFront 배포를 사용하여 CloudFront 엣지 로케이션을 거쳐 전 세계로 요청을 라우팅하기 때문에 ACM 인증서는 us-east-1 리전에 생성해야 합니다.

## **Virtual Private Cloud (VPC)**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20240.png)

### Understanding CIDR – IPv4 **– a method for allocating IP addresses**

- Used in Security Groups rules and AWS networking in general
- **They help to define an IP address range:**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20241.png)
    

### Understanding CIDR – IPv4

- **A CIDR  = Base IP + Subnet Mask**
- **Base IP**
    - Represents an IP contained in the range (XX.XX.XX.XX) - Example:10.0.0.0,192.168.0.0,...
- **Subnet Mask**
    - **Defines how many bits can change in the IP**
    - Can take two forms:
    - /8 → 255.0.0.0
    - /16 → 255.255.0.0
    - /24 → 255.255.255.0
    - /32 → 255.255.255.255

### Public vs. Private IP (IPv4)

- The Internet Assigned Numbers Authority (IANA) established certain blocks of IPv4 addresses for the use of private **(LAN)** and public **(Internet)** addresses
- **Private IP can only allow certain values:**
    - **10.0.0.0 – 10.255.255.255 (10.0.0.0/8) → in big networks**
    - **172.16.0.0 – 172.31.255.255 (172.16.0.0/12) → AWS default VPC in that range**
    - **192.168.0.0 – 192.168.255.255 (192.168.0.0/16)  → e.g., home networks**
- **All the rest of the IP addresses on the Internet are Public**

### Default VPC Walkthrough

- All new AWS accounts have a default VPC
- New EC2 instances are launched into the default VPC if no subnet is specified
- Default VPC has Internet connectivity and all EC2 instances inside it have public IPv4 addresses
- We also get a public and a private IPv4 DNS names

### VPC in AWS – IPv4

- VPC =Virtual Private Cloud
- You can have multiple VPCs in an AWS region (max. 5 per region – soft limit)
- **Max. CIDR per VPC is 5, for each CIDR:**
    - 하나 Region 내에서 CIDR는 5개까지 가능
    - **Max. size is /16 (65536 IP addresses)**
    - **Min. size is /28 (16 IP addresses)**
- **Because VPC is private, only the Private IPv4 ranges are allowed:**
    - **10.0.0.0 – 10.255.255.255 (10.0.0.0/8)**
    - **172.16.0.0 – 172.31.255.255 (172.16.0.0/12)**
    - **192.168.0.0 – 192.168.255.255 (192.168.0.0/16)**
- **Your VPC CIDR should NOT overlap with your other networks (e.g., corporate)**

### VPC – Subnet (IPv4)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20242.png)

- **AWS reserves 5 IP addresses (first 4 & last 1) in each subnet**
- **These 5 IP addresses are not available for use and can’t be assigned to an EC2 instance**
- Example: if CIDR block 10.0.0.0/24, then reserved IP addresses are:
    - **10.0.0.0** – Network Address
    - **10.0.0.1** – reser ved by AWS for the VPC router
    - **10.0.0.2** – reserved by AWS for mapping to Amazon-provided DNS
    - **10.0.0.3** – reserved by AWS for future use
    - **10.0.0.255** – Network Broadcast Address.AWS does not support broadcast in aVPC, therefore the address is reserved
- **Exam Tip, if you need 29 IP addresses for EC2 instances:**
    - You can’t choose a subnet of size /27 (32 IP addresses, 32 – 5 = 27 < 29)
    - You need to choose a subnet of size /26 (64 IP addresses, 64 – 5 = 59 > 29)

### Internet Gateway (IGW)

- **Allows resources (e.g., EC2 instances) in a VPC connect to the Internet**
- It scales horizontally and is highly available and redundant
- Must be created separately from a VPC
- **One VPC can only be attached to one IGW and vice versa**
- Internet Gateways on their own do not allow Internet access...
- **Route tables must also be edited!**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20243.png)

### Bastion Hosts

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20244.png)

- **We can use a Bastion Host to SSH into our private EC2 instances**
- The bastion is in the public subnet which is then connected to all other private subnets
- **Bastion Host security group must allow inbound from the internet on port 22 from restricted CIDR**, for example the public CIDR of your corporation
- **Security Group of the EC2 Instances must allow the Security Group of the Bastion Host, or the private IP of the Bastion host**

### NAT Instance (outdated, but still at the exam)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20245.png)

- NAT = Network Address Translation
- Allows EC2 instances in private subnets to connect to the Internet
- **Must be launched in a public subnet**
- Must disable EC2 setting: Source / destination Check
- **Must have Elastic IP attached to it**
- RouteTables must be configured to route traffic from private subnets to the NAT Instance

### NAT Instance – Comments

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20246.png)

- Pre-configured Amazon Linux AMI is available
    - Reached the end of standard support on December 31, 2020
- Not highly available / resilient setup out of the box
- You need to create an ASG in multi-AZ + resilient user-data script
- Internet traffic bandwidth depends on EC2 instance type
- You must manage Security Groups & rules:
    - Inbound:
        - Allow HTTP / HTTPS traffic coming from Private Subnets
        - Allow SSH from your home network (access is provided through Internet Gateway)
    - Outbound:
    - Allow HTTP / HTTPS traffic to the Internet

### NAT Gateway

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20247.png)

- **AWS-managed NAT, higher bandwidth, high availability, no administration**
- **NATGW is created in a specific Availability Zone, uses an Elastic IP**
- **Requires an IGW (Private Subnet => NATGW => IGW)**
- 5 Gbps of bandwidth with automatic scaling up to 45 Gbps
- **No Security Groups to manage / required**

### NAT Gateway with High Availability

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20248.png)

- NAT Gateway is resilient within a single Availability Zone
- **Must create multiple NAT Gateways in multiple AZs for fault-tolerance**
- There is no cross-AZ failover needed because if an AZ goes down it doesn't need NAT

### NAT Gateway Vs NAT Instance

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20249.png)

### Security Groups & NACLs

### stateful과 stateless 차이

- **Stateful - Security Group**
    - 외부에서 instance에 접근해 html 파일을 받아오는 과정이라 생각할 때, outbound가 없더라도 inbound에서 승인이 된 건 바로 나갈 수 있음.
    - 따라서 sg의 outbound는 instance에서 outbound로 나가는 것을 차단하는 것임
- **Stateless - NACL**
    - 나가든 들어가든 무조건 검사 받아야함.

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20250.png)

### Network Access Control List (NACL) - Stateless

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20251.png)

- NACL are like a firewall which control traffic from and to subnets
- **One NACL per subnet, new subnets are assigned the Default NACL**
- You define NACL Rules:
    - Rules have a number (1-32766), higher precedence with a lower number
    - First rule match will drive the decision
    - Example: if you define #100 ALLOW 10.0.0.10/32 and #200 DENY 10.0.0.10/32, the IP address will be allowed because 100 has a higher precedence over 200
    - The last rule is an asterisk (*) and denies a request in case of no rule match
    - AWS recommends adding rules by increment of 100
- **Newly created NACLs will deny everything**
- **NACL are a great way of blocking a specific IP address at the subnet level**

### Default NACL

- **Accepts everything inbound/outbound with the subnets it’s associated with**
    - Rule *이 기본 세팅값임. Default NACL은 거기에 Rule 100 짜리 Access Control을 세팅한 것
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20252.png)
    
- **Do NOT modify the Default NACL, instead create custom NACLs**

### Ephemeral Ports

- **For any two endpoints to establish a connection, they must use ports**
- **Clients connect to a defined port, and expect a response on an ephemeral port**
- Different Operating Systems use different port ranges, examples:
    - IANA & MS Windows10 → 49152–65535
    - Many Linux Kernels → 32768 – 60999

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20253.png)

### **NACL with Ephemeral Ports**

- NACL의 Port를 잘 설정 해야함. 왜냐하면 ephemeral ports는 범위에서 임의로 선택되는 것이기 때문

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20254.png)

### Security Group vs NACL

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20255.png)

### VPC Peering

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20256.png)

- **Privately connect two VPCs using AWS’ network**
- **Make them behave as if they were in the same network**
- **Must not have overlapping CIDRs**
- VPC Peering connection is NOT transitive
(must be established for each VPC that need to communicate with one another)
- **You must update route tables in each VPC’s subnets to ensure EC2 instances can communicate with each other**

### VPC Peering – Good to know

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20257.png)

- You can create VPC Peering connection between VPCs in different AWS accounts/regions
- You can reference a security group in a peeredVPC (works cross accounts – same region)

### VPC Endpoints (AWS PrivateLink)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20258.png)

- **Every AWS service is publicly exposed (public URL)**
- **VPC Endpoints (powered by AWS PrivateLink) allows you to connect to AWS services using a private network instead of using the public Internet**
- They remove the need of IGW, NATGW, ... to access AWS Services
- In case of issues:
    - Check DNS Setting Resolution in your VPC
    - CheckRouteTables

### Types of Endpoints

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20259.png)

- **Interface Endpoints (powered by PrivateLink)**
    - Provisions an ENI (private IP address) as an entry
    point (must attach a Security Group)
    - **Supports most AWS services**
    - $ per hour + $ per GB of data processed
- **Gateway Endpoints**
    - **Provisions a gateway and must be used as a target in a route table (does not use security groups)**
    - **Supports both S3 and DynamoDB**
    - **Free**

### Gateway or Interface Endpoint for S3?

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20260.png)

- **Gateway is most likely going to be preferred all the time at the exam**
- Cost: free for Gateway, $ for interface endpoint
- **Interface Endpoint is preferred access is required from on- premises (Site to Site VPN or Direct Connect), a different VPC or a different region**

### Lambda in VPC accessing DynamoDB

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20261.png)

- Lambda를 Private Subnet에 배포할 수도 있군.
- DynamoDB is a public service from AWS
- **Option1 : Access from the public internet**
- Because Lambda is in a VPC, it needs a NAT Gateway in a public subnet and an internet gateway.
- **Option 2 (better & free): Access from the private VPC network**
    - Deploy a VPC Gateway endpoint for DynamoDB
    - Change the Route Tables

### VPC Flow Logs

- **Capture information about IP traffic going into your interfaces:**
    - VPC Flow Logs
    - Subnet Flow Logs
    - Elastic Network Interface (ENI) Flow Logs
- Helps to monitor & troubleshoot connectivity issues
- Flow logs data can go to S3, CloudWatch Logs, and Kinesis Data Firehose
- Captures network information from AWS managed interfaces too: ELB, RDS, ElastiCache, Redshift, WorkSpaces, NATGW,Transit Gateway...

### VPC Flow Logs Syntax

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20262.png)

- srcaddr & dstaddr – help identify problematic IP
- srcport & dstport – help identity problematic ports
srcaddr
end
- Action – success or failure of the request due to Security Group / NACL
- Can be used for analytics on usage patterns, or malicious behavior
- Query VPC flow logs using Athena on S3 or CloudWatch Logs Insights
- **Flow Logs examples:**  [https://docs.aws.amazon.com/athena/latest/ug/vpc-flow-logs.html](https://docs.aws.amazon.com/athena/latest/ug/vpc-flow-logs.html)
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20263.png)
    

### AWS Site-to-Site VPN

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20264.png)

- **Virtual Private Gateway (VGW)**
    - **VPN concentrator on the AWS side of the VPN connection**
    - VGW is created and attached to the VPC from which you want to create the Site-to-Site VPN connection
    - Possibility to customize the ASN (Autonomous System Number)
- **Customer Gateway (CGW)**
    - **Software application or physical device on customer side of the VPN connection**
    - [https://docs.aws.amazon.com/vpn/latest/s2svpn/your-cgw.html#DevicesTested](https://docs.aws.amazon.com/vpn/latest/s2svpn/your-cgw.html#DevicesTested)

### Site-to-Site VPN Connections

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20265.png)

- **Customer Gateway Device (On-premises)**
    - What IP address to use?
        - Public Internet-routable IP address for your Customer Gateway device
        - If it’s behind a NAT device that’s enabled for NAT traversal (NAT-T), use the public IP address of the NAT device
- **Important step: enable Route Propagation for the Virtual Private Gateway in the route table that is associated with your subnets**
- If you need to ping your EC2 instances from on-premises, make sure you add the ICMP protocol on the inbound of your security groups

### AWS VPN CloudHub

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20266.png)

- **Provide secure communication between multiple sites, if you have multiple VPN connections**
- Low-cost hub-and-spoke model for primary or secondary network connectivity between different locations (VPN only)
- It’s a VPN connection so it goes over the public Internet
- To set it up, connect multiple VPN connections on the same VGW, setup dynamic routing and configure route tables

### Direct Connect (DX)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20267.png)

- **Provides a dedicated private connection from a remote network to your VPC**
- Dedicated connection must be setup between your DC and AWS Direct Connect locations
- You need to setup aVirtual Private Gateway on yourVPC
- Access public resources (S3) and private (EC2) on same connection
- Use Cases:
    - Increase bandwidth throughput - working with large data sets – lower cost
    - More consistent network experience - applications using real-time data feeds
    - Hybrid Environments (on prem + cloud)
- Supports both IPv4 and IPv6

### Direct Connect Gateway

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20268.png)

- I**f you want to setup a Direct Connect to one or more VPC in many different regions (same account), you must use a Direct Connect Gateway**

### Direct Connect – Connection Types

- **Dedicated Connections:** 1 Gbps,10 Gbps and 100 Gbps capacity
    - **Physical ethernet port dedicated to a customer**
    - Request made to AWS first, then completed by AWS Direct Connect Partners
- **Hosted Connections:** 50Mbps, 500 Mbps, to 10 Gbps
    - Connection requests are made via AWS Direct Connect Partners
    - Capacity can be added or removed on demand
    - 1, 2, 5, 10 Gbps available at select AWS Direct Connect Partners
- **Lead times are often longer than 1 month to establish a new connection**

### Direct Connect – Encryption

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20269.png)

- **Data in transit is not encrypted but is private**
- AWS Direct Connect + VPN provides an IPsec-encrypted private connection
- Good for an extra level of security, but slightly more complex to put in place

### **Direct Connect - Resiliency**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20270.png)

### **Site-to-Site VPN connection as a backup**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20271.png)

- I**n case Direct Connect fails, you can set up a backup Direct Connect connection (expensive), or a Site-to-Site VPN connection**

### Transit Gateway

- 문제
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20272.png)
    
- 해결

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20273.png)

- **For having transitive peering between thousands of VPC and on-premises, hub-and-spoke (star) connection**
- Regional resource, can work cross-region
- Share cross-account using Resource Access Manager (RAM)
- You can peer Transit Gateways across regions
- RouteTables:limitwhichVPCcantalkwithotherVPC
- Works with Direct Connect Gateway,VPN connections
- **Supports IP Multicast (not supported by any other AWS ser vice)**

### Transit Gateway: Site-to-Site VPN ECMP

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20274.png)

- **ECMP = Equal-cost multi-path routing**
- Routing strategy to allow to forward a packet over multiple best path
- **Use case: create multiple Site- to-Site VPN connections to increase the bandwidth of your connection to AWS**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20275.png)
    

### Transit Gateway – Share Direct Connect between multiple accounts

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20276.png)

### VPC – Traffic Mirroring

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20277.png)

- **Allows you to capture and inspect network traffic in your VPC**
- Route the traffic to security appliances that you manage
- Capture the traffic
    - From (Source) – ENIs
    - To (Targets) – an ENI or a Network Load Balancer
- Capture all packets or capture the packets of your interest (optionally, truncate packets)
- Source and Target can be in the same VPC or different VPCs (VPC Peering)
- Use cases: content inspection, threat monitoring, troubleshooting, ...

### What is IPv6?

- IPv4 designed to provide 4.3 Billion addresses (they’ll be exhausted soon)
- IPv6 is the successor of IPv4
- IPv6 is designed to provide **3.4 × 10^38**, unique IP addresses
- Every IPv6 address is public and Internet-routable (no private range)
- Format →  x.x.x.x.x.x.x.x (x is hexadecimal, range can be from 0000 to ffff)

### IPv6 in VPC

- You can enable IPv6 (they’re public IP addresses) to operate in dual-stack mode
- Your EC2 instances will get at least a private internal IPv4 and a public IPv6
- They can communicate using either IPv4 or IPv6 to the internet through an Internet Gateway

### IPv6 Troubleshooting

- **IPv4 cannot be disabled for your VPC and subnets**
- **So, if you cannot launch an EC2 instance in your subnet**
    - It’s not because it cannot acquire an IPv6 (the space is very large)
    - **It’s because there are no available IPv4 in your subnet**
- Solution: create a new IPv4 CIDR in your subnet

### Egress-only Internet Gateway

- **Used for IPv6 only**
- (similar to a NAT Gateway but for IPv6)
- **Allows instances in your VPC outbound connections over IPv6 while preventing the internet to initiate an IPv6 connection to your instances**
- You must update the Route Tables

### VPC Section Summary (1/3)

- **CIDR –** IP Range
- **VPC –** Virtual Private Cloud => we define a list of IPv4 & IPv6 CIDR
- **Subnets –** tied to an AZ, we define a CIDR
- **Internet Gateway –** at the VPC level, provide IPv4 & IPv6 Internet Access
- **RouteTables –** must be edited to add routes from subnets to the IGW,VPC Peering Connections,VPC Endpoints, ...
- **Bastion Host –** public EC2 instance to SSH into, that has SSH connectivity to EC2 instances in private subnets
- **NAT Instances –** gives Internet access to EC2 instances in private subnets. Old, must be setup in a public subnet, disable Source / Destination check flag
- **NAT Gateway –** managed by AWS, provides scalable Internet access to private EC2 instances, IPv4 only
- **Private DNS + Route 53 –** enable DNS Resolution + DNS Hostnames (VPC)

### VPC Section Summary (2/3)

- **NACL –** stateless, subnet rules for inbound and outbound, don’t forget Ephemeral Ports
- **Security Groups –** stateful, operate at the EC2 instance level
- Reachability Analyzer – perform network connectivity testing between AWS resources
- **VPC Peering** – connect two VPCs with non overlapping CIDR, non-transitive
- **VPC Endpoints –** provide private access to AWS Services (S3, DynamoDB, CloudFormation, SSM) within a VPC
- **VPC Flow Logs –** can be setup at the VPC / Subnet / ENI Level, for ACCEPT and REJECT traffic, helps identifying attacks, analyze using Athena or CloudWatch Logs Insights
- **Site-to-SiteVPN** – setup a Customer Gateway on DC,a Virtual Private Gateway on VPC, and site-to-site VPN over public Internet
- **AWS VPN CloudHub –** hub-and-spoke VPN model to connect your sites

### VPC Section Summary (3/3)

- **Direct Connect –** setup a Virtual Private Gateway on VPC, and establish a direct private connection to an AWS Direct Connect Location
- **Direct Connect Gateway –** setup a Direct Connect to many VPCs in different AWS regions
- **AWS PrivateLink / VPC Endpoint Services**:
    - Connect services privately from your service VPC to customers VPC
    - Doesn’t need VPC Peering, public Internet, NAT Gateway, Route Tables
    - Must be used with Network Load Balancer & ENI
- **Transit Gateway –** transitive peering connections for VPC,VPN & DX
- **Traffic Mirroring –** copy network traffic from ENIs for further analysis
- **Egress-**only Internet Gateway – like a NAT Gateway, but for IPv6

### Networking Costs in AWS per GB - Simplified

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20278.png)

- **Use Private IP instead of Public IP for good savings and better network performance**
- Use same AZ for maximum savings (at the cost of high availability)

### Minimizing egress traffic network cost

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20279.png)

- **Egress traffic:** outbound traffic (from AWS to outside)
- **Ingress traffic:** inbound traffic - from outside to AWS (typically free)
- Try to keep as much internet traffic within AWS to minimize costs
- **Direct Connect locations that are co-located in the same AWS Region result in lower cost for egress network**

### S3 Data Transfer Pricing – Analysis for USA

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20280.png)

- **S3ingress**: free
- **S3 to Internet**: $0.09 per GB
- **S3 Transfer Acceleration:**
    - Faster transfer times (50 to 500%better)
- **Additional cost on top of Dat aTransfer Pricing:** +$0.04 to $0.08 per GB
- **S3 to CloudFront**: $0.00 per GB
- **CloudFront to Internet**: $0.085 per GB
(slightly cheaper than S3)
    - Caching capability(lowerlatency)
    - Reduce costs associated with S3 Requests Pricing (7x cheaper with CloudFront)
    - S3 Cross Region Replication: $0.02 per GB

### Pricing: NAT Gateway vs Gateway VPC Endpoint

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20281.png)

### Network Protection on AWS

- To protect network on AWS, we’ve seen - Network Access Control Lists (NACLs)
    - Amazon VPC security groups
    - AWS WAF (protect against malicious requests)
    - AWS Shield & AWS Shield Advanced
    - AWS Firewall Manager (to manage them across accounts)
- But **what if we want to protect in a sophisticated way our entire VPC?**

### AWS Network Firewall

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20282.png)

- **Protect your entire Amazon VPC**
- **VPC에서 3계층부터 7계층까지 트래픽을 보호하고 제어할 수 있는 AWS 서비스**
- Any direction, you can inspect
    - VPC to VPC traffic
    - Outbound to internet
    - Inbound from internet
    - To / from Direct Connect & Site-to-Site VPN
- **Internally, the AWS Network Firewall uses the AWS Gateway Load Balancer**
- Rules can be centrally managed cross- account by AWS Firewall Manager to apply to many VPCs

### Network Firewall – Fine Grained Controls

- Supports 1000s of rules
    - IP & port - example: 10,000s of IPs filtering
    - Protocol – example: block the SMB protocol for outbound communications
    - Stateful domain list rule groups: only allow outbound traffic to *.mycorp.com or third-party software repo
    - General pattern matching using regex
- Traffic filtering:Allow,drop,or alert for the traffic that matches the rules
- **Active flow inspection to protect against network threats with intrusion-prevention capabilities (like Gateway Load Balancer, but all managed by AWS)**
- Send logs of rule matches to Amazon S3, CloudWatch Logs, Kinesis Data Firehose

### 문제

Question 5

인터넷 게이트웨이를 VPC에 연결했으나, 여전히 인터넷을 통한 EC2 인스턴스 액세스가 불가능한 상태입니다. 이런 경우, 가능성이 있는 원인이 아닌 것을 고르세요
• 라우팅 테이블에 항목이 누락됨
• EC2 인스턴스에 공용 IP가 없음
**• 보안 그룹이 들어오는 트래픽을 허용하지 않음**
• NACL이 나가는 네트워크 트래픽을 허용하지 않음

보안 그룹은 상태를 유지하기 때문에, 트래픽이 나갈 수 있다면 다시 들어갈 수도 있습니다.

Question 20:

한 웹 애플리케이션의 백엔드는 퍼블릭 서브넷의 애플리케이션 로드 밸런서 뒤에 있는 프라이빗 서브넷의 EC2 인스턴스에서 호스팅되고 있습니다. 백엔드 EC2 인스턴스를 인터넷에 노출하지 않고 일부 개발자에게 백엔드 EC2 인스턴스에 대한 액세스 권한을 부여해야 합니다. 퍼블릭 서브넷에 배스천 호스트(Bastion Host) EC2 인스턴스를 생성하고 백엔드 EC2 인스턴스 보안 그룹이 배스천 호스트로부터 트래픽을 받을 수 있도록 설정했습니다. 다음 중 배스천 호스트 보안 그룹의 보안 설정으로 가장 적절한 것은 무엇입니까?
• 회사의 퍼블릭 CIDR에서 80번 포트로 들어오는 트래픽만 허용한다.
**• 회사의 퍼블릭 CIDR에서 22번 포트로 들어오는 트래픽만 허용한다.**
• 회사의 프라이빗 CIDR에서 22번 포트로 들어오는 트래픽만 허용한다.
• 회사의 프라이빗 CIDR에서 80번 포트로 들어오는 트래픽만 허용한다.

Question 23:

한 웹 애플리케이션이 오토 스케일링 그룹으로 관리하는 EC2 인스턴스 세트에 호스팅되어 있습니다. 애플리케이션은 애플리케이션 로드 밸런서(ALB)를 통해 배포되고 있습니다. EC2 인스턴스와 ALB는 모두 CIDR이 `192.168.0.0/18`인 VPC에 배포됩니다. ALB만 `80`번 포트에서 액세스할 수 있도록 EC2 인스턴스의 보안 그룹을 구성하려면 어떻게 해야 합니까?
• 소스 주소 0.0.0.0/0에서 80 포트에 대한 인바운드 규칙을 추가한다.
• 소스 주소 192.168.0.0/18에서 80 포트에 대한 인바운드 규칙을 추가한다.
**• 소스를 ALB 보안 그룹으로 지정하고 80 포트에 대한 인바운드 규칙을 추가한다.**
• ALB에 SSL 인증서를 로드한다.

## **Disaster Recovery & Migrations**

### Disaster Recovery Overview

- Any event that has a negative impact on a company’s business continuity or finances is a disaster
- **Disaster recovery (DR) is about preparing for and recovering from a disaster**
- **What kind of disaster recovery?**
    - On-premise => On-premise: traditional DR, and very expensive
    - On-premise => AWS Cloud: hybrid recovery
    - AWS Cloud Region A => AWS Cloud Region B
- Need to define two terms:
    - **RPO: Recovery Point Objective**
    - **RTO: Recovery Time Objective**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20283.png)
    

### Disaster Recovery Strategies

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20284.png)

- **Backup and Restore(High RPO)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20285.png)
    
- **Pilot Light(=critical core)**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20286.png)
    
    - A small version of the app is always running in the cloud
    - Useful for the critical core(=pilot light)
    - Very similar to Backup and Restore
    - Faster than Backup and Restore as critical systems are already up
- **Warm Standby**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20287.png)
    
    - Full system is up and running, but at minimum size
    - Upon disaster, we can scale to production load
- **Hot Site / Multi Site Approach**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20288.png)
    
    - **Very low RTO (minutes or seconds) – very expensive**
    - Full Production Scale is running AWS and On Premise

### Disaster RecoveryTips(읽어보면 좋음)

- **Backup**
    - EBS Snapshots, RDS automated backups / Snapshots, etc...
    - Regular pushes to S3 / S3 IA / Glacier, Lifecycle Policy, Cross Region Replication
    - From On-Premise: Snowball or Storage Gateway
- **High Availability**
    - Use Route53 to migrate DNS over from Region to Region
    - RDS Multi-AZ, ElastiCache Multi-AZ, EFS, S3
    - Site to Site VPN as a recover y from Direct Connect
- **Replication**
    - RDS Replication (Cross Region), AWS Aurora + Global Databases
    - Database replication from on-premises to RDS
    - Storage Gateway
- **Automation**
    - CloudFormation / Elastic Beanstalk to re-create a whole new environment
    - Recover / Reboot EC2 instances with CloudWatch if alarms fail
    - AWS Lambda functions for customized automations
- **Chaos**
    - Netflix has a “simian-army” randomly terminating EC2

### DMS – Database Migration Service

- **Quickly and securely migrate databases to AWS,** resilient, self healing
- The source database remains available during the migration
- Supports:
    - Homogeneous migrations: ex Oracle to
    Oracle
    - Heterogeneous migrations: ex Microsoft SQL Server to Aurora
- Continuous Data Replication using CDC
- **You must create an EC2 instance to perform the replication**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20289.png)
    

### AWS Schema Conversion Tool (SCT)

- **Convert your Database’s Schema from one engine to another**
- Example OLTP: (SQL Server or Oracle) to MySQL, PostgreSQL, Aurora - Example OLAP: (Teradata or Oracle) to Amazon Redshift
- Prefer compute-intensive instances to optimize data conversions
- **You do not need to use SCT if you are migrating the same DB engine**
    - Ex: On-Premise PostgreSQL => RDS PostgreSQL
    - The DB engine is still PostgreSQL (RDS is the platform)

### **RDS & Aurora MySQL Migrations**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20290.png)

- **RDS MySQL to Aurora MySQL**
    - Option 1: DB Snapshots from RDS MySQL restored as MySQL Aurora DB
    - Option 2: Create an Aurora Read Replica from your RDS MySQL, and when the replication lag is 0, promote it as its own DB cluster (can take time and cost $)
- **External MySQL to Aurora MySQL**
    - Option 1:
        - Use Percona XtraBackup to create a file backup in Amazon S3
        - Create an Aurora MySQL DB from Amazon S3
    - Option 2:
        - Create an Aurora MySQL DB
        - Use the mysqldump utility to migrate MySQL into Aurora (slower than S3 method)
- Use DMS if both databases are up and running

### On-Premise strategy with AWS

- On-premise와 관련 있는 거라는 사실만 이해하고 넘어가자
- **Ability to download Amazon Linux 2 AMI as a VM (.iso format)**
    - VMWare, KVM,VirtualBox (Oracle VM), Microsoft Hyper-V
- **VM Import / Export**
    - Migrate existing applications into EC2
    - Create a DR repository strategy for your on-premisesVMs
    - Can expor t back the VMs from EC2 to on-premises
- **AWS Application Discovery Service**
    - Gather information about your on-premises servers to plan a migration
    - Ser ver utilization and dependency mappings
    - Track with AWS Migration Hub
- **AWS Database Migration Service (DMS)**
    - replicate On-premise => AWS , AWS => AWS, AWS => On-premise
    - Works with various database technologies (Oracle, MySQL, DynamoDB, etc..)
- **AWS Server Migration Service (SMS)**
    - Incremental replication of on-premises live servers to AWS

### AWS Backup

- **Fully managed service**
- **Centrally manage and automate backups across AWS services**
- **No need to create custom scripts and manual processes**
- Supported services:
    - Amazon EC2 / Amazon EBS
    - Amazon S3
    - Amazon RDS (all DBs engines) / Amazon Aurora / Amazon DynamoDB - Amazon DocumentDB / Amazon Neptune
    - Amazon EFS / Amazon FSx (Lustre & Windows File Server)
    - AWS Storage Gateway (Volume Gateway)
    - Supports cross-region backups - Supports cross-account backups
- Supports PITR(Point in time recovery) for supported services
- On-Demand and Scheduled backups
- **Tag-based backup policies**
- **You create backup policies known as Backup Plans**
    - Backup frequency (every 12 hours, daily, weekly, monthly, cron expression)
    - Backup window
    - Transition to Cold Storage (Never, Days,Weeks, Months,Years)
    - Retention Period (Always, Days,Weeks, Months,Years)

### AWS Backup Vault Lock

- **Enforce a WORM (Write Once Read Many) state for all the backups that you store in your AWS Backup Vault**
- Additional layer of defense to protect your backups against:
    - Inadvertent or malicious delete operations
    - Updates that shorten or alter retention periods
- **Even the root user cannot delete backups when enabled**

### AWS Application Discovery Service

- Plan migration projects by gathering information about on-premises data centers
- Server utilization data and dependency mapping are important for migrations
- **Agentless Discovery (AWS Agentless Discovery Connector)**
    - VM inventory, configuration, and performance history such as CPU, memory, and disk usage
- **Agent-based Discovery (AWS Application Discovery Agent)**
    - System configuration, system performance, running processes, and details of the network connections between systems
- Resulting data can be viewed within AWS Migration Hub

### AWS Application Migration Service (MGN)

- **The “AWS evolution” of CloudEndure Migration, replacing AWS Server Migration Service (SMS)**
- **Lift-and-shift (rehost) solution which simplify migrating applications to AWS**
- **Converts your physical, virtual, and cloud-based servers to run natively on AWS**
- Supports wide range of platforms, Operating Systems, and databases
- Minimal downtime, reduced costs
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20291.png)
    

### VMware Cloud on AWS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20292.png)

- **Some customers use VMware Cloud to manage their on-premises Data Center**
- They want to extend the Data Center capacity to AWS, but keep using the VMware Cloud software
- ...Enter VMware Cloud on AWS
- Use cases
    - Migrate your VMware vSphere-based workloads to AWS
    - Run your production workloads across VMware vSphere-based private, public, and hybrid cloud environments
    - Have a disaster recover strategy

### Transferring large amount of data into AWS

- Example: transfer 200 TB of data in the cloud. We have a 100 Mbps internet connection.
- **Over the internet / Site-to-Site VPN:**
    - Immediate to setup
    - Will take 200(TB)*1000(GB)*1000(MB)*8(Mb)/100 Mbps = 16,000,000s = 185d
- **Over direct connect 1Gbps:**
    - Long for the one-time setup (over a month)
    - Will take 200(TB)*1000(GB)*8(Gb)/1 Gbps = 1,600,000s = 18.5d
- **Over Snowball:**
    - Will take 2 to 3 snowballs in parallel
    - Takes about 1 week for the end-to-end transfer
    - Can be combined with DMS
- **For on-going replication / transfers: Site-to-SiteVPN or DX with DMS or DataSync**

## **Extra Solution Architecture discussions**

### Lambda, SNS & SQS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20293.png)

### Fan Out Pattern: deliver to multiple SQS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20294.png)

### S3 Event Notifications

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20295.png)

- S3:ObjectCreated, S3:ObjectRemoved, S3:ObjectRestore, S3:Replication...
- Object name filtering possible (*.jpg)
- Use case: generate thumbnails of images
uploaded to S3
- Can create as many “S3 events” as desired
- S3 event notifications typically deliver events in seconds but can sometimes take a minute or longer

### S3 Event Notifications with Amazon EventBridge

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20296.png)

- 왜 eventbridge를 연결하여 사용하는지?
    - **Advanced filtering options with JSON rules** (metadata, object size, name...)
    - **Multiple Destinations** – ex Step Functions, Kinesis Streams / Firehose...
    - **EventBridge Capabilities** – Archive, Replay Events, Reliable delivery

### Amazon EventBridge – Intercept API Calls

- Dynamo DB의 table를 (의도하던 의도하지 않던) 삭제할 경우 notification을 받을 수 있는 아키텍쳐

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20297.png)

### API Gateway – AWS Service Integration Kinesis Data Streams example

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20298.png)

### Caching Strategies

- **CloudFront를 사용해서 Dynamic and static 모두를 cache로 구현 가능**
- **S3 자체에는 캐싱 기능이 없으므로 cloudfront의 caching 기능을 사용한다.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20299.png)

### Blocking an IP address – with an ALB

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20300.png)

### Blocking an IP address – ALB + WAF

- **ALB에 WAF를 달아서 사용한다.**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20301.png)

### Blocking an IP address – with an NLB

- **NLB에는 Security Group이 없음을 유의하자**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20302.png)

### Blocking an IP address – ALB, CloudFront WAF

- Cloudfront를 사용하면 Cloudfront가 Proxy 역할을 수행하므로 Cloudfront에서 걸러지지 않은 트래픽들은 모두 바로 Instance로 들어가게 된다.
- 가능한 이유는 traffic이 cloudfront public IPs로 옮겨서 내부로 들어가기 때문임.
- 따라서 Cloudfront에서 Geo Restriction이나 WAF를 써야한다.

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20303.png)

### High Performance Computing (HPC)

- The cloud is the perfect place to perform HPC
- You can create a very high number of resources in no time
- You can speed up time to results by adding more resources
- You can pay only for the systems you have used
- Perform genomics, computational chemistry, financial risk modeling, weather prediction, machine learning, deep learning, autonomous driving
- Which services help perform HPC?

### Data Management & Transfer

- **AWS Direct Connect:**
    - Move GB/s of data to the cloud, over a private secure network
- **Snowball & Snowmobile**
    - Move PB of data to the cloud
- **AWS DataSync**
    - Move large amount of data between on-premises and **S3, EFS, FSx for Windows(EBS는 해당사항 없음)**

### Compute and Networking

- EC2 Instances:
    - CPU optimized, GPU optimized
    - Spot Instances / Spot Fleets for cost savings + Auto Scaling
- **EC2 Placement Groups:** Cluster for good network performance
    - **Low Latency & 10Gps network**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20304.png)
    

### Compute and Networking

- EC2 Enhanced Networking (SR-IOV)
    - Higher bandwidth, higher PPS (packet per second), lower latency
    - **Option 1: Elastic Network Adapter (ENA) up to 100 Gbps**
    - **Option 2: Intel 82599 VF up to 10 Gbps – LEGACY**
- Elastic Fabric Adapter (EFA)
    - **Improved ENA for HPC, only works for Linux**
    - Great for inter-node communications, tightly coupled workloads
    - Leverages Message Passing Interface (MPI) standard
    - By passes the underlying Linux OS to provide low-latency, reliable transport

### Storage

- Instance-attached storage:
    - **EBS:** scale up to 256,000 IOPS with io2 Block Express
    - **Instance Store:** scale to millions of IOPS, linked to EC2 instance, low latency
- Network storage:
    - **Amazon S3:** large blob, not a file system
    - **Amazon EFS:** scale IOPS based on total size, or use provisioned IOPS
    - **Amazon FSx for Lustre:**
        - HPC optimized distributed file system, millions of IOPS
        - Backed by S3

### Automation and Orchestration

- AWS Batch
    - **AWS Batch supports multi-node parallel jobs,** which enables you to run single jobs that span multiple EC2 instances.
    - Easily schedule jobs and launch EC2 instances accordingly
- AWS ParallelCluster
    - **Open-source cluster management tool to deploy HPC on AWS**
    - Configure with text files
    - Automate creation of VPC, Subnet, cluster type and instance types
    - Ability to enable EFA on the cluster (improves network performance)

### Creating a highly available EC2 instance

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20305.png)

### Creating a highly available EC2 instance With an Auto Scaling Group

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20306.png)

### Creating a highly available EC2 instance With ASG + EBS

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20307.png)

## Other Services

### What is CloudFormation

- **Infrastructure as code**
- CloudFormation is a declarative way of outlining your AWS Infrastructure, for any resources (most of them are supported).
- For example, within a CloudFormation template, you say:
    - I want a security group
    - I want two EC2 instances using this security group
    - I want an S3 bucket
    - I want a load balancer (ELB) in front of these machines
- Then CloudFormation creates those for you, in the right order, with the exact configuration that you specify

### Benefits of AWS CloudFormation (1/2)

- **Infrastructure as code**
    - No resources are manually created, which is excellent for control
    - Changes to the infrastructure are reviewed through code
- **Cost**
    - Each resources within the stack is tagged with an identifier so you can easily see how much a stack costs you
    - You can estimate the costs of your resources using the CloudFormation template
    - Savings strategy: In Dev, you could automation deletion of templates at 5 PM and recreated at 8 AM, safely
- **Productivity**
    - Ability to destroy and re-create an infrastructure on the cloud on the fly
    - Automated generation of Diagram for your templates!
    - Declarative programming (no need to figure out ordering and orchestration)
- **Don’t re-invent the wheel**
    - **Leverage existing templates on the web!**
    - Leverage the documentation
- Supports (almost) all AWS resources:
    - Everything we’ll see in this course is supported
    - You can use “custom resources” for resources that are not suppor ted

### Amazon Simple Email Service (Amazon SES)

- **Fully managed service to send emails securely, globally and at scale**
- Allows inbound/outbound emails
- Reputation dashboard, performance insights, anti-spam feedback
- Provides statistics such as email deliveries, bounces, feedback loop results, email open
- Supports DomainKeys Identified Mail (DKIM) and Sender Policy Framework (SPF)
- Flexible IP deployment: shared, dedicated, and customer-owned IPs
- Send emails using your application using AWS Console, APIs, or SMTP
- Use cases: transactional, marketing and bulk email communications

### Amazon Pinpoint

- **Scalable 2-way (outbound/inbound) marketing communications service**
- **Supports email, SMS, push, voice, and in-app messaging**
- Ability to segment and personalize messages with the right content to customers
- Possibility to receive replies
- Scales to billions of messages per day
- Use cases: run campaigns by sending marketing, bulk, transactional SMS messages
- Versus Amazon SNS or Amazon SES
    - In SNS & SES you managed each message's audience,
    - In Amazon Pinpoint,you create message templates, delivery schedules, highly-targeted segments, and full campaigns

### Systems Manager – SSM Session Manager

- **Allows you to start a secure shell on your EC2 and on-premises servers**
- **No SSH access, bastion hosts, or SSH keys needed**
- **No port 22 needed (better security)**
- Suppor ts Linux, macOS, and Windows
- Send session log data to S3 or CloudWatch Logs

### Systems Manager – Run Command

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20308.png)

- **Execute a document (= script) or just run a command**
- Run command across multiple instances (using resource groups)
- No need for SSH
- Command Output can be shown in the AWS Console, sent to S3 bucket or CloudWatch Logs
- Send notifications to SNS about command status (In progress, Success, Failed, ...)
- Integrated with IAM & CloudTrail
- Can be invoked using EventBridge

### Systems Manager – Patch Manager

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20309.png)

- **Automates the process of patching managed instances**
- OS updates, applications updates, security updates
- Supports EC2 instances and on-premises servers
- Suppor ts Linux, macOS, and Windows
- Patch on-demand or on a schedule using
Maintenance Windows
- Scan instances and generate patch compliance report (missing patches)

### Systems Manager – Maintenance Windows

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20310.png)

- **Defines a schedule for when to perform actions on your instances**
- Example: OS patching, updating drivers, installing software, ...
- Maintenance Window contains - Schedule
- Duration
- Set of registered instances - Set of registered tasks

### Systems Manager - Automation

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20311.png)

- Simplifies common maintenance and deployment tasks of EC2 instances and other AWS resources
- Examples: restart instances, create an AMI, EBS snapshot
- Automation Runbook – SSM Documents to define actions preformed on your EC2 instances or AWS resources (pre-defined or custom)
- Can be triggered using:
    - Manually using AWS Console, AWS CLI or SDK
    - Amazon EventBridge
    - On a schedule using Maintenance Windows
    - By AWS Config for rules remediations

### Cost Explorer

- **Visualize, understand, and manage your AWS costs and usage over time**
- Create custom reports that analyze cost and usage data.
- Analyze your data at a high level: total costs and usage across all accounts - Or Monthly, hourly, resource level granularity
- Choose an optimal Savings Plan (to lower prices on your bill)
- **Forecast usage up to 12 months based on previous usage**

### Amazon Elastic Transcoder

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%20312.png)

- **ElasticTranscoder is used to convert media files stored in S3 into media files in the formats required by consumer playback devices (phones etc..)**
- Benefits:
    - Easy to use
    - Highly scalable – can handle large volumes of media files and large file sizes - Cost effective – duration-based pricing model
    - Fully managed & secure, pay for what you use

### AWS Batch

- **Fully managed batch processing at any scale**
- Efficiently run 100,000s of computing batch jobs on AWS
- A “batch” job is a job with a star t and an end (opposed to continuous)
- Batch will dynamically launch EC2 instances or Spot Instances
- **Batch jobs are defined as Docker images and run on ECS**

### Amazon AppFlow

- **Fully managed integration service that enables you to securely transfer data between Software-as-a-Service (SaaS) applications and AWS**
- Sources: Salesforce, SAP, Zendesk, Slack, and ServiceNow
- Destinations: AWS services like Amazon S3,Amazon Redshift or non- AWS such as SnowFlake and Salesforce
- Frequency: on a schedule, in response to events, or on demand
- Data transformation capabilities like filtering and validation
- Encrypted over the public internet or privately over AWS PrivateLink
- Don’t spend time writing the integrations and leverage APIs immediately

### **AWS Well-Architected Tool**

- Free tool to review your architectures against the 6 pillars Well-Architected Framework and adopt architectural best practices
- 체크리스트를 통해 문제를 발견하는 방식

### Trusted Adivisor

- Analyze your AWS accounts and provides recommendation on 5 categories
    - Cost optimization
    - Performance
    - Security
    - Fault tolerance
    - Service limits

## 번외

## Fully Managed Service VS Serverless

Chat-GPT : In summary, the main difference between Fully Managed Service and Serverless is the level of responsibility assigned to the user. 

- Fully Managed Service allows the user to deploy and manage their application, while the cloud service provider manages the underlying infrastructure.
- In a serverless model, the cloud service provider automatically provisions and scales the necessary infrastructure to run the user's code, and charges only for the actual usage of resources.

****Getting the best of both worlds: Serverless and fully managed****

Severless

**“I code my application or service and I don't care where it run..just make sure my user is able to get to it when they try.”**

Fully Managed Service
**“I care how and where my service runs because I have a specific type of service that needs more control over the underlying resources and… my application/team benefits from the extra controls.”**

[https://cloud.google.com/blog/topics/developers-practitioners/serverless-vs-fully-managed-whats-difference](https://cloud.google.com/blog/topics/developers-practitioners/serverless-vs-fully-managed-whats-difference)
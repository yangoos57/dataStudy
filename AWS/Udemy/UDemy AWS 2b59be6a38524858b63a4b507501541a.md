# UDemy AWS

## Global Services, Region

### Global Service

- IAM, Route 53, CloudFront, WAF 등
- Region을 선택할 필요가 없음.
- AWS Global infrastructure

### Region-scoped

- EC2, Elastic Beanstalk, Lambda …. 등

### Region

하나의 독립적인 서비스. Data Center의 집합이다. ~~서비스는 리전 크기를 벗어나지 못한다.(리전이 가장 큰 단위이며 그 이상을 초과하는 서비스는 존재하지 않는다.)~~  Global Service는 region을 넘는 서비스이다.

### Region 선택 기준

- compliance : 해당 국가의 법률 준수 여부
- proximity : low latency
- Available Services : 리전마다 제공 가능한 서비스가 다름
- Pricing : 리전마다 가격이 다름

### Availability Zones

- Region에 2 ~ 6 개의  AZ가 존재하며(보통 3개) AZ에는 2 ~ 4개의 Data Center가 존재한다.
- 물리적으로 분리되어 있기 때문에 재난 대비가 가능하다.

### Edge Locations

## IAM

### IAM 이란

- Identity and access management, **Global Service**
- Group으로 권한을 설정할 수 있다. Group 내부에는 사용자만 포함 가능하다.(Group 내부에 Group을 넣는 건 불가능하다.)
- 특정 사용자가 여러 그룹에 속할 수 있다.
- Json으로 권한을 부여한다.
- Least priviledge Principle : 제한된 권한을 제한된 사용자에게 준다.

### IAM Policy(정책)

- inline policy : user에 직접 적용하는 policy
- 직접 만들거나 기존에 있는 정책을 사용할 수 있음

### IAM Multi Factor Authentification(MFA)

- Password + Device = MFA
- virtual MFA Device : google authentificator
- Physical Device : u2f

## EC2

- Bootstrap : launching commands when a machine starts.(Docker의 cmd 맞나. 그거와 같은 기능인듯)
- EC2 Create의 Advanced Details ⇒ User data =  Boot strap이다.

### EC2 종류

- T, M : General Purpose ⇒ 범용 목적
- C : Compute Optimized ⇒ required High performance Cpu
- R,X,M : Memory Optimized
- I, D : Stroage Optimized

### Security Groups = Firewall on EC2

- 기본세팅으로 ec2로 들어오는 모든 Inbound는 통제하고outbound는 통제하지 않는다.
- EC2 외부에 존재하는 것 인만큼 알맞는 방식으로 Security Group 설정을 해야 EC2에 접근할 수 있다.
- EC2로 접속할 때 컴퓨터가 계속해서 대기하는 모습(Timeout 상황)이라면 Security Group 문제 때문이다.
- 허용 단위를 security Group으로도 설정할 수 있다. ex) A라는 EC2의 Security Group에 S1이라는 Security Group을 Inbound Traffic에 허용한다면, S1 Security Group을 사용하는 EC2들 모두는 A와 통신이 가능하게 된다.
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled.png)
    

### Classic Ports

- 22 = SSH(Secure Shell) - log into a linux instance
- 21 = FTP(File Transfer Protocol)
- 22 = SFTP(Secure File Transfer Protocol) - upload files using SSH
- 80 = HTTP
- 443 = HTTPS
- 3389 = RDP(Remote Desktop Protocol) - log into a window instance

### EC2 Purchasing Options

- On-Demand Instances – short workload, predictable pricing, pay by second
- Reserved (1 & 3 years)
• Reserved Instances – long workloads
• Convertible Reserved Instances – long workloads with flexible instances
- Savings Plans (1 & 3 years) –commitment to an amount of usage, long workload • Spot Instances – short workloads, cheap, can lose instances (less reliable)
• Dedicated Hosts – book an entire physical server, control instance placement
• Dedicated Instances – no other customers will share your hardware
- Capacity Reservations – reserve capacity in a specific AZ for any duration
- **EC2 On Demand**
• Pay for what you use:
• Linux or Windows - billing per second, after the first minute • All other operating systems - billing per hour
• Has the highest cost but no upfront payment
• No long-term commitment
• Recommended for short-term and un-interrupted workloads, where you can't predict how the application will behave
- **EC2 Reserved Instances**
• Up to 72% discount compared to On-demand
• You reserve a specific instance attributes (Instance Type, Region,Tenancy, OS)
    
    • Reservation Period – 1 year (+discount) or 3 years (+++discount)
    • Payment Options – No Upfront (+), Partial Upfront (++), All Upfront (+++) 
    
    • Reserved Instance’s Scope – Regional or Zonal (reserve capacity in an AZ)
    • Recommended for steady-state usage applications (think database)
    • You can buy and sell in the Reserved Instance Marketplace
    • Convertible Reserved Instance
    • Can change the EC2 instance type, instance family, OS, scope and tenancy • Up to 66% discount
    
- **EC2 Savings Plans**
• Get a discount based on long-term usage (up to 72% - same as RIs)
    
    • Commit to a certain type of usage ($10/hour for 1 or 3 years)
    • Usage beyond EC2 Savings Plans is billed at the On-Demand price
    • Locked to a specific instance family & AWS region (e.g., M5 in us-east-1)
    • Flexible across:
    
    • Instance Size (e.g., m5.xlarge, m5.2xlarge) • OS (e.g., Linux, Windows)
    • Tenancy (Host, Dedicated, Default)
    
- **EC2 Spot Instances**
• Can get a discount of up to 90% compared to On-demand
• Instances that you can “lose” at any point of time if your max price is less than the current spot price
• The MOST cost-efficient instances in AWS
• Useful for workloads that are resilient to failure
    
    • Batch jobs
    • Data analysis
    • Image processing
    • Any distributed workloads
    • Workloads with a flexible start and end time
    • Not suitable for critical jobs or databases
    

- **EC2 Dedicated Hosts**
• A physical server with EC2 instance capacity fully dedicated to your use
• Allows you address compliance requirements and use your existing server- bound software licenses (per-socket, per-core, pe—VM software licenses)
• Purchasing Options:
    
    • On-demand – pay per second for active Dedicated Host
    • Reserved - 1 or 3 years (No Upfront,Partial Upfront,All Upfront)
    
    • The most expensive option
    • Useful for software that have complicated licensing model (BYOL – Bring Your
    Own License)
    • Or for companies that have strong regulatory or compliance needs
    
- **EC2 Capacity Reservations**
• Reserve On-Demand instances capacity in a specific AZ for any duration
• You always have access to EC2 capacity when you need it
• No time commitment (create/cancel anytime), no billing discounts
• Combine with Regional Reserved Instances and Savings Plans to benefit from billing discounts
• You’re charged at On-Demand rate whether you run instances or not
• Suitable for short-term, uninterrupted workloads that needs to be in a
specific AZ

### Spot Request

- Spot instance 사용하는 옵션, request type을 설정 잘해야함. one-time은 한 번만  persistent는 자동으로  instance를 관리하는 기능임(kubernetes에도 있는 기능인데 이름이 기억나진 않음)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%201.png)

### Spot Fleets

- Spot Request를 통해 만들 수 있다.

## EC2-Network

### Public IP & Private IP

- Public IP : 인터넷에서 접근 가능
- Private IP : 사설 네트워크에서만 적용
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%202.png)
    

### Placement Groups

- EC2를 배치하는 전략
- Cluster—clusters instances into a low-latency group in a single Availability Zone
    - Pros: Great network (10 Gbps bandwidth between instances with Enhanced Networking enabled - recommended)
    • Cons: If the rack fails, all instances fails at the same time
    • Use case:
    • Big Data job that needs to complete fast
    • Application that needs extremely low latency and high network throughput
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%203.png)
    
- Spread—spreads instances across underlying hardware (max 7 instances per group per AZ)
    
    Pros:
    • Can span across Availability
    • Reduced risk is simultaneous failure
    • EC2 Instances are on different physical hardware
    Zones (AZ)
    • Cons:
    • Limited to 7 instances per AZ
    per placement group • Use case:
    • Application that needs to maximize high availability
    • Critical Applications where each instance must be isolated from failure from each other
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%204.png)
    
- Partition—spreads instances across many different partitions (which rely on different sets of racks) within an AZ. Scales to 100s of EC2 instances per group (Hadoop, Cassandra, Kafka)
    - Up to 7 partitions per AZ
    - Can span across multiple AZs in the
    - Up to 100s of EC2 instances
    - The instances in a partition do not share racks with the instances in the other partitions
    - A partition failure can affect many EC2 but won’t affect other partitions
    - EC2 instances get access to the partition information as metadata
    - Use cases: HDFS, HBase, Cassandra, Kafka
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%205.png)
    

### Elastic Network Interfaces(ENI)

- virtual network card
- ENI를 사용해서 네트워크 장애를 쉽게 해결 할 수 있다는데, 이해가 되진 않음.
- ENI에 대한 참고자료(나중에 필요하면 읽자.)
    - [https://aws.amazon.com/ko/blogs/aws/new-elastic-network-interfaces-in-the-virtual-private-cloud/](https://aws.amazon.com/ko/blogs/aws/new-elastic-network-interfaces-in-the-virtual-private-cloud/)

### Instance Stop과 Terminate 차이

- Stop – the data on disk (EBS) is kept intact in the next start
- Terminate – any EBS volumes (root) also set-up to be destroyed is lost

### EC2 Hibernate

- Hibernate = 동면(=겨울잠), 절전
- The in-memory (RAM) state is preserved
- The instance boot is much faster! (the OS is not stopped / restarted)
- Under the hood: the RAM state is written to a file in the root EBS volume
- The root EBS volume must be encrypted
- Use cases:
    - Long-running processing
    - Saving the RAM state
    - Services that take time to initialize
- 원리
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%206.png)
    

EC2 Hibernate – Good to know
• Supported Instance Families – C3, C4, C5, I3, M3, M4, R3, R4,T2,T3, ...
• Instance RAM Size – must be less than 150 GB.
• Instance Size – not supported for bare metal instances.
• AMI – Amazon Linux 2, Linux AMI, Ubuntu, RHEL, CentOS & Windows... • Root Volume – must be EBS, encrypted, not instance store, and large
• Available for On-Demand, Reserved and Spot Instances • An instance can NOT be hibernated more than 60 days

## Elastic Block Store(EBS)

- EC2에서 사용하는 Storage이자 network로 연결
- 같은 AZ에 있는 EC2만 연결 가능함. 다른 AZ에 있는 EC2에 사용하려면 Snapshot을 만들어서 사용해야한다.
- 하나의 EC2에 EBS 여러 개를 사용할 수 있음.

### EBS Snapshots

- 기본 기능

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%207.png)

- 추가 기능
    - EBS Snapshot Archive
    - Recycle Bin for EBS Snapshots
        - Snapshot을 바로 지우지 않고 Recycle Bin에서 삭제되도록 안전 장치를 만드는 서비스
    - Fast Sanpshot Restore(FSR)
- Snapshot을 만든 다음 Create from Snapshot 기능을 사용해 다른 AZ에서 만들 수 있음.

### AMAZON Machine Image(AMI)

- 도커 이미지와 같은 기능인듯

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%208.png)

### EC2 Instance Store

- EC2와 물리적으로 연결된 스토리지
- 고성능 하드웨어 디스크가 필요할 경우 사용한다.

### EBS Volumes come in 6 types

- gp2 / gp3 (SSD): General purpose SSD volume that balances price and performance for a wide variety of workloads
- io1 / io2 (SSD): Highest-performance SSD volume for mission-critical low-latency or high-throughput workloads
- st1 (HDD): Low cost HDD volume designed for frequently accessed, throughput- intensive workloads
- sc1 (HDD): Lowest cost HDD volume designed for less frequently accessed workloads
- EBS Volumes are characterized in Size | Throughput | IOPS (I/O Ops Per Sec) • When in doubt always consult the AWS documentation – it’s good!
- **Only gp2/gp3 and io1/io2 can be used as boot volumes**

### General Purpose SSD

- Cost effective storage, low-latency
- System boot volumes,Virtual desktops, Development and test environments • 1 GiB - 16TiB
- gp3: IOPS를 수동으로 설정 가능
    - Baseline of 3,000 IOPS and throughput of 125 MiB/s
    - Can increase IOPS up to 16,000 and throughput up to 1000 MiB/s independently
- gp2: IOPS와 용량이 연결되어 있음
    - Small gp2 volumes can burst IOPS to 3,000
    - Size of the volume and IOPS are linked, max IOPS is 16,000
    - 3 IOPS per GB, means at 5,334 GB we are at the max IOPS

### Provisioned IOPS (PIOPS) SSD

- IOPS 16000 이상이 필요할 경우
- Critical business applications with sustained IOPS performance Or applications that need more than 16,000 IOPS
- Great for databases workloads (sensitive to storage perf and consistency)
- io1/io2 (4 GiB - 16 TiB):
    - Max PIOPS: 64,000 for Nitro EC2 instances & 32,000 for other
    - Can increase PIOPS independently from storage size
    - io2 have more durability and more IOPS per GiB (at the same price as io1)
    - io2 Block Express (4 GiB – 64 TiB):
        - Sub-millisecond latency
        - Max PIOPS: 256,000 with an IOPS:GiB ratio of 1,000:1
    - **Supports EBS Multi-attach**

### EBS Multi-Attach – io1/io2 family

- **io1/io2 only support EBS Multi-Attach**
- Attach the same EBS volume to multiple EC2 instances in the same AZ
- Each instance has full read & write permissions to the high-performance volume
- Use case:
• Achieve higher application availability in clustered
Linux applications (ex:Teradata)
• Applications must manage concurrent write operations
- **Up to 16 EC2 Instances at a time**
- **Must use a file system that’s cluster-aware** (not
XFS, EXT4, etc...)

### Hard Disk Drives (HDD)

- Cannot be a boot volume
- 125 GiB to 16TiB
- Throughput Optimized HDD (st1)
- Big Data, Data Warehouses, Log Processing • Max throughput 500 MiB/s – max IOPS 500
- Cold HDD (sc1):
• For data that is infrequently accessed
• Scenarios where lowest cost is important
• Max throughput 250 MiB/s – max IOPS 250

### EBS Encryption

- encrypted volume 만들기
    - 방법 1 : EBS를 처음 만들때 encryption 기능을 사용한다.
    - 방법 2 : unencrpyted EBS의 snapshot을 활용해 volume을 새로 생성하는 과정에서 encryption을 활성화해서 만든다.
- encrypted volume snapshot 만들기
    - encrpted volume을 새로 만들어서 스냅샷을 만드는 것 외에는 없다.

### Elastic File System(EFS) = NFS (network file system

- 기본 개념
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%209.png)
    
- **EFS works with EC2 instances in multi-AZ**
- Highly available, scalable, expensive (3x gp2), pay per use
- Use cases: content management, web serving, data sharing,Wordpress
- Uses NFSv4.1 protocol
- Uses security group to control access to EFS
- **Compatible with Linux based AMI (not Windows)**
- Encryption at rest using KMS
- POSIX file system (~Linux) that has a standard file API
- **File system scales automatically, pay-per-use, no capacity planning!**

### EFS 모드

- **EFS Scale**
    - 1000s of concurrent NFS clients, 10 GB+ /s throughput
    - Grow to Petabyte-scale network file system, automatically
- **Performance Mode (set at EFS creation time)**
    - General Purpose (default) – latency-sensitive use cases (web server, CMS, etc...)
    - Max I/O – higher latency, throughput, highly parallel (big data, media processing)
- **Throughput Mode**
    - Bursting – 1TB = 50MiB/s + burst of up to 100MiB/s
    - Provisioned – set your throughput regardless of storage size, ex: 1 GiB/s for 1 TB storage
    - Elastic – automatically scales throughput up or down based on your workloads
    • Up to 3GiB/sforreadsand1GiB/sforwrites
        
        • Usedforunpredictableworkloads
        

### EFS - Storage Tiers

- Standard: for frequently accessed files
- Infrequent access (EFS-IA): cost to retrieve files, lower price to store. Enable EFS-IA with a Lifecycle Policy

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2010.png)

### Storage Class

- Standard: Multi-AZ, great for production
- One Zone: One AZ, great for dev, backup enabled by default, compatible with IA (EFS One Zone-IA)
    - **Over 90% in cost savings**

### EBS vs EFS – Elastic Block Storage

**EBS**

- one instance (except multi-attach io1/io2)
- are locked at the Availability Zone (AZ) level
- gp2: IO increases if the disk size increases
- io1: can increase IO independently

**To migrate an EBS volume across AZ** 

- Take a snapshot
- Restore the snapshot to another AZ
- EBS backups use IO and you shouldn’t run them while your application is handling a lot of traffic
- **Root EBS Volumes of instances get terminated by default if the EC2 instance gets terminated. (you can disable that)**

**EFS**

- **Mounting 100s of instances across AZ**
- EFS share website files (WordPress)
- **Only for Linux Instances (POSIX)**
- EFS has a higher price point than EBS
- Can leverage EFS-IA for cost savings
- Remember : EFS vs EBS vs Instance Store

## Scalability & Availability

**Vertical Scalability**

- Vertical scalability is very common for non
distributed systems, such as a database.
- RDS, ElastiCache are services that can scale
ver tically.
- There’s usually a limit to how much you can
vertically scale (hardware limit)

**Horizontal Scalability** 

- Horizontal scaling implies distributed systems.
- AWS에서는 Scale out / in이라는 용어를 사용함.

**High Availability**

- High availability means running your
application / system in at least 2 data
centers (== Availability Zones)
- The goal of high availability is to survive a data center loss
- The high availability can be passive (for RDS Multi AZ for example)

## Load Balancing

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2011.png)

### Why use a load balancer?

- Spread load across multiple downstream instances
- Expose a single point of access (DNS) to your application
- Seamlessly handle failures of downstream instances
- Do regular health checks to your instancesHealth Checks
• Health Checks are crucial for Load Balancers
• They enable the load balancer to know if instances it forwards traffic to are available to reply to requests
• The health check is done on a port and a route (/health is common)
• If the response is not 200 (OK), then the instance is unhealthy
- Provide SSL termination (HTTPS) for your websites
- Enforce stickiness with cookies
- High availability across zones
- Separate public traffic from private traffic

### Types of load balancer on AWS

- Application Load Balancer (v2 - new generation) – 2016
    - ALB HTTP, HTTPS,WebSocket
- Network Load Balancer (v2 - new generation) – 2017 – NLB
    - TCP,TLS(secureTCP),UDP
- Gateway Load Balancer – 2020 – GWLB
    - Operates at layer 3 (Network layer) – IP Protocol

### Load Balancer Security Groups

- EC2의 Security Group의 Source를 Load Balancer의 Security Group으로 설정해서, Traffic이 Load Balancer를 통해서 들어오게 할 수 있음.

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2012.png)

### Application Load Balacner - HTTP Based Traffic

- Layer 7(HTTP,HTTPS)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2013.png)

### APP Load Balancer의 Target Group 종류

• EC2 instances (can be managed by an Auto Scaling Group) – HTTP 
• ECS tasks (managed by ECS itself) – HTTP
• Lambda functions – HTTP request is translated into a JSON event 
• IP Addresses – must be private IPs

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2014.png)

### Network Load Balancer - TCP & UDP Based

- Network load balancers (Layer 4) allow to:
    - Forward TCP & UDP traffic to your instances
    - Handle millions of request per seconds
    - Less latency ~100 ms (vs 400 ms for ALB)
- **NLB has one static IP per AZ**, and supports assigning Elastic IP (helpful for whitelisting specific IP)
- NLB are used for extreme performance,TCP or UDP traffic
- Not included in the AWS free tier

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2015.png)

### Network Load Balancer - Target Groups

- EC2 instances
- IP Addresses – must be private IPs
- Application Load Balancer
- Health Checks support the TCP, HTTP and HTTPS Protocols

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2016.png)

### Gateway Load Balancer - Layer 3

- IP Packet 검사용으로 사용
- Example: Firewalls, Intrusion Detection and Prevention Systems, Deep Packet Inspection Systems, payload manipulation, …
- Operates at Layer 3 (Network Layer) – IP Packets
- Combines the following functions:
    - Transparent Network Gateway – single entry/exit
    - Load Balancer – distributes traffic to your virtual appliances
- **Uses the GENEVE protocol on port 6081**

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2017.png)

### Gateway Load Balancer –Target Groups

- EC2 instances
- IP Addresses – must be private IPs

### Sticky Sessions

- Load Balancer를 사용할 때 client와 특정 instance를 계속 연결시키는 기능
- Application-based Cookies
- Duration-based Cookies

### Cross-Zone Load Balancing

- 기본개념

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2018.png)

- Application Load Balancer
• Enabled by default (can be disabled at the Target Group level)
    
    • No charges for inter AZ data
    
- Network Load Balancer & Gateway Load Balancer
    
    • Disabled by default
    • You pay charges ($) for inter AZ data if enabled
    

### Server Name Indication(SNI)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2019.png)

- **SNI solves the problem of loading multiple SSL certificates onto one web server (to serve multiple websites)**
- It’s a “newer” protocol, and requires the client to indicate the hostname of the target server in the initial SSL handshake
- The server will then find the correct certificate, or return the default one
- Application Load Balancer (v2)
• Supports multiple listeners with multiple SSL certificates
    
    • Uses Server Name Indication (SNI) to make it work
    
- Network Load Balancer (v2)
• Supports multiple listeners with multiple SSL certificates
• Uses Server Name Indication (SNI) to make it work

### Connection Draining

- Instance 연결을 종료하고자 할 때 중단 기간을 둬서 안정적으로 종료할 수 있게 만드는 기능

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2020.png)

### 문제

Question 5:

**Application Load Balancer를 사용해 EC2 인스턴스에서 호스팅된 웹사이트의 트래픽을 분배하고 있습니다. 그런데 여러분의 웹사이트가 Application Load Balancer의 IP 주소인 사설 IPv4 주소에서 들어오는 트래픽만을 확인하고 있는 것으로 나타났습니다. 이런 경우, 웹사이트로 연결된 클라이언트들의 IP 주소를 받으려면 어떻게 해야 할까요?**

Application Load Balancer를 사용하여 EC2 인스턴스에 트래픽을 배분하는 경우, 요청을 받게 되는 IP 주소는 ALB의 사설 IP 주소가 됩니다. 클라이언트의 IP 주소를 받기 위해, ALB는 클라이언트의 IP 주소를 포함하고 있는 X-Forwarded-For라는 헤더를 추가합니다.

Question 9:

**Application Load Balancer는 트래픽을 다른 대상 그룹으로 라우팅할 수 있습니다. 이때 확인할 내용으로 사용할 수 없는 것을 고르세요.**

답 : ALB는 URL 경로, 호스트 이름, HTTP 헤더 및 쿼리 문자열을 기반으로 트래픽을 다른 대상 그룹으로 라우팅할 수 있습니다.

Question 11:

**규정 준수를 위해, 고정된 정적 IP 주소를 최종 사용자에게 노출하여 사용자들이 안정적이고, 규제 기관의 승인을 받은 방화벽 규칙을 작성할 수 있도록 하려 합니다. 이런 경우, 다음 중 어떤 종류의 Elastic Load Balancer를 사용해야 할까요?**

Network Load Balancer는 AZ 당 하나의 정적 IP 주소를 가지며, 여기에 탄력적 IP 주소를 연결할 수 있습니다. Application Load Balancer와 Classic Load Balancer를 정적 DNS 이름으로 사용할 수 있습니다.

## Auto Scaling Group

- ASG are free (you only pay for the underlying EC2 instances)
- ASG Launch Template
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2021.png)
    

### Auto Scaling - CloudWatch Alarms & Scaling

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2022.png)

- Auto Scaling과 CloudWatch가 다이렉트로 연결 되어있음.
- It is possible to scale an ASG based on CloudWatch alarms
- An alarm monitors a metric (such as Average CPU, or a custom metric)
- Metrics such as Average CPU are computed for the overall ASG instances
- Based on the alarm:
• We can create scale-out policies (increase the number of instances)
• We can create scale-in policies (decrease the number of instances)

### Dynamic Scaling Policy

- **Target Tracking Scaling**
• Most simple and easy to set-up
• Example: I want the average ASG CPU to stay at around 40%
- **Simple / Step Scaling**
• When a CloudWatch alarm is triggered (example CPU > 70%), then add 2 units • When a CloudWatch alarm is triggered (example CPU < 30%), then remove 1
- **Scheduled Actions**
• Anticipate a scaling based on known usage patterns
• Example: increase the min capacity to 10 at 5 pm on Fridays

### Predictive Scaling

- Predictive scaling: continuously forecast load and schedule scaling ahead
    - Using Machine Learning

### Good Metrics to scale on

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2023.png)

- **CPUUtilization:** Average CPU utilization across your instances
- **RequestCountPerTarget:** to make sure the number of requests per EC2 instances is stable
- **Average Network In / Out** (if you’re application is network bound)
- Any custom metric (that you push using CloudWatch)

### Scaling Cooldowns

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2024.png)

- After a scaling activity happens, you are in the cooldown period (default 300 seconds)
- During the cooldown period, the ASG will not launch or terminate additional instances (to allow for metrics to stabilize)
- Advice: Use a ready-to-use AMI to reduce configuration time in order to be serving request fasters and reduce the cooldown period

## **Relational Database Service(**RDS)

### Advantage over using RDS versus deploying DB on EC2

- **RDS: Automates setup, operation, and scaling of database in AWS**
- RDS is a managed service:
    - Automated provisioning, OS patching
    - Continuous backups and restore to specific timestamp (Point in Time Restore)!
    - Monitoring dashboards
    - Read replicas for improved read performance
    - **Multi AZ setup for DR (Disaster Recovery)**
    - Maintenance windows for upgrades
    - Scaling capability (vertical and horizontal)
    - Storage backed by EBS (gp2 or io1)
    - **BUT you can’t SSH into your instances**

### RDS – Storage Auto Scaling

- Helps you increase storage on your RDS DB instance dynamically
- **When RDS detects you are running out of free database storage, it scales automatically**
- Avoid manually scaling your database storage
- You have to set Maximum Storage Threshold (maximum limit
- Automatically modify storage if:
    - Free storage is less than 10% of allocated storage
    - Low-storage lasts at least 5 minutes
    - 6 hours have passed since last modification
    for DB storage)
    - Useful for applications with unpredictable workloads
    - Supports all RDS database engines (MariaDB, MySQL,PostgreSQL, SQL Server, Oracle)

### RDS Read Replicas for read scalability

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2025.png)

- **Up to 5 Read Replicas**
- **Within AZ, Cross AZ or Cross Region**
- **Replication is ASYNC, so reads are eventually consistent**
- Replicas can be promoted to their own DB
- Cross Region
- Applications must update the connection

### RDS Read Replicas – Network Cost

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2026.png)

- In AWS there’s a network cost when data goes from one AZ to another
- **For RDS Read Replicas within the same region, you don’t pay that fee**

### RDS Multi AZ (Disaster Recovery)

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2027.png)

- **SYNC replication**
- One DNS name – automatic app
- **failover to standby**
- **Increase availability**
- Failover in case of loss of AZ, loss of network, instance or storage failure
- No manual intervention in apps
- Not used for scaling
- **Note:The Read Replicas be setup as Multi AZ for Disaster Recovery (DR)**

### RDS – From Single-AZ to Multi-AZ

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2028.png)

- **Zero downtime operation (no need to stop the DB)**
- Just click on “modify” for the database
- The following happens internally:
    - A snapshot is taken
    - A new DB is restored from the snapshot in a new AZ
    - Synchronization is established between the two databases

### **RDS Custom**

- **Managed Oracle and Microsoft SQL Server Database with OS and
database customization**

****

## Aurora

- Aurora is a proprietary technology from AWS (not open sourced)
- Postgres and MySQL are both supported as Aurora DB (that means your drivers will work as if Aurora was a Postgres or MySQL database)
- **Aurora is “AWS cloud optimized” and claims 5x performance improvement over MySQL on RDS, over 3x the performance of Postgres on RDS**
- **Aurora storage automatically grows in increments of 10GB, up to 128 TB.**
- **Aurora can have up to 15 replicas and the replication process is faster than MySQL (sub 10 ms replica lag)**
- **Failover in Aurora is instantaneous. It’s HA (High Availability) native.**
- Aurora costs more than RDS (20% more) – but is more efficient

### Aurora High Availability and Read Scaling

- 6 copies of your data across 3 AZ:
    - 4 copies out of 6 needed for writes
    - 3 copies out of 6 need for reads
    - Self healing with peer-to-peer replication
    - Storage is striped across 100s of volumes
- One Aurora Instance takes writes (master)
- Automated failover for master in less than 30 seconds
- Master + up to 15 Aurora Read Replicas serve reads
- Support for Cross Region Replication

### Aurora DB Cluseter

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2029.png)

### Features of Aurora

- Automatic fail-over
- Backup and Recovery
- Isolation and security
- Industry compliance
- Push-button scaling
- Automated Patching with Zero Downtime
- Advanced Monitoring
- Routine Maintenance
- Backtrack: restore data at any point of time without using backups

### Aurora Replicas-Auto Scaling

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2030.png)

### Aurora Specialty

- **Custom Endpoint**
    - Define a subset of Aurora Instances as a Custom Endpoint
    - Example: Run analytical queries on specific replicas
    - **The Reader Endpoint is generally not used after defining Custom Endpoints**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2031.png)
    

- **Serverless**
    - **Automated database instantiation and auto-scaling based on actual usage**
    - Good for infrequent, intermittent or unpredictable workloads
    - No capacity planning needed
    - Pay per second, can be more cost-effective
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2032.png)
    
- **Multi-Master**
    
    ![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2033.png)
    
- **Global Aurora**
    - Aurora Cross Region Read Replicas:
        - Useful for disaster recovery
        - Simple to put in place
    - Aurora Global Database (recommended):
        - 1 Primary Region (read / write)
        - **Up to 5 secondary (read-only) regions, replication lag is less than 1 second**
        - Up to 16 Read Replicas per secondary region
        - Helps for decreasing latency
        - Promoting another region (for disaster recovery) has an RTO of < 1 minute
        - Typical cross-region replication takes less than 1 second
- **Aurora Machine Learning**
    - Enables you to add ML-based predictions to your applications via SQL
    - Simple, optimized, and secure integration between Aurora and AWS ML services

### Backup

- **Restoring a RDS / Aurora backup or a snapshot creates a new database**
- **RDS Backups**
    - Automated backups:
    • Daily full backup of the database (during the backup window)
    • Transaction logs are backed-up by RDS every 5 minutes
    • => ability to restore to any point in time (from oldest backup to 5 minutes ago) • 1 to 35 days of retention, set 0 to disable automated backups
    - Manual DB Snapshots
    • Manually triggered by the user
    • Retention of backup for as long as you want
    - Restoring MySQL RDS database from S3
        
        • Create a backup of your on-premises database
        • Store it on Amazon S3 (object storage)
        • Restore the backup file onto a new RDS instance running MySQL
        
    - **Trick: in a stopped RDS database, you will still pay for storage. If you plan on stopping it for a long time, you should snapshot & restore instead**
- **Aurora Backup**
    - Automated backups
    • 1 to 35 days (cannot be disabled)
    • point-in-time recovery in that timeframe
    - Manual DB Snapshots
    • Manually triggered by the user
    • Retention of backup for as long as you want
    - Restoring MySQL Aurora cluster from S3
    • Create a backup of your on-premises database using Percona XtraBackup
    • Store the backup file on Amazon S3
    • Restore the backup file onto a new Aurora cluster running MySQL
    - Aurora Database Cloning
    • Create a new Aurora DB Cluster from an existing one
    • Faster than snapshot & restore
    • Uses copy-on-write protocol
    • Initially, the new DB cluster uses the same data volume as the original DB cluster (fast and efficient – no copying is needed)
    • When updates are made to the new DB cluster data, then additional storage is allocated and data is copied to be separated
    • Very fast & cost-effective
    • Useful to create a “staging” database from a “production” database without impacting the production database

### RDS & Aurora Security

- **At-rest encryption:**
    - Database master & replicas encryption using AWS KMS – must be defined as launch time
    - If the master is not encrypted, the read replicas cannot be encrypted
    - To encrypt an un-encrypted database, go through a DB snapshot & restore as encrypted
- **In-flightencryption:** TLS-readybydefault,usetheAWSTLSrootcertificatesclient-side
- **IAM Authentication:** IAM roles to connect to your database (instead of username/pw)
- **Security Groups:** Control Network access to your RDS / Aurora DB
- **No SSH available except on RDS Custom**
- Audit Logs can be enabled and sent to CloudWatch Logs for longer retention

### RDS Proxy

![Untitled](UDemy%20AWS%202b59be6a38524858b63a4b507501541a/Untitled%2034.png)

- Fully managed database proxy for RDS
- **Allows apps to pool and share DB connections established with the database**
- **Improving database efficiency by reducing the stress on database resources (e.g., CPU, RAM) and minimize open connections (and timeouts)**
- **Serverless, autoscaling, highly available (multi-AZ)**
- Reduced RDS & Aurora failover time by up 66%
- Supports RDS (MySQL, PostgreSQL, MariaDB, MS SQL Server) and Aurora (MySQL, PostgreSQL)
- No code changes required for most apps
- Enforce IAM Authentication for DB, and securely
- store credentials in AWS Secrets Manager
- **RDS Proxy is never publicly accessible (must be accessed from VPC)**

## Elastic Cache